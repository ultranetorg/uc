<?xml version="1.0" encoding="utf-8" ?>
<cls:CustomPage
    x:Class="UC.Net.Node.MAUI.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:cls="clr-namespace:UC.Net.Node.MAUI.Controls"
    xmlns:vm="clr-namespace:UC.Net.Node.MAUI.ViewModels.Pages"
    xmlns:models="clr-namespace:UC.Net.Node.MAUI.Models"
    xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:converters="clr-namespace:UC.Net.Node.MAUI.Converters"
    ios:Page.UseSafeArea="True"
    x:DataType="vm:DashboardViewModel">
    <cls:CustomPage.Resources>
        <toolkit:IsStringNullOrWhiteSpaceConverter x:Key="IsStringNullOrWhiteSpace" />
        <converters:StatusToStyleConverter x:Key="StatusToStyleConverter" />
        <DataTemplate x:DataType="models:Transaction" x:Key="TransactionTemplate">
            <Grid ColumnDefinitions="Auto,*,23">
                <Label
                    Grid.Column="0"
                    FontSize="11"
                    MaxLines="1"
                    Text="{Binding Name, TargetNullValue='Name', FallbackValue='Name'}"
                    VerticalOptions="Center" />
                <Label
                    Grid.Column="1"
                    MaxLines="1"
                    Style="{DynamicResource Regular}"
                    VerticalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Unt}" />
                            <Span Text=" Unt" />
                            <Span Text=", " />
                            <Span Text="{Binding FromId}" />
                            <Span Text="-&gt;" />
                            <Span Text="{Binding ToId}" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <ImageButton
                    Grid.Column="2"
                    Padding="2"
                    HeightRequest="23"
                    Style="{Binding Status, Converter={StaticResource StatusToStyleConverter}}"
                    VerticalOptions="Center"
                    WidthRequest="23" />
            </Grid>
        </DataTemplate>
        <DataTemplate x:DataType="models:Wallet" x:Key="WalletTemplate">
            <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="20">
                <Label
                    Grid.Column="0"
                    MaxLines="1"
                    Style="{DynamicResource Regular}"
                    Text="{Binding Name}"
                    VerticalOptions="Center" />
                <Label
                    Grid.Column="1"
                    MaxLines="1"
                    Style="{DynamicResource Regular}"
                    Text="{Binding Id}"
                    VerticalOptions="Center" />
                <Label
                    Grid.Column="2"
                    Style="{DynamicResource Regular}"
                    VerticalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span
                                FontAttributes="Bold"
                                FontSize="11"
                                Text="{Binding Unts}" />
                            <Span Text=" " />
                            <Span Text="UNT" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </Grid>
        </DataTemplate>
    </cls:CustomPage.Resources>
    <!--<cls:CustomPage.LeftContent>
        <StackLayout>
            <Label
                HorizontalOptions="Start"
                Text="Ultranet User Center"
                VerticalOptions="Center" />
        </StackLayout>
    </cls:CustomPage.LeftContent>-->
    <cls:CustomPage.RightContent>
        <AbsoluteLayout HeightRequest="32" WidthRequest="32">
            <ImageButton
                AbsoluteLayout.LayoutBounds="0,1,1,1"
                AbsoluteLayout.LayoutFlags="All"
                Style="{DynamicResource Bell2}" />
            <Frame
                Margin="2"
                AbsoluteLayout.LayoutBounds="1,0,-1,-1"
                AbsoluteLayout.LayoutFlags="PositionProportional"
                IsVisible="{Binding Text, Source={x:Reference BadgeValueLabel}, Converter={StaticResource IsStringNullOrWhiteSpace}}"
                Style="{DynamicResource BadgeFrame}">
                <Label
                    x:Name="BadgeValueLabel"
                    Padding="0"
                    FontSize="11"
                    HorizontalOptions="CenterAndExpand"
                    Text="2"
                    TextColor="White"
                    VerticalOptions="CenterAndExpand" />
            </Frame>
        </AbsoluteLayout>
    </cls:CustomPage.RightContent>
    <cls:CustomPage.MainContent>
        <ScrollView>
            <StackLayout Padding="15,0,15,40">
                <Label
                    FontSize="12"
                    Style="{DynamicResource DashLabel}"
                    Text="Accounts" />
                <Frame Style="{DynamicResource SquareFrame}">
                    <StackLayout
                        BindableLayout.ItemsSource="{Binding Wallets}"
                        BindableLayout.ItemTemplate="{StaticResource WalletTemplate}"
                        Spacing="5" />
                </Frame>
                
                <Label
                    FontSize="12"
                    Style="{DynamicResource DashLabel}"
                    Text="Transactions" />
                <Frame Style="{DynamicResource SquareFrame}">
                    <StackLayout
                        BindableLayout.ItemsSource="{Binding Transactions}"
                        BindableLayout.ItemTemplate="{StaticResource TransactionTemplate}"
                        Spacing="0" />
                </Frame>
                <StackLayout Padding="10">
                    <cls:LabelPair Text1="Accounts" Text2="10" />
                    <cls:LabelPair Text1="Auctions (outbinded)" Text2="0 (0)" />
                    <cls:LabelPair Text1="Auctions (renewal needed)" Text2="2 (0)" />
                    <cls:LabelPair Text1="Products" Text2="4" />
                    <cls:LabelPair Text1="Releases (total/clean/compromised)" Text2="346/300/2" />
                    <cls:LabelPair Text1="Last Release" Text2="UOS 0.1.670" />
                </StackLayout>
                <Grid
                    Margin="0,25,0,0"
                    ColumnDefinitions="*,*,*,*"
                    RowDefinitions="Auto,Auto,Auto"
                    RowSpacing="15">
                    <cls:ImageTextButton
                        Grid.Row="0"
                        Grid.Column="0"
                        Command="{Binding AccountsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Accounts}"
                        Text="Accounts" />
                    <cls:ImageTextButton
                        Grid.Row="0"
                        Grid.Column="1"
                        Command="{Binding AuthorsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Authors}"
                        Text="Authors" />
                    <cls:ImageTextButton
                        Grid.Row="0"
                        Grid.Column="2"
                        Command="{Binding AccountsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Auctions}"
                        Text="Auctions" />
                    <cls:ImageTextButton
                        Grid.Row="0"
                        Grid.Column="3"
                        Command="{Binding ProductsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Products}"
                        Text="Products" />
                    <cls:ImageTextButton
                        Grid.Row="1"
                        Grid.Column="0"
                        Command="{Binding TransactionsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Transactions}"
                        Text="Transactions" />
                    <cls:ImageTextButton
                        Grid.Row="1"
                        Grid.Column="1"
                        Command="{Binding AccountsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Search}"
                        Text="Search" />
                    <cls:ImageTextButton
                        Grid.Row="1"
                        Grid.Column="2"
                        Command="{Binding AccountsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Network}"
                        Text="Network" />
                    <cls:ImageTextButton
                        Grid.Row="1"
                        Grid.Column="3"
                        Command="{Binding ETHTransferExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Transfer}"
                        Text="ETH-UNT Transfer" />
                    <cls:ImageTextButton
                        Grid.Row="2"
                        Grid.Column="0"
                        Command="{Binding AccountsExcuteAsyncCommand}"
                        ImageStyle="{DynamicResource Help}"
                        Text="Help" />
                </Grid>
            </StackLayout>
        </ScrollView>
    </cls:CustomPage.MainContent>
</cls:CustomPage>
