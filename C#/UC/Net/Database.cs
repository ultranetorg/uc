using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Net;
using System.Numerics;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;
using Nethereum.ABI.Util;
using Nethereum.BlockchainProcessing.BlockStorage.Entities;
using Nethereum.Hex.HexConvertors.Extensions;
using Nethereum.Model;
using Nethereum.RPC.Accounts;
using Nethereum.Signer;
using Nethereum.Util;
using Nethereum.Web3;
using Nethereum.Web3.Accounts;
using Org.BouncyCastle.Utilities;
using Org.BouncyCastle.Utilities.Encoders;
using RocksDbSharp;

namespace UC.Net
{
	public delegate void BlockDelegate(Block b);

	public class Database
	{
		class Genesis
		{
			public Zone			Zone;
			public Cryptography Crypto;
			public string		Rounds;
		}

		public const int					Pitch = 8;
		public const int					LastGenesisRound = Pitch * 3;
		public const int					MembersMin = 7;
		public const int					MembersMax = 1024;
		public const int					NewMembersPerRoundMax = 1;
		public const int					MembersRotation = 32;
		public static int					TailLength => Settings.Dev != null && Settings.Dev.TailLength100 ? 100 : 1000;
		const int							LoadedRoundsMax = 1000;
		public static readonly Coin			BailMin = 1000;
		public static readonly Coin			FeePerByte = new Coin(0.000001);

		public Settings						Settings;
		public Role							Roles => (Settings.Database.Base ? Role.Base : 0) | (Settings.Database.Chain ? Role.Chain : 0);

		public List<Round>					Rounds	= new();
		public Dictionary<int, Round>		LoadedRounds = new();
		public List<Member>					Members	= new();
		public List<Account>				Funds = new();

		public RocksDb						Engine;
		public byte[]						BaseState;
		static readonly byte[]				BaseStateKey = new byte[] {0x01};
		//public byte[]						__BaseStateHash;
		static readonly byte[]				__BaseHashKey = new byte[] {0x02};
		public byte[]						BaseHash = Cryptography.ZeroHash;
		static readonly byte[]				ChainStateKey = new byte[] {0x03};
		//static readonly byte[]				LastCommitedRoundHashKey = new byte[] {0x03};
		//public byte[]						LastCommitedRoundHash;
		public AccountTable					Accounts;
		public AuthorTable					Authors;
		public ProductTable					Products;
		public RealizationTable				Realizations;
		public ReleaseTable					Releases;
		public int							Size => BaseState == null ? 0 : (BaseState.Length + 
																			Accounts.Clusters.Sum(i => i.MainLength) +
																			Authors.Clusters.Sum(i => i.MainLength) +
																			Products.Clusters.Sum(i => i.MainLength) +
																			Realizations.Clusters.Sum(i => i.MainLength) +
																			Releases.Clusters.Sum(i => i.MainLength));
		public Log							Log;
		public BlockDelegate				BlockAdded;

		readonly static List<Genesis>		Genesises =	new()
											{
												new Genesis {Zone = Zone.Localnet, Crypto = new NoCryptography(), Rounds = "00000103ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000001890fc559d8618a5680e638b6bb52d6c8bb36d31063cfb8cc6ef3ebb71044c9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001eeee974ab6b3e9533ee99f306460cfc24adcdae000ffff50e1605b6f302850694291eb0e688ef1567741003f16df410e83b29179b85e9dd852302ecee648000000000000000000000000bb310ea0c0dff4f1ae896743e0e32477e4013f8d74f3f4ebbbae99c79310ef0100000201010b0010357ca5997a866cd200000200090000a0dec5adc935360000003e225e528b2da96701362aeb1ffe8e9a2eeee40000000000000000000000009f0e4edd96bd8c4821922e0e7f8154fb2b565f5e174459e223e84821e0977fb300000201010b0065b49dd2f741f271d200000200090000a0dec5adc935360000003d31941151218a84e5dbd34e892bfe12fc17fa00000000000000000000000080c13c45c3a6cf4076459db3b53ea3e13f3f25bc4658548e05ca00ee8d57c40d00000201010b00ba33bfff55095e77d200000200090000a0dec5adc935360000003ce1cf80589c6a8f1d87811ba70c3ab499c0fb000000000000000000000000233e38d39637d3403b5bc78c0e1f2b6f7499c2f1281f075afac4b5ab12d2282500000201010b000fb3e02cb4d0c97cd200000200090000a0dec5adc935360000003b2b5f9d48ecd5c17ffcb6ca06d40a4d6fe8f4000000000000000000000000ded1ad3a31bc1819442c953d9c351fff83cc13c5a105fc32eb64e1f9797d187800000201010b006432025a12983582d200000200090000a0dec5adc935360000003aa214a21ec6b3dac1737b24263b932d8ab7a6000000000000000000000000f7718879f04ffecf6703a49c59f1272befeba57ad43076cd6791cc5c0d28102b00000201010b00b9b12387705fa187d200000200090000a0dec5adc935360000003944480f55c0e9ecfa92307b66dc8d8fa3ccf20000000000000000000000006d291fdfda0108f85175fb8625a42f7da8af23d8d7325262be10e51bacd5233600000201010b000e3145b4ce260d8dd200000200090000a0dec5adc93536000000385115d78dbb10fb51592b13343095a84552480000000000000000000000001f3ec0efe53b3b3c887f679671133aec1b4691c26c56f4a7efcac4b5c4da282a00000201010b0063b066e12cee7892d200000200090000a0dec5adc935360000003701a01623a94f90d172ddcc566c42555436c8000000000000000000000000d151f6158c743039a275d006fb538f0033c326c83adeb65d06f2754956386b5600000201010b00b82f880e8bb5e497d200000200090000a0dec5adc93536000000360f6bf22a078d5d63dc40e9a70ede10914dd00000000000000000000000001ceade255a0e28435b2c625dfc0134f3f5d610da86b14b2d277d2403b60c5f9400000201010b000dafa93be97c509dd200000200090000a0dec5adc93536000000357f7b136d5dadfccda67a1b1a6a9a3089b79c0000000000000000000000000980ed026d4cf72b26c86a0e66a49dc147a1bf5fa745ddbd37a4068bebd8814a00000201010b00622ecb684744bca2d200000200090000a0dec5adc93536000000346c2de60afe71d1f206edcfb37ba145a14f7c000000000000000000000000a99793a9868adeceb698481f190f665ce8abeabbb8c5cadd638065720de4c31200000201010b00b7adec95a50b28a8d200000200090000a0dec5adc9353600000033332d6e445a3f0007bceb644daa318c719225000000000000000000000000d4d930cd706df55c3a0c336210355e0b615107ab95ac1d13ec82a24db995e4b500000201010b000c2d0ec303d393add200000200090000a0dec5adc9353600000032910fef662934368d49e3ac4ab3848dadd9890000000000000000000000002d56be03d98a299efc75905c987ee4d8fdb010b6a909a348cffa8d793a17ffb300000201010b0061ac2ff0619affb2d200000200090000a0dec5adc9353600000031314e891911246becee4248a1126bc80ed66b000000000000000000000000c006357505a559375ebf9b26a69c1c23339a7e997ffbca3054885392ddb92b5b00000201010b00b62b511dc0616bb8d200000200090000a0dec5adc93536000000307118813d771de11c8305bd4991c43dbe801c000000000000000000000000d41fc4013ffaa91cf465e151ba9bc742685254b70204070ca65e3c062612ab7e00000201010b000bab724a1e29d7bdd200000200090000a0dec5adc935360000002f34eac76835bd6d7900dd1f49cbbc00be1bd1000000000000000000000000dd962113f435fa6590956b5613cfbfe1762cead57fa0b638224aecb4f60362c200000201010b00602a94777cf042c3d200000200090000a0dec5adc935360000002ef6873dee1829c0ab5425239057c96edebb5100000000000000000000000017462769ade8052570ce6dcab6a9809c0189a8c9c9090520c3b8fc8d1f7acc8000000201010b00b5a9b5a4dab7aec8d200000200090000a0dec5adc935360000002d2d532df2b5e040a56ed7579cb4c7995cbea4000000000000000000000000b10070bf44b263d7647c515d3bdb7a43b77dc1972ee2c7405563fa1bf1c895ad00000201010b000a29d7d1387f1aced200000200090000a0dec5adc935360000002cb7796cd37ced6428c72aa657867bc6996d3400000000000000000000000013da9f867d2420bb4c6e38ad32974654344584bc6e54f908814e3f4e7283583d00000201010b005fa8f8fe964686d3d200000200090000a0dec5adc935360000002b4b87efacbe56212f7169aa86d68bc1eedcc400000000000000000000000082d4008b5c3a31713b1f8ac8598735d81c009633f68c9829b428aa7412369d9600000201010b00b4271a2cf50df2d8d200000200090000a0dec5adc935360000002a200f1acc19708810b2dcb1659956fe544fc1000000000000000000000000f42708396ced9d744ad23441a32d3c5f2ffa334aa09ffef86c44c9f0226a540e00000201010b0009a73b5953d55dded200000200090000a0dec5adc9353600000029fe288ff06811f434419459f3e0d59b9a5e46000000000000000000000000957e67e2b26f892a2003a7192457dc68e675dcf97da74d7961781a6c38efea2900000201010b005e265d86b19cc9e3d200000200090000a0dec5adc93536000000289bb33916909a8ede99359a78eb44db523f6f0000000000000000000000002b744395b13e080676df0940a8321c546c88307572d40f9c03dd4ad25ec95ea500000201010b00b3a57eb30f6435e9d200000200090000a0dec5adc93536000000277700cd3e813ad77fcd566d1e3937ddfc7895000000000000000000000000d0805c9356a79c37069397f0600b458f383a968e6969a656eb323170526f6f9900000201010b000825a0e06d2ba1eed200000200090000a0dec5adc9353600000026bf9a73fb5137d425c7660eb4d0b32be233a700000000000000000000000055d7d6c90bb9c88dfe5ffb6f85ff44ad86f602cbaea39454fc251c2d044d8f7900000201010b005da4c10dccf20cf4d200000200090000a0dec5adc935360000002512e4f334decddf8babaee1f1cfc12e483c4a000000000000000000000000adfe74e2f839b570446251ef01624a01dbd4a40185042347605ae66aa8cc43d000000201010b00b223e33a2aba78f9d200000200090000a0dec5adc9353600000024ea63396bef481ebbf471d9c14a9f6e90ec33000000000000000000000000b29e22b3adf045f9f81339e13e2fd1231170b50bf2fe98586e92fa0b67dac11900000201010b0007a304688881e4fed200000200090000a0dec5adc93536000000231c41506ed20c5af3d1afe1db6feaeec150be0000000000000000000000009d57d205efafc5f7318a101bc503221b245be0ff44dcf9fd6a3ff0030804db0c00000201010b005c222695e6485004d300000200090000a0dec5adc9353600000022d37418b2e80774e43e5517c1694150f4a8c600000000000000000000000091fc369e11c65d3d05181bc861217ae6bc8c901ea88a0b9ee0e3fc324c953dea00000201010b00b1a147c24410bc09d300000200090000a0dec5adc93536000000215785d7a5694b232f07a7cb4cbbe499b28e3b00000000000000000000000033227c4e70a69acf4dd07627db82622fcaf111273d5fcd235af61af94561a3d300000201010b00062169efa2d7270fd300000200090000a0dec5adc9353600000020acad6c390b8dc53972c91b3d61a9db1c4bc2000000000000000000000000bf1f5f60ca8fd79d451fd631fbc0b1767b9959cb55e7cd966b044475f2494c0100000201010b005ba08a1c019f9314d300000200090000a0dec5adc935360000001fea628d33830e5515e52fb7e3f9a009b24317000000000000000000000000f7fb7ac917c0f907a1d1f4946ba12ef0219842ddffe6018d079ca2a42b3384d000000201010b00b01fac495f66ff19d300000200090000a0dec5adc935360000001e4bb1c709413d815030490903e22fcfbdcfc50000000000000000000000003083011f3d32d4acee7df780c28e6bd66c995f86922f1cebb0175bb0c9553d0400000201010b00059fcd76bd2d6b1fd300000200090000a0dec5adc935360000001d7e189d0c0d5de5e6c38df1830b391869c80b00000000000000000000000069f256ea1fe873a4a70548594e12883afa62ceec04d457efdc94ebd6cec0d2b700000201010b005a1eefa31bf5d624d300000200090000a0dec5adc935360000001c21c8af3f21df62eac26064c7bc88c387317e000000000000000000000000c1ed8974ba39636088c21f2b0fa565312070e1d2b18a7a1135183a8f79a18b1600000201010b00af9d10d179bc422ad300000200090000a0dec5adc935360000001bfc9a502b74900e404619f5d0dda9c8e7e618000000000000000000000000fd1c32702c9b05dd993b1d7739936a4b8a07a8bda5809b4599ade5b1ed8fa03700000201010b00041d32fed783ae2fd300000200090000a0dec5adc935360000001a929ef80f1e66189404aca391ebf74ad64cee0000000000000000000000003ef1ad561969cc8800898d953d93fa5bd999755827e477d4200f3250be0cee0c00000201010b00599c532b364b1a35d300000200090000a0dec5adc9353600000019cbebfd57861cff6d5b469710c811804f38e000000000000000000000000091663a728c74fb0e42d45a896e61aeacc11635d956df07a326390ec97a898c3900000201010b00ae1b75589412863ad300000200090000a0dec5adc935360000001886c14a86fc405d1e5946e748a0f2098435a1000000000000000000000000db5992f0d850bacbc04147e279135b1bb2e63f8cbafe224510ba2c0e8e92d47d00000201010b00039b9685f2d9f13fd300000200090000a0dec5adc93536000000176268bd6c7ac0098516f3353b7c666116131100000000000000000000000058963e9b8df1606b5b5a4863d37e3f223325aa9c676d5f3a7395cbb4c9de229100000201010b00581ab8b250a15d45d300000200090000a0dec5adc9353600000016288f98f0ffab0def000d8013d6d49b0788760000000000000000000000008e18accd4310b234a482574f9393c5f60b115887f1a5dab47f7b1b981964637a00000201010b00ad99d9dfae68c94ad300000200090000a0dec5adc9353600000015dad58fe48fcdb5c581e60666ba19a9b128ce000000000000000000000000bd736e42f916104f00fe47cc857cc1145b8ba4e4a0b0fcda4368b3b4fd0fc81300000201010b000219fb0c0d303550d300000200090000a0dec5adc9353600000014a3e765da7ae42dd18bed6563f37a731dee47000000000000000000000000ef7e6703ad36a3596255431a008547f53594b138c32782e98940f6bbd1197af800000201010b0057981c3a6bf7a055d300000200090000a0dec5adc93536000000139113a098c2cb09d5c317dda3ccb4401579cc000000000000000000000000655ff2a277dd3aa54769633444668a4772c28bfd723932f5c42ef865895e9d5400000201010b00ac173e67c9be0c5bd300000200090000a0dec5adc93536000000124f49e65f74ceeb2c6d354abc74d548d5a74d000000000000000000000000a7f9b8839b53db0756ce2fa7e6728733dec83db28fd3db76e89f193432761b5e00000201010b0001975f9427867860d300000200090000a0dec5adc9353600000011e020c1c8613675b99c393410c6afa6bcf660000000000000000000000000935444989bc887d03b0f3e785891d00f0c423e83a4497a66eff29337971a2be900000201010b00561681c1854de465d300000200090000a0dec5adc93536000000106216a6baa05f1f93dc44ffba20bc0d7abb460000000000000000000000000507244f958c59c52eda4f51e4f585457d4a101f89f81608ad0ec5a6d38b2db800000201010b00ab95a2eee314506bd300000200090000a0dec5adc935360000000ff3c7e0b5c19447d5175cb4c6641cfa6131520000000000000000000000004777c4158809c4bfbc06cf2716dd70df80c2e4b8f1d2d877dd5207daf475cbd200000201010b000015c41b42dcbb70d300000200090000a0dec5adc935360000000ea12d3b17f96ef79ef4012db9df43a3d6da1b00000000000000000000000028ff18e2122fd790e60045aae42f275c7372aa7a20e20c10b233af769a08f1f700000201010b005594e548a0a32776d300000200090000a0dec5adc935360000000d381af6561f165a44680afa06e2360fd1e06000000000000000000000000036270d8375b87154b0143c5e7591759cf64adc96fdac440e855f83201256d5f000000201010b00aa130776fe6a937bd300000200090000a0dec5adc935360000000c68d29c01f7e5873a9e353ee9af4d9505be93000000000000000000000000a4fd65df5f07375a799d69724b0967e6c5204a7d01dca518486741ffde45294a00000201010b00ff9228a35c32ff80d300000200090000a0dec5adc935360000000b2dc121bd9114e7aab47754130f6148b38755000000000000000000000000b9cefaa31dae1dd8edbeb3dd8a8f919e9c9b7267c6bd041e2d7fceed82fb7ef500000201010b0054124ad0baf96a86d300000200090000a0dec5adc935360000000a52cad719404896a55f2dc2ea28dc7a6a92490000000000000000000000001c9598090f1ee178b7b9973dd8aa373ce03ede29eff0a7702eea47f69c146c1800000201010b00a9916bfd18c1d68bd300000200090000a0dec5adc9353600000009cc6575ddd868bc1476f7ea516af58125b0dd00000000000000000000000072165f2f1d368790e2bbabeb02fa9514a71705733ffbbed1319828a28345397300000201010b00fe108d2a77884291d300000200090000a0dec5adc93536000000086c57b20ac627f1b04b7bf50bb27330438b6b000000000000000000000000f12e48b9341ecce4d3789cc878b8256725c83b780e29b626e5460e35c9300a0600000201010b005390ae57d54fae96d300000200090000a0dec5adc9353600000007f34bc43d41cf3ec2e6f684c7b9b131b04b41000000000000000000000000a13fd8903be2e88bbefcba5583b3e9717f0561a5c9d97e6b52808a90bc55176d00000201010b00a80fd08433171a9cd300000200090000a0dec5adc9353600000006680ad7845cfb115cd56f834385817e93999a00000000000000000000000074685559e861061fb0690ad13c8ac872454fed052d91aed470b5fa6cc8c9317500000201010b00fd8ef1b191de85a1d300000200090000a0dec5adc9353600000005a748d15de450cd488fbed9cc3b3213f042e5000000000000000000000000a3ed4e4af6d1a6d1c38fb39a8ac29a85e45d48a47b61c192f9fcef985c00a04400000201010b00520e13dfefa5f1a6d300000200090000a0dec5adc9353600000004761973068828923e7c811dd7f5b8eee0bae500000000000000000000000008cb76866d766dac5d59c49f1688097b64b5ba27d7c180e2c522cfff110c108800000201010b00a78d340c4e6d5dacd300000200090000a0dec5adc93536000000031174fcd4f971249e4112f925209a16813137000000000000000000000000842a9288508095b68d42580a0822a1dd0dddea80b25f38f93e472045bd59d9d500000201010b00fc0c5639ac34c9b1d300000200090000a0dec5adc9353600000002a311f7cf0aabfd3a248a89824bbd94a458a2000000000000000000000000f68e7bfec0162c9e033a51839ef2fb3f4276ffc13e016ec5d3791f5b0810013600000201010b00518c77660afc34b7d300000200090000a0dec5adc93536000000015326bcf44c84a605afbdd5343de4aaf1138700000000000000000000000028ae8132789af57a396388dcf13145b689a8e80f35b44eaab6ee68b58454f72200000201010b00a60b999368c3a0bcd300000200090000a0dec5adc935360000000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000009106b6f459c10275df10b4cc3e65414d2116ae4cacbd09126ae14e10be34440100000201010b00fb8abac0c68a0cc2d300000200090000a0dec5adc935360000eeee974ab6b3e9533ee99f306460cfc24adcdae000000000000000000000000046b5071b4d870303b845313d0ffcaecaf78d2cfb08450e2a8d793d098c7cc870000002040102756f08000064a7b3b6e00d00020008000064a7b3b6e00d00000001000103ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000dc93abe7ca3215a98add67ba73d9ff98e160c15dcb05d086f70c8c23dbae6ea200010081d8c4bd750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef1567701eeee974ab6b3e9533ee99f306460cfc24adcdae000000000000000000000000030f87d674aa6b7008264f715849426abde0d65113ecfe224bcb39ac012117b4f000101050202756f02554fff000002000103ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000003b56597243b97ab77b0e1a6552f50511e8f2f637c2f94ff063a35fd5cea5275b000200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef15677000003000103ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000069ab30e69e6391d4ca29676e59643154462df0b2d0d712cb5d5cd594033a4032000300010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef15677000004000103ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000009ee975ec8131d349800e0edffc85b016d5f948c5cb0eab9d071cfe72ac9b3506000400010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef15677000005000103ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000488ae75835825b0416849dcf358259e997d9166f587897406ccf72707470c124000500010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef15677000006000103ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000045fa70e6fb13b15d149700a56c70a24117710bbc42620795680f5afbc5ea2f7a000600010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef15677000007000103ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000fbc23a837b3cff288c250908c40cfb0a7bbb46a2b0473b39bc3f8aaaf7578ec1000700010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff50e1605b6f302850694291eb0e688ef156770000080003010801c0a80164000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000f8d4fca5996439cd6cdb4c92c0027e21f498bcc179b50f38e9947bcda57666c400010801c0a80164000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000f8d4fca5996439cd6cdb4c92c0027e21f498bcc179b50f38e9947bcda57666c40002ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000f394533ae3288ee6af1fdcb7b5387e3462c2815fbed6a6eaf7528ee26af88f5700080001000000000000000000000000000000000000000000000000000000000000000000011890fc55000000000000000000000009000102ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000005bbd4a4c724bd4551ca9313e0eed2ad9a492a7c149bf69ac3bbad6f4fb1d18cf00090001000000000000000000000000000000000000000000000000000000000000000081d8c4bd7501dc93abe700000000000000000000000a000102ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000001179a216935c20d630cce24a45dfded664e9470a622c009954f0c4d782da5427000a0001000000000000000000000000000000000000000000000000000000000000000001013b56597200000000000000000000000b000102ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000083e474b92d5cb34dd18a9639b91d749ccecf805d1952f39bbc41969db62379f8000b00010000000000000000000000000000000000000000000000000000000000000000010169ab30e600000000000000000000000c000102ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000007024002ead547f2087ad90b39a583792ac284be3dfe19925eb8363057964b53a000c0001000000000000000000000000000000000000000000000000000000000000000001019ee975ec00000000000000000000000d000102ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000092723f6c298c11c34b66f8ea444ec021fa2ba555e8350a878a1aad955b0e2137000d000100000000000000000000000000000000000000000000000000000000000000000101488ae75800000000000000000000000e000102ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000a90590a2d2c7dff05b3659222681ff05ac66070f1e4ee89db6331c2f29de7636000e00010000000000000000000000000000000000000000000000000000000000000000010145fa70e600000000000000000000000f000102ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000b274f968e86fc8f8634ac04da2ffaf52a4aed1a2e25ea442984bdc8d2429bc98000f000100000000000000000000000000000000000000000000000000000000000000000101fbc23a83000000000000000000000010000102ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000009ad69c148dcf821a3726b66aceaff297ee9fc017472e758245459739730173be0010000166d23f4f5a2cc7f5f2dd6b028dc474f757504ae62bb71133bbc9712ffa99d4d50100000000000001000038a7a3cb80ec769c632b7b3e43525547ecd1000000000011000202ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000fc93a7b627a5da633f04a1715e3f182e42cb4f0eeda53625bfba099cf6320706001100011c7940c4093ea0c8082cf8c9086ba2a60ca73ad9f84736310a0ca416c07342e601000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000fc93a7b627a5da633f04a1715e3f182e42cb4f0eeda53625bfba099cf6320706001100011c7940c4093ea0c8082cf8c9086ba2a60ca73ad9f84736310a0ca416c07342e60100000000000000000000000012000202ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000006b8a1aaed187fca648b46dc1ca753bed64af3039ea3d6f8f907497c6a28f6bb7001200011e42fdb1752f08d8d1c263e0b859713bffdbffe84ff51ba730a6ce3b8887ae8601000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000006b8a1aaed187fca648b46dc1ca753bed64af3039ea3d6f8f907497c6a28f6bb7001200011e42fdb1752f08d8d1c263e0b859713bffdbffe84ff51ba730a6ce3b8887ae860100000000000000000000000013000202ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000009f155b7f927bb19f687ecf1cd22aab85846801f43291a98d85fc9af57f27015b001300012b24afc6be39e67759cf9d9f89ad1ce4613548108b63b38b6b82a2018668181f01000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000009f155b7f927bb19f687ecf1cd22aab85846801f43291a98d85fc9af57f27015b001300012b24afc6be39e67759cf9d9f89ad1ce4613548108b63b38b6b82a2018668181f0100000000000000000000000014000202ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000025b46dc154c2f23cd14d98fd4f19a465da1a7092511a0075f74fa398e68eabd9001400013006deae08c80d55f42fb2cdd6f181f82c6c11c650ce75817322ff360bfc73c601000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd100000000000000000000000025b46dc154c2f23cd14d98fd4f19a465da1a7092511a0075f74fa398e68eabd9001400013006deae08c80d55f42fb2cdd6f181f82c6c11c650ce75817322ff360bfc73c60100000000000000000000000015000202ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000a32d5a5996cc4d3b893a0310ada8374d59fb242c071169d32b4520a08baa87b1001500018ef377b588b6e9bc50f39403c0a63e1caac1b032658413a14ada59e614c594d801000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000a32d5a5996cc4d3b893a0310ada8374d59fb242c071169d32b4520a08baa87b1001500018ef377b588b6e9bc50f39403c0a63e1caac1b032658413a14ada59e614c594d80100000000000000000000000016000202ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000002f5f839125f1eb13e8231c5c2c016e4e3b67368a051d7fdc39caab963316e9c500160001e7049c2e93c1e7465594ec7521d1ccdddee4995ecfa67d3ea2ac5f7cda92b2ff01000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000002f5f839125f1eb13e8231c5c2c016e4e3b67368a051d7fdc39caab963316e9c500160001e7049c2e93c1e7465594ec7521d1ccdddee4995ecfa67d3ea2ac5f7cda92b2ff0100000000000000000000000017000202ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000005e3456019b74c9446f277e89e794089ef327d93794f2bee46978ea53a8b93ae500170001d6fad41c1ce85e1f22f407882d472433b084a825c019165f3aa74e7a8a0b802301000000000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000005e3456019b74c9446f277e89e794089ef327d93794f2bee46978ea53a8b93ae500170001d6fad41c1ce85e1f22f407882d472433b084a825c019165f3aa74e7a8a0b80230100000000000000000000000018000202ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000004493855c5c910fb6917b0841f8f929a3a21e4fec013eb4f80d9a38539b800f300180001adf5fa9fc75788d93f7c9189d74d215c13b8091c2e3e4d9fc58e2ccbf69b7a7e01000001000038a7000000000000000002000038a7a3cb80ec769c632b7b3e43525547ecd100000000000000000000000004493855c5c910fb6917b0841f8f929a3a21e4fec013eb4f80d9a38539b800f300180001adf5fa9fc75788d93f7c9189d74d215c13b8091c2e3e4d9fc58e2ccbf69b7a7e01000001000038a7000000000000000000" },
												//new Genesis {Zone = Zone.Local, Crypto = new EthereumCryptography(), Rounds = "0001000002030000ffea61659c02c4a38d5736767bec23ab8d28752118dcc5aa9c4ea5ac7a6baeb2c00fe795131249fff38aa123804415e92fc46067430454532a3445367b2f6fa24e6f0f1f71eeebf77d3f5179dbeec93eda59ea1b00000000000000000000000000000832b3d6ba18c945bbfc9baf44b52f65a449880b348520ccb42cd5fb38fc5016fe73c908ba73699e77c8c0d350ff14bc3d5f46e6d109f29cd21e4312679095a5f81b00000201090000a0dec5adc93536c0a8016a02080000c84e676dc11b000f31436863408437bf50c02865cab034aafe625d71fe4c9af7ccbbb72f7bd5b37feb8aba785eac0d60327ee7ab779525c12ee1957468336bc916c34a35273def1c00000201090000a0dec5adc93536c0a8016902080000c84e676dc11b00ae7ba257f8ae7dc6ae1c6c9a18f0947def9550a079abc02380020bea56162c37673c77412077a28c7e8e8d3803fbbdc11ff354dcf5f582d7aae42c5142a2b62e1c00000201090000a0dec5adc93536c0a8016802080000c84e676dc11b001a06703e7774c581c5f22c57e5d4ae01c7d3eb81e305ec5d32ae7521e6d53f836d9694151789a36e33dac68339f47bfe70b16c6b78fa6e8ca3ebcd44607b8ca11c00000201090000a0dec5adc93536c0a8016702080000c84e676dc11b00c97c2585746d1aed2eed862a21abeac3df1a4ceb2871429e3f40548660742159686039fdc966acc4679a8334b366c90db87333d849c5d92ed313625083f9981e1b00000201090000a0dec5adc93536c0a8016602080000c84e676dc11b006ffec6696eaf311a4e6d0b4ed03a3b8e4c7a37f8c4bd6f8e1a6568d3a58360916066f20a448846f1f5ce2fe0d494895dfc490278e38f70e94876e540f57231171b00000201090000a0dec5adc93536c0a8016502080000c84e676dc11b00e15bbcb49faa9daa8586b24aee9a1a7058b270e5325698eefb8507c7441616cf16fb8372bf549782c930b4e926affa5f30e01855a673a0142a95b730689996bb1c00000201090000a0dec5adc93536c0a8016402080000c84e676dc11b0089531e12cf910e62c26d5b8d5388527fa3d90b841955d385cfa9985482c706d054cef1778afbefa0ce61aeae488adb549b49dc29461e4348a32f6cf62d9a781a1b0000020402756f01000208000064a7b3b6e00d000100000038a7a3cb80ec769c632b7b3e43525547ecd1262509a8167f6693d39f21763f27134736a2b7ac3748f63f8bc602f7d6411ec357f4482ec576c8fca0c1e81f572ca0049461ed1c01a7cd5a1fb2fb64cdf3acf51cc0a8016400000000000101000001030100ffea61659c02c4a38d5736767bec23ab8d287515bb970258e792336b5b5a25a2776bb5545d86727877b66484e2cd938336721a6a79c88085bcefcab120b0983db1b64b6c0d3836a7a075f7672d8f96b03458b81b0081d8c4bd75000000000000000000000000011add463d846716812fb3d8992eef576e4e8aea1061a47ff5e4412fdadc32befc04e5db6b6074a017ee57b1cfce40f80f74aa7ae1b35a43212cc086bf914750c71b0101010502756f02554fff00000000000201000001030200ffea61659c02c4a38d5736767bec23ab8d2875726fa00c278d0194b0ed9b201949f2b2b579598afeeaf69a841b44149c5f9e1448ae784e390eb45adc8049beff11929d5eabfd388a29ee6713b7974541c8191a1c00010000000000000000000000000000000000000301000001030300ffea61659c02c4a38d5736767bec23ab8d28753eef6e8f4c15ddcfd8a6d7f18ed8d9f99a873523595a92a1fb4a2bc2e771bab84ddc51fcd004f55fa8a49597102d54195c18a4be6423b962bf58fa6fbe19dac61b00010000000000000000000000000000000000000401000001030400ffea61659c02c4a38d5736767bec23ab8d2875e4d286f6fd65b81e96a3612c32edcb047ee164c163fdb2443a6dbd95fde57493559f726e39eb0944f8e670005e1effe59e124e19fe9d4da5d6dc6f749c2eb7781b00010000000000000000000000000000000000000501000001030500ffea61659c02c4a38d5736767bec23ab8d28752b8041c52bc22ae8fab2e95c2a03223e84bad203db2f1bd34957e41d18a774f06a6a3e1ec12aacf994a3c8bc61d587d0984b4d223369cd38be0425f9ba9ede291b00010000000000000000000000000000000000000601000001030600ffea61659c02c4a38d5736767bec23ab8d2875511857c0b4df66d58af0c1237f1e55e3508d4232c1c9c7935b8576861ab9869c330d429aaab5587e9c19d61d4c68f0c7e5cd3223ab62ed3c09ff0f85a2d7c2be1b00010000000000000000000000000000000000000701000001030700ffea61659c02c4a38d5736767bec23ab8d2875b890b2162ca8b00993baf33d84568b67343212bf7fca18eb04e1677dd55fe7bd32e2dd35822c66d2612222a3100713eee5772719ccc244ad98480fee2292de391c00010000000000000000000000000000000000000801000001030800ffea61659c02c4a38d5736767bec23ab8d2875ee02ea3c839beb5929dc5bd7015d9a508419dffcff6d82d64fc35bb0d7c29ca66c7eaa76f023d11a5e277241b217f51458b4bbb26b695de51443b646f239131c1c0001000000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000901000001030900ffea61659c02c4a38d5736767bec23ab8d28752d86e829f4f3467a2a7d35411992baed3f646b25bb94da7b858320e8d92e0f153b410caa15ff00f0daef27915834118842c4ee23e918f14bd384be2b14e388841c0001000000000000000000000100fe929a68368c301a1906ed39016ee9be3d937b000000000000000a01000001030a00ffea61659c02c4a38d5736767bec23ab8d2875a1ab94398ff9ed9488233381df7aec80cd239e9f60cf5d3473a07f0c87774c7932ef58a0246dde93a989f4581c8a6a98fbb550eddafdad9b76270dbf7ae86a4e1c00010000000000000000000000000000000000000b01000001030b00ffea61659c02c4a38d5736767bec23ab8d287582bd2bf95a787747a6ded0e177430b660b59e1cd8f15eedd7473197e2bfeae2f01fe94ebd4a25c5c07b203993b873df3635eea3f558c4b04b45c824f0c7f9e551b00010000000000000000000000000000000000000c01000001030c00ffea61659c02c4a38d5736767bec23ab8d28758bdd4fe8f8a51e305c1047c3cbb60f71e49e225b62a2a9d0ad24288f24d599193c624422c21ad0a689d07222eaa574ca3ab5d74d1f4ee0e7bee7ec9713964caf1b00010000000000000000000000000000000000000d01000001030d00ffea61659c02c4a38d5736767bec23ab8d28751f7cad65a8132dd003cc78f5cd2072b968eab3fbc81723412744f687570b3d381c2a4a04902125201583da4914d9a0a3f0e8ff7a8abbd458626209269a05b2091c00010000000000000000000000000000000000000e01000001030e00ffea61659c02c4a38d5736767bec23ab8d2875756b64452b2da3d326f9f457eba3ff70c2fa91dc726b0adecb867a340ae2be256b4059e38f16a4f1bc28fb7bbf341b83de39d52bf53fff3da53a52d7981a735c1c00010000000000000000000000000000000000000f01000001030f00ffea61659c02c4a38d5736767bec23ab8d287508994bf6f6ade6ea4327286abc5e5a91d7ea8877817d1f10125ea5e5d5f347f955b7c714ff44119171552674a1b3323263f201bad656719708fd30ed3ece58fc1b00010000000000000000000000000000000000001001000001031000ffea61659c02c4a38d5736767bec23ab8d28753311bef7c11f68a9fd87a6f624f77dbcaea32116972ae7662dc30f9b562d5da77d9defa7040c6b2bac8644902e795c9e7b83e2f0e64662d89c1b6c54d62d20b71b000101763880ea0001000038a7000000010000000000000000000000"},
												//new Genesis {Zone = Zone.Testnet0,	Crypto = new EthereumCryptography(), Rounds = "000001020100000038a7a3cb80ec769c632b7b3e43525547ecd1f5134209d039b6b90e792450dbe8d0aa771a450b479c161b13cc0d056b46558d78b427946ed87451efca7890c0e4a2787ae4bb7f5b5c1f15372718a180f922d41b4e2fcc64030000ffea61659c02c4a38d5736767bec23ab8d2875662789e409a26ca49c583a349b69618cd1ce323fad7dafe114fb28abbaa171cd569d0615fad5d88381aacae25bbe5ce4278aa292c519319cb7e38b37dbd190961c0000000000000000000000000100fe929a68368c301a1906ed39016ee9be3d937b0008a285a2283f5c4559b49d81c80e7d32d2c3ae8e4fe1ab5ce94d87a3601befbdd276d00ce8d629b5290c7d4fdaecd16fd453338acf3645b0a2609eebbd43806ecf1c00020101090000a0dec5adc935364e2fcde5020009000040bd8b5b936b6c00840e5c222074ed3bf7e26f2f040e51d0d009f6c90bc1e61c6bec3589606bf8673e4ed0f6250f21e97e564dba4e98257670785232defbdba4e6e4cb5f49e6d04c1c00020101090000a0dec5adc935364e2fc6da020009000040bd8b5b936b6c00ec3f2cc97a33c369a3b785d524d38c4f58e22c5854a2980944f7a1521774a7fc0f4a2d6aff555487c13b5f4a8b27d844a48afc35fb0c616c4f675f78e1d3b7651b00020101090000a0dec5adc935364e2fd6ab020009000040bd8b5b936b6c00e628d45a93b75430b1ba924955295a2d9fc53393fa9aeacf7dc28977d9fc5478079268ba8f354ac45d870ecf9ca4aa3463f4a7c1f855513de2161816827667581c00020101090000a0dec5adc935364e2fd6aa020009000040bd8b5b936b6c00e140d1b584d68d63b9b050662a8bd4c8b870ac861cb53a54f7d7fb9cef4c4815105efaf9325a3836c7dadd1d493c25402361d66ba75530a7863f8bdc77a15b6b1b00020101090000a0dec5adc935364e2fd6a6020009000040bd8b5b936b6c009f3da5d161284e26e4da6d41ae8448efe12d37d13f28c2b3a22775647d6d132852053a0008390f21ca29d3e0a1cd0f669b943d1b30fe0751c1fa5ab038dfe1d51c00020101090000a0dec5adc935364e2fd6a1020009000040bd8b5b936b6c0078da1bca585a857b3d1be3e70437f215cc3ada5d8c4d9d4a80c81c05005f43b55ae193b6aec0ff4605d10d7d2dd36320a092c33fa17cedaa16ad1627d253aac91c00020101090000a0dec5adc935364e2fcc64020009000040bd8b5b936b6c00b7479d7c4c542d0893e065c3914cbaefe20993b670a96295c74c2bbb4730427e7fe95ee75d3d4d0b93589412df376eb707f55ee4ac2c0374a6428e026300ae251c0002040102756f0100020008000064a7b3b6e00d0001000101030100ffea61659c02c4a38d5736767bec23ab8d287574ec8f76c2a6aad74b33cc9c090e4ffb2d083115aee93f2ff74f8e9903fe1ae86c626956f91d1473a245e82e240b0502f4d00248b83299fe828ec52ffd6d27b41c0081d8c4bd75000000000000000000000000018a1bedb16356f1b9499dc20579bf1b3c99e12ca2b6163879eb3e83314a90047b2769a581b1d8dd7cc798f14ff0b95f730a0d087e4b4d389aa80241a648ef57361c0101050202756f02554fff02000101030200ffea61659c02c4a38d5736767bec23ab8d2875a0105130a2609cb4e8b3398fffcf86117a79a41b21eb33840398c0a99d4a41af5e529b480058a8583ebb1e8718c21b1fd831f3f9f8935b0468a404eea768717b1c00010000000000000000000000000003000101030300ffea61659c02c4a38d5736767bec23ab8d287582e47b8f8191079e282c13f9d3ae1f61270cbe5ab7dd023bb5229a3e2e0899106fda5752cd3ba9e26c6d0a20cbd7ea1366a2427f90defcd664ee5f8cd4dd8a091b00010000000000000000000000000004000101030400ffea61659c02c4a38d5736767bec23ab8d28754d4ee934e5b1fee07e55852144816ecb275b0f6c216371c243ddf33538c5c0d65c6c4e36fa87b96a8c92b25c518968d6a4672ca81c580609d46e3913b47af2b61c00010000000000000000000000000005000101030500ffea61659c02c4a38d5736767bec23ab8d2875087395248ba2561d81efa782962d2d67c4b8c8dde4028209b0b9b9aa04464daf6fe2d5ca842389014cc93468b62302d4ad09ed8f4c93f3bb8807673d4e9959e41b00010000000000000000000000000006000101030600ffea61659c02c4a38d5736767bec23ab8d28755c5936a64a3f3ac4cc982a5c485e05889126b57a835cd083ac23790ce8afb9a22686bfc02dc198cb4b8bd282ebeb4fbd002e1cb4ac2d09ba0e68bec64b774ca21b00010000000000000000000000000007000101030700ffea61659c02c4a38d5736767bec23ab8d2875c58f7bf74b5952c5a989494223b84ad06ec405114fc145355dc70839e2cab81a3e9147950d05d9fccf4e231474fdf782de2007c19a46dd51f55ddf70be312cf11c00010000000000000000000000000008000101030800ffea61659c02c4a38d5736767bec23ab8d2875c11d4c39faddaedf3091911250ef0c1479f60818ce35fb8393b4d123788121c411339bbd44f3091ab14f45fc75198bd4fd28874b37a61925d0a4decefa3334271b0001000000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000000009000101030900ffea61659c02c4a38d5736767bec23ab8d28753a9032657cc1433204da2db080d6efdf035885855811716767314226287f60937d354fec92f428a433dc69a2015395f17adeaa3101ea9eae235a803208fd0be51c0001000000000000000000000000000a000101030a00ffea61659c02c4a38d5736767bec23ab8d28754464b274f931ecc8e9c6e403e1736132c8edd28db4d195762a35c720eb3efd5928a7c762be13451ab73235acff316b6861cd1c1067ad464f24b8d7b4e089d86f1c0001000000000000000000000000000b000101030b00ffea61659c02c4a38d5736767bec23ab8d28751a1aff5d76520b5b7e35bb0cc0b6b02506535035acb0e9fedaf8b9f86cd902cf027550efdcb98ac0c84beb95a11d9d293431f930ddc71bd2096ef1569f21a12b1c0001000000000000000000000000000c000101030c00ffea61659c02c4a38d5736767bec23ab8d2875c438c8bf112e03288672771526478e44dc4de48d6f8f0a29742ab288d5f585484e16aa0f8cd907d7ebd37a16da7892d7e2120886f2b2dec17d993d8f23263dba1c0001000000000000000000000000000d000101030d00ffea61659c02c4a38d5736767bec23ab8d2875e36068edd2d27d0faa5183e98def0e080aed92cbdfb0b6bcdf343171fae5258138fe3f7c89316aa6a893386d7224cc51060e6f91ae4ad3acc6566abef1bb5ccd1b0001000000000000000000000000000e000101030e00ffea61659c02c4a38d5736767bec23ab8d2875058ee8f1d6873facda8451e53d8d82d878455967af3a651f345ddfc3b832310678c012fe3298be2f6d489952476e06e9a7d27e75c375f21f02d913ec0c8903991b0001000000000000000000000000000f000101030f00ffea61659c02c4a38d5736767bec23ab8d2875811d61eb26e70339cda975f8005e1bc36463106fc7de9f69dab085e8de3a11984f8a74cb99fa7c9f4c814a377a6b9f373622ef0dfb2b6245024b5432288e157a1b00010000000000000000000000000010000101031000ffea61659c02c4a38d5736767bec23ab8d2875bd2c9f15cfa4fb686a2c9b341c9e781f7c1026ae63622f873a2045a8e9ae25a932fd071d6607d3e0ed4d3717698d08a2454a3ff1740257521674bd1af92209ab1c00010180790a560001000038a700000001000000000000"},
												new Genesis {Zone = Zone.Testnet1, Crypto = new EthereumCryptography(), Rounds = "0000010300ffff50e1605b6f302850694291eb0e688ef156775d1fb84628783b91e8815c20c839af60c7d5d8507e6a62e8fff423923e87f34b4e55884c4a7c774fdba098795739db236ad58de8b0aaa1e7e9535bcc24c7d6641b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001eeee974ab6b3e9533ee99f306460cfc24adcdae00041b7add4e9e7ed990570ae305163200f40092ffd593dfd08ad49d432688f79cbd26a6923411f5c74317aa5d70e1ed9b41c6e6bc78a740ca25a0988950818d6cdeb1b000201010b0010357ca5997a866cd200000200090000a0dec5adc935360000ee1488d13304a1d041d891abe1056c0b187facca139024a908104a37eb95bea8770524656162498c743db94e5c7c359e19c355f8ec4fa13db398d0b54389fd3c1b000201010b0065b49dd2f741f271d200000200090000a0dec5adc9353600000bc0cd4946595852043299416d30b71003de961219f0d811ffb4b7cbd9f01299748a598655a6c59402d2bca254a2188aa3ea6bd4b15e7196cbf055228b7096821b000201010b00ba33bfff55095e77d200000200090000a0dec5adc93536000040fbda93d71e4a9d56306bab59a208f7f28996c941bcaca5eda4a67fb9f10b68340b8193f23828e30e983cbf4ce4da22e10c3ceb564a58c1bee782d978e909ca1c000201010b000fb3e02cb4d0c97cd200000200090000a0dec5adc935360000713d5a5cd7dcf4e0d05e3d86bac51c6fd7f9149f434b8e30ba25225ba06e2a551c6b33d22c8e804dd436e78c243d0ea003b9a9ccd336741041c8818c778ff8921c000201010b006432025a12983582d200000200090000a0dec5adc93536000025c882716a775cc28fea1e832d4530997f43509882354216735a04d548eeed981987c8e604e76808b2d4392a6fa4be5bd24722d7478b9d785aede5aced0c92511c000201010b00b9b12387705fa187d200000200090000a0dec5adc9353600003a756601b26173cac697fcafd4476e0bbe4ea4aa379d374d2d81537e704c75d426fc9041c97c5f01abc2264e5add63c2cab28423aa43b630db2cb0be036e810a1b000201010b000e3145b4ce260d8dd200000200090000a0dec5adc93536000043403aacd91a6c1999bf6dec210aa09978a36f61ffca46848c5efd195cbaf2802ea493fbd135f94960e1313ab6a8f7ed8bce63d1a5bf02e0519d0bbd3f1d3e681b000201010b0063b066e12cee7892d200000200090000a0dec5adc935360000d14b13f857debf05ede3cac569c71c561adf68fb77c537d2ed2b607d56231c33584922951ec2bbca217cb7d203da397871bf147b59816817247c0c0b5e34a71c1b000201010b00b82f880e8bb5e497d200000200090000a0dec5adc935360000db8a3e1a604d0d94c544a3ca3a8f116174936adb0c9346f92a592b910cf801fa7e4a265af91900a2ae6be40f72f3107312aa4d7d0203b08e9d32e5b3a811a64a1b000201010b000dafa93be97c509dd200000200090000a0dec5adc9353600001933eac39cc26b73fb6b8e4f70c8db5b8bfb0c0b4c159d79222f6bb2bb273f172ee2a34a586f4cd4a03b104a77a0bcbdb1ad55e372d714020c94cd4f58537f601c000201010b00622ecb684744bca2d200000200090000a0dec5adc935360000d101d4dc18c57d62f9cda91833af7d8ad479c2cf70a90cc725e50f9d6c6f1fd428e8a241313849a7bd8a4b87275843a318be1f3c4c16219b409b84b74842ecfb1c000201010b00b7adec95a50b28a8d200000200090000a0dec5adc935360000a76198b79775d9785d2d8d9aaa1d345c4eb5b01cdb9cc0fcb518d51699b107233c78d8a091f898a4a36f31f1d7f7346bd30c55a2c9d7c7353e610d0151e55f461c000201010b000c2d0ec303d393add200000200090000a0dec5adc93536000087c3113236e12dce46e98ef0ccbb0791e0360d7d835dfde73031bdbe2f2852293fdf576f8ef2048f79c8114e470974ff46654da2bbea5e1c5f94fd27e457e1171b000201010b0061ac2ff0619affb2d200000200090000a0dec5adc935360000610a595c58154ce06d96c55fce229fbb249de42e2f8e52ead2d4f6bbab106d9333cbbb1487d13e167adacfceb6e6b189888ed106932a02ea848b32a7647a833a1c000201010b00b62b511dc0616bb8d200000200090000a0dec5adc935360000da3cece144a930735924e8edf40009c22f04465dca95b332e5923ff94f9fa4d14a1f4073fa84d672e054c0ccd5c5b8681a5a6eec950739b6211be4a776263d8b1b000201010b000bab724a1e29d7bdd200000200090000a0dec5adc9353600007b964dadd282685f6a0be9c117550c40457bf04816485f8365631c04c0a62cae75bc5fad02b8f0f7ec953ef5ae53cc1a1b23480bbeef64227b166c23fcc8e0171b000201010b00602a94777cf042c3d200000200090000a0dec5adc935360000079b1476b66928e46d54c9abcfcd920fcfdb19436f924fee7b8a244cd41d52a84d26ebe54342436bffc3d9f373bf8beb75be1a08f7fad97888b7e677da7bd82a1c000201010b00b5a9b5a4dab7aec8d200000200090000a0dec5adc935360000680afe04f122c1477252476a35e580c147d8e179c08705b0fc69258368caa47f2f4dd52e8eb6071b854829ee6d2eb304127fe57e11f5a1f652d32c19581dc0401b000201010b000a29d7d1387f1aced200000200090000a0dec5adc9353600001bdad5565a782d567590982298360d6be648e99cc12f7caedeab68b5c1cbdbc234f08b9657c32683a5d6c06a6d9e0731f5c10e9c6fa803679a6c3bf0e84ef6e11b000201010b005fa8f8fe964686d3d200000200090000a0dec5adc9353600004d2a1d8ee856aeb468e520da5da478e8ea3dd54df455f24dcabf5a4a6726264d721b9792225800f6e18ce6a429ae6aae85aa721414cba09c93b0fd6f120d8c361b000201010b00b4271a2cf50df2d8d200000200090000a0dec5adc93536000001b8a11f65804e73bca69bbfde854d62edcf69170dcacc8c9eab0bad10a11b544c8f7ef30b2a112e22fc86ec93a1f5ca5491d391fd93a4ff26bf3c08ac9459a11c000201010b0009a73b5953d55dded200000200090000a0dec5adc93536000096b277fc177dcd0cd39f8b2246a5613cfcd6fac4646fa6e88280d04818cc784c496f54f59d67618cc1eadeaee8586ffb4d81b5d839bcc4e2474102f8d1f2f1cb1b000201010b005e265d86b19cc9e3d200000200090000a0dec5adc93536000005c784e980231cb0b762cccbb9208d815d5c195875c019d8431c9166b39b40cc781518ea00c8782fed890acba559daff8196f348b41deaca1d4657de71c12a7c1b000201010b00b3a57eb30f6435e9d200000200090000a0dec5adc935360000c34357ab5bccce4424833cc076a1333940d7550b8d09be702bba7b47dafbda48230daf469be14a6eb8f9fa3a6f9844ce050681315174e62b226d6a4a9a3058801b000201010b000825a0e06d2ba1eed200000200090000a0dec5adc935360000b97d1b5e497de836753a433a3f13988d4ec9ab4f4c244716f2c7c9f8b519ceed44b543d0cb70fe82764dc734664c514d2e73dd7b9ecfa790907d678548489d0e1b000201010b005da4c10dccf20cf4d200000200090000a0dec5adc93536000063b021bfbc49299594eca7cfde57ee4616a69b95f5892b255fda37f93ddac1f90a3e2da74f4ac8bbb3ed997b43fe0a33f0f595349043126b0ae47818a65c66b91c000201010b00b223e33a2aba78f9d200000200090000a0dec5adc935360000ff3f24810133336f9e1de52a72b7288e03e97299d3be1ab0ad05c11dd90f9f165bcd18ff0e415b1e7ddf6c93a3fd43b480935f8c681cc86bf30361b977eb83351c000201010b0007a304688881e4fed200000200090000a0dec5adc9353600002f78d9ce18e02dcb2602ddf3437df172c90bdd02205ad60dbea495456700c5956c5ceaa2a52913e4e3b522b42c9afd3e259656192d9388d1aaa94eb8b1d0370c1b000201010b005c222695e6485004d300000200090000a0dec5adc9353600007042c10356d761520c3376247aeb5bfcf88c3bbef663e8fd67dfc6ed891c7733025390ce354158492f13d200b0efcdfbe4ccf159bfb0a116adf60cfc265c21d61c000201010b00b1a147c24410bc09d300000200090000a0dec5adc935360000502cf9ae2e2575a53cca2c6c0a8c318503aee537938c9bedfcebd6049bd39159427905b6a9724667d088e5e553394b3c03f32e5ec25e6993685aab16000f47f81b000201010b00062169efa2d7270fd300000200090000a0dec5adc9353600004ac2a1e88b930eb98b6ee7ee50391a7056ca30c9b81b96a0f2371c1c2b7e94f06c453935449c8fc9536eac3aa5358bffb7a1d6ed3be7b0eb917437d7d6691c341c000201010b005ba08a1c019f9314d300000200090000a0dec5adc935360000de9757982f7226bf062641aa35e0359e67c15ad41d8603632bd6945439b4831a583e560b2f48497db0cfdda71c202eaa164ae4345e4b2931936c301b7d3752631c000201010b00b01fac495f66ff19d300000200090000a0dec5adc9353600009be19181f126dab0547a1533c9b2a7c93f54ff45c0a7e67fb2dcde2bc995838628498e519cda0f9297078b6a400a87c15579cbccc89a8f81bbe6c38ac9da92c61b000201010b00059fcd76bd2d6b1fd300000200090000a0dec5adc935360000d345e7c6101e3a139bd8b511a098d41b515593ed7090b23c74c4d45174b75df9129699542d1b4c7acaa5fd627e684a390d0e66eb23bca35479af849403fc7f2c1b000201010b005a1eefa31bf5d624d300000200090000a0dec5adc9353600005c605c96de8ddd202cb0b9afaa0b13cd6425ad2f8c83ccdda0b292fdc1fb17206d4173f28440f5391d3dc5627480042f8b05ed6af16ab8c9157a8efe12737a701b000201010b00af9d10d179bc422ad300000200090000a0dec5adc935360000b8335f8048f3e49ce4d5a6db542bbf0f201a99b89d7bd36eaf8c78911772a6526804a275ba8e9ad62f457740ae507ee87b0548d9ff45d5728f276bbbe1c1cd0f1c000201010b00041d32fed783ae2fd300000200090000a0dec5adc9353600000bb36a9b9c3b4bafafda8cf1271159a42af6fc6231e2f9c54f48d0bfe6a4032e3ea0e5c2e2159ce5d4f7234b52f0b24d5182d066df0ceb7f0819b25bc5c9f68e1b000201010b00599c532b364b1a35d300000200090000a0dec5adc935360000cba6ed7b1785c9d4f370522480a453878b2c54de05a08473caa23443e745201a49c2129af3978fec66beb20be74497f635fb7b83a8cac0f940cae91f27bbcc2d1c000201010b00ae1b75589412863ad300000200090000a0dec5adc935360000751d44931125c042ade149833df0a0831c00de562fb67f8f68fb3c548d1bfb676538cc2c0486ff0683037bc05ed28a7ba506b3ae04fbd8ae92e91a7cf905e3601c000201010b00039b9685f2d9f13fd300000200090000a0dec5adc93536000072065e28ee32390e8bbf2523d18bc6247e1b25c4e1bf1c23be6d030520060fe7641dd19a423ae44d654819ad0daf86d4416f0ffe129089efcf1aeb48a3d935ae1b000201010b00581ab8b250a15d45d300000200090000a0dec5adc935360000061621fbf3ac99a8bdc7011cfab3a71f2c0134d09061a46271bc5846188e642e438fbcc7767677041df2f307102b16c81fd4072271b8ab7dd35bfa6de00b57ef1b000201010b00ad99d9dfae68c94ad300000200090000a0dec5adc9353600005cf2cb81993e718d32fda770b63153f1103a5048cc7824c2be5de930a635b37e28e211484fceac48915e80fae3ace0bbe3e2ca08b7a057d6ddc2f46833dcd1df1c000201010b000219fb0c0d303550d300000200090000a0dec5adc9353600008c3f6765d8868eeb89e436511db95d4dcb223a2b65884d5a453f4c7636392d8c2da94944295783303fb9bcd088aab54325a27de35f61fcee5c9839498bc647941b000201010b0057981c3a6bf7a055d300000200090000a0dec5adc9353600008f4efa2b62e6e711ed51753fa88899d0ea9faf8e23cd76afb4043c818a8edaa53c029adc5fc575cc662ba9307b8d5f3db30eaaf5a8f1e30f942ad4382978b38c1c000201010b00ac173e67c9be0c5bd300000200090000a0dec5adc935360000756d40743ac8d62941efef101c4bff2aefc4964589fcc79eab695dd473510a373669d6a1f93f6d6109cce8b7b325a7b539a458b4381ad9694777433a82b68f6a1b000201010b0001975f9427867860d300000200090000a0dec5adc935360000ff1586f8efa36b0c8a233c8360ebf680edf0a60996a9b372d30bd6648648d8034deff6dfd066b826b4eaf7868b048c65fbaf41079d1a06a7cd7ac64aacf790b51c000201010b00561681c1854de465d300000200090000a0dec5adc93536000016850d0efbccfdd91e12b7d0d863f1277d532a70abc622abafd618f953279ec130749a485de5cd788aadc18634ac7fa9552f6ba54e1287a03999dca6b5c5afaf1c000201010b00ab95a2eee314506bd300000200090000a0dec5adc935360000d402ca26f1c7c1b00cff5d77f085a40fe7de95310a8854eb0ec0d9ce31f3f0822e43d02d906ab37f4391e070d3043465661791c38ba2f0e4bc176f110628f2151c000201010b000015c41b42dcbb70d300000200090000a0dec5adc93536000084712792e5271acb5966ff780a01434249d09d9f62310f8889fa084d57b54731109496b0c890ae2a890efb76a440ac6b799c50b63de4c0dbf28e93e566b08e351c000201010b005594e548a0a32776d300000200090000a0dec5adc93536000045037a8e430c6686e413582761e044ad4984e9601bbbd7e81df3d6ebfee586ab4fb33daebb1c7c704f6436d283a8a503983eb396730126d3d186ad96049ddc241c000201010b00aa130776fe6a937bd300000200090000a0dec5adc935360000cae6eec473424d1269e783283f3caf25b5f11672acd85f5d423777e87123a07e705dec499f52cfc1da6099933d9c8ddf18bbcf6953f3665ad50b511ecd01e1f01b000201010b00ff9228a35c32ff80d300000200090000a0dec5adc935360000edb0962fd4c51cf86ba2bcdb3006cfccd3c1293940e84cc22431953d940b30687dde0a0a77f78015c1b978ea49cad709eba352964e0426b3cf550fedb986cc801b000201010b0054124ad0baf96a86d300000200090000a0dec5adc93536000030c5d953eb988df538e1e19165e6400aa1fc438d5c771bfaaed2ac2e0459d806764adea081e7a1cd4258b9b85ee2f72b34c9e479bea3593fb4b62ad259c5d0dd1b000201010b00a9916bfd18c1d68bd300000200090000a0dec5adc9353600005f2b183f6d8aa12ae6d7c4f2874715c03ab6dcaf777d16d6465e10dbdb80a6d6157d433831a67dfafc4e7876df8f1c07a7ef4d12dbb5c87aacab1da2c9ce79de1c000201010b00fe108d2a77884291d300000200090000a0dec5adc935360000167063ebb0e1498e3fa1e254a89ddc4e59e2dd46e6474188f2e7ef96f77dd2431360b7a838a929ed51218fa1d392ce42531b9f130750ce3eee20574cf77ae6ba1c000201010b005390ae57d54fae96d300000200090000a0dec5adc93536000060f01558125c4b292c7ab7d46b913152676f6afef1b745dc5c5f7ce4361b7a0006cead1b40a9b8d3eb9ea8f0b91a81726700051443f1c5250606fa48f19e63e61c000201010b00a80fd08433171a9cd300000200090000a0dec5adc935360000879cfb7407b8e77a83923d5eadc3698e47100dc0e97e9bfab5f09db8c490af560a7b489a217734d39c5d8be3abb3bdedc147be14d79d66b8747eed3e2a86f27b1b000201010b00fd8ef1b191de85a1d300000200090000a0dec5adc935360000ebd968f4f265bb79cdfc9032dc16418300e5bb09bef6bf77fd82ccfe454779ea659fa6777822497243cfcdbef80d7ec9c9d5b101a083e9ee0c29ec9ecc1632ba1b000201010b00520e13dfefa5f1a6d300000200090000a0dec5adc9353600007a7dd2fdb438f36cc257a2666e366a620897e42b3321366d379c3d8208daea2a111083a879c203643b9053b8c85973ae8f10265fd5130bed8eee4d0e7fc0a0591b000201010b00a78d340c4e6d5dacd300000200090000a0dec5adc93536000059327517f89d03c9fa3eb1a136cd4b305f2e90197edddd84f41dfc3c8fe354220a0228085e4fc27d8f9d42249611da3182c04f7a20a952e25444b09d0a963d891c000201010b00fc0c5639ac34c9b1d300000200090000a0dec5adc935360000ac760527b042e178467f0b157b8782f7a2a4a0e8e78fb7d69145fb95886c8cfc262e79b9dcc58030d8278841f7cbc85eadf12388d430b2ec5904b69f8a704f8c1b000201010b00518c77660afc34b7d300000200090000a0dec5adc935360000e3078161405dca89e5044ea45a94ed4f254fb71030a871c95fd0d27d97b36be864e8a0eb83d1ee1ae36f2dc0a53b593578dc13cbbefde36b38ef3af8baa2a19f1c000201010b00a60b999368c3a0bcd300000200090000a0dec5adc9353600000ae782428ccceeef3aef74c724359541b1e1b32d5235f17576059104236921e55687dbcb727454bea1e361e36bedb702fb954cc9eb61e1042189de16f52815501b000201010b00fb8abac0c68a0cc2d300000200090000a0dec5adc9353600002b64fea40ba7bfdb5d5aa546822eb54ffeb890fb198feff9780e7f4af641fb787ac5203dfa177df55c8b229342b9b5860d97ecb1a494443b984aa6f5843415fd1b0002040102756f08000064a7b3b6e00d00020008000064a7b3b6e00d00000100010301ffff50e1605b6f302850694291eb0e688ef15677424ce9bb1e458fbfd62a5b8b3d413e5572827d7264491e24b8b3dba6435ed91b3471bde49a3eaf262c24e8db45d722d4227646277ca72defb4b0059239bccdd71c0081d8c4bd75000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d6728b42b653127548698491285db2b5f879e0e641e0ca5d945825abbe4c21f9705eacfbd2cacb4e6567e3946a07fccb289cac9e2fb4a010b139dccaa83094451c0101050202756f02554fff000200010302ffff50e1605b6f302850694291eb0e688ef15677b5136677c0278d416d6315e16525deb791316cf0fb79d1fe8aa3968edd37ff9d405bc8c99224d0e566454537d4916078147704cc6be4b90e8edef440fd883a7e1b00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300010303ffff50e1605b6f302850694291eb0e688ef156779bac4b063d7c9c8f4f0709fe68cdd88d75b449155bf2060c56a19df3953779a55b30692a56fe0d636ca4a479d0fa6741d59b83ef241bc0504a0669da808fbf861c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400010304ffff50e1605b6f302850694291eb0e688ef156773759a80048bae46a58ba270b7a6f3c52e6e7d0f353503ad1da36e26bda6e6d7437eeb2eac443c0936502aebfee1e9bd8a21e76c4d9496b07a84aa570e77edbc01c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500010305ffff50e1605b6f302850694291eb0e688ef1567795d9b64fea4460a538fc8ddd92f2f2b729a1a9ddc36a623e5f9e0898e3dc98700d3deea16b624fac129129f8196f0ec7b05f4b4fd690fe43f350deda65d82e341c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600010306ffff50e1605b6f302850694291eb0e688ef156777f1c49d89db778c835f326c0a3379f76e1d65105d81c266b93cba569c7117006348f8adb75d1ed18e1638b9be6b83f5b07d89c2d7a4997bf42c89536344b4f1b1b00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700010307ffff50e1605b6f302850694291eb0e688ef15677f13394fdb869919970a7a94e9b14a33dee30e5e8dcc3d2713be09c857bced1ec2e7ef0ae455f4538d594ff10d6a2c68aac5887917bb759d3842e1e561e70a14e1b0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080003010801a87736c81a713ef8a4e9b1d0f9a745bc001e9dfe618ba70dcfdd59df1d64ac6bfa19c7472e33e0d376b48b8552016f3977aff42d746e8277f9b78972b7ab9bfc6041c6731c010801a87736c81a713ef8a4e9b1d0f9a745bc001e9dfe618ba70dcfdd59df1d64ac6bfa19c7472e33e0d376b48b8552016f3977aff42d746e8277f9b78972b7ab9bfc6041c6731c0208ffff50e1605b6f302850694291eb0e688ef15677e8c2c3bd280d8498c80dfdf7120e621a35900141e311ec3a4298c1a5f17425b7218d855b45bd30c2ff67c03fc0ffceb143a8ebf1c35c8df8a7cfae9727615cfb1c00010000000000000000000000000000000000000000000000000000000000000000000149caafa4000000000000000000000900010209ffff50e1605b6f302850694291eb0e688ef15677c614132b3a52c95dfe984093415fbb93124d00e77ca1a9a3c4cddd1493b692846f5ea8ea329c2c8cd08f04c62b61de9b01f133194f802624b1ddae210415d2281c0001000000000000000000000000000000000000000000000000000000000000000081d8c4bd750171f3e0ef000000000000000000000a0001020affff50e1605b6f302850694291eb0e688ef156771fdf209252f5fa69c549614a42f06ec301f07feee772fadbe6a57a83726db3121c5bc792a160bc25b1149f6d289431309633152aec094e0c5d5ae0ec9f72289a1c000100000000000000000000000000000000000000000000000000000000000000000101b1bea5f9000000000000000000000b0001020bffff50e1605b6f302850694291eb0e688ef15677737563a87a60ec1bb177025f18c1ad2e5e759dad3efe123e04c1e1a4289057ae2ca54f82087edf62147cca470fad1077807ed13903e2d9029223e8338f1bbd251b000100000000000000000000000000000000000000000000000000000000000000000101919ac35d000000000000000000000c0001020cffff50e1605b6f302850694291eb0e688ef156773fac1f7f0253a3604516b9d764f01ab675714409dbdb187fc99bbea02ddefe5664bdda7ca58cf4d71b6090a86aa6335cf48afb794537f444467d4aad306962f81b00010000000000000000000000000000000000000000000000000000000000000000010150636575000000000000000000000d0001020dffff50e1605b6f302850694291eb0e688ef15677cd0125221dfad9d253cf5e8b9c03458fc51bd9e32d6fe75066115261d569224211b984d3cb87abd391cecc88bd15b8f418aef4ca5de1d28637db9c2dafa351371b0001000000000000000000000000000000000000000000000000000000000000000001010372cf80000000000000000000000e0001020effff50e1605b6f302850694291eb0e688ef156776f78b6c740d763ed25d2bfaa76e40d19863e6063a700a58bf3d418f9dd75ad8f030c1551e5960038eb2db3814bb503da8c796de6e76c43bc09f2eb4a5e5987691c00010000000000000000000000000000000000000000000000000000000000000000010104a65c32000000000000000000000f0001020fffff50e1605b6f302850694291eb0e688ef15677769caa6cf72d86eb4710545370e1da58d16548bb90218c615867d406ff7c142c0d60c3c9bf915dbcc45a41c7b451032da2d3ce6a93a1203552814b9935b5fb691c0001000000000000000000000000000000000000000000000000000000000000000001013d091206000000000000000000001000010210ffff50e1605b6f302850694291eb0e688ef1567789579ff99e44b1845805bf693acfb71758da8beb41ce7184869d8400d89a8b2b28ddde5bbbd62c75d59d1f8cd1e88961eec5f0613878aee990cb932f6fb360331b000166d23f4f5a2cc7f5f2dd6b028dc474f757504ae62bb71133bbc9712ffa99d4d5010000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000001100020211ffff50e1605b6f302850694291eb0e688ef1567743356f4870cd55b90b7af44ada69025239f869a75509ae9a5bbe3f9ab49ea172540326a6a9494592f5c49ff8d19dac6985e9eb71f3621bd1f8302458ff01c2641b00011c7940c4093ea0c8082cf8c9086ba2a60ca73ad9f84736310a0ca416c07342e60100000000000000000000000211000038a7a3cb80ec769c632b7b3e43525547ecd1e831ef468c08bf37db789afe70b648ec83010ae0f0e42f9096ead43e4f3ac67b7a0b6d119b686c97c24e52bb651533ad7d9850c7a215bad20c00996dc2db5e211b00011c7940c4093ea0c8082cf8c9086ba2a60ca73ad9f84736310a0ca416c07342e60100000000000000000000001200020212ffff50e1605b6f302850694291eb0e688ef15677324f3a13536b8faf309a24dc04b4105acbf9918ebfb60e95a7df9fe557e386d763f2bf6f94b75bc155d2af18632392ffe6e70cf7d4d6830c4a72f1433c76419f1b00011e42fdb1752f08d8d1c263e0b859713bffdbffe84ff51ba730a6ce3b8887ae860100000000000000000000000212000038a7a3cb80ec769c632b7b3e43525547ecd1d5aeb685b4615a0d5ba999f530f84310f4830b0b69b4d49c05ec852957fd33387867abeee29259acf7cfd4aef2946af9e6d942369b4a96dec2cd7db653f567f51c00011e42fdb1752f08d8d1c263e0b859713bffdbffe84ff51ba730a6ce3b8887ae860100000000000000000000001300020213ffff50e1605b6f302850694291eb0e688ef1567744ece646bd4dbad861f938e0671ca9480741bc46182d13a4115b14050c1fd29d29ee1ab23a6fcc72af2f245d06f848d55a7158d5849161787f7256018bc5b1f51c00012b24afc6be39e67759cf9d9f89ad1ce4613548108b63b38b6b82a2018668181f0100000000000000000000000213000038a7a3cb80ec769c632b7b3e43525547ecd1d04670e845a7693ab29175b970693483703d2b1d4771f0bb78e0b8de17c9c93829a073301990f4618db490e22f5f19395e2035cb39c5f0b3bf28a8ed3e9e5ee01c00012b24afc6be39e67759cf9d9f89ad1ce4613548108b63b38b6b82a2018668181f0100000000000000000000001400020214ffff50e1605b6f302850694291eb0e688ef15677962b2479863c175a969fe92ff8b2f1e0580fe233efccc1abde1d84c2c7c279465311918d0904b62f24334fb9ec9a76269b2363d3364e5207b96c953c4eda6d451c00013006deae08c80d55f42fb2cdd6f181f82c6c11c650ce75817322ff360bfc73c60100000000000000000000000214000038a7a3cb80ec769c632b7b3e43525547ecd138bb7dffcdf91566749bf0acfdd5bc3e9cd0fe05cc4580554facde7e099813af06f3cd25dac46222b8c496dd13ba8625b88a2d99dd865787517431b82d6a7e8e1c00013006deae08c80d55f42fb2cdd6f181f82c6c11c650ce75817322ff360bfc73c60100000000000000000000001500020215ffff50e1605b6f302850694291eb0e688ef156776a48e836c2c7c53a82d21f9da0dda0ee2147211c3bf0ecc79b5e918fae8766a16bb554ead68fde8038b67279c4d015592b05104e20bd9d14c30c5d49a0fecd7c1c00018ef377b588b6e9bc50f39403c0a63e1caac1b032658413a14ada59e614c594d80100000000000000000000000215000038a7a3cb80ec769c632b7b3e43525547ecd1c77a2cad114a097ee67233ec80235a60337520fb25787fca6f4955e1d9beb4773420bd3943f9fa94dfc96712f2124cf33470490272416093b89a8b89db7286bc1c00018ef377b588b6e9bc50f39403c0a63e1caac1b032658413a14ada59e614c594d80100000000000000000000001600020216ffff50e1605b6f302850694291eb0e688ef1567776808c0ee089b97b4f8ebeb2b8fa3c7977d783067555f67e70a4667635e6a93f289430ec8819561401dcb66fa40206f061b3d0f3105df035c788d17f6dbc65fa1c0001e7049c2e93c1e7465594ec7521d1ccdddee4995ecfa67d3ea2ac5f7cda92b2ff0100000000000000000000000216000038a7a3cb80ec769c632b7b3e43525547ecd1d8dc8e75710ce3db383d61a11f60893d09a89bef9b60d722337a0c00599a0ef55a0890e6445b4db5d6da13f5d0afa1bf2c901c597e742359c23a22bf824d1fad1c0001e7049c2e93c1e7465594ec7521d1ccdddee4995ecfa67d3ea2ac5f7cda92b2ff0100000000000000000000001700020217ffff50e1605b6f302850694291eb0e688ef15677e3977ad1c54951bf7cb37410c176c950be3051afc4686f78236651bb024b88f45fea7ef0eb098cc39943bcd49ee3ed5b7b97be38750f2a30a3f844f46452c4231c0001d6fad41c1ce85e1f22f407882d472433b084a825c019165f3aa74e7a8a0b80230100000000000000000000000217000038a7a3cb80ec769c632b7b3e43525547ecd1b01bdcb6e1b8cfaa3fff773cd3ba0dc66f09009b71a45df1fd1b2190737cd6b56d087712d3c84e7f1ade5e0885fa23f3c295eb32119df2a8e2f14b30ece9c7af1b0001d6fad41c1ce85e1f22f407882d472433b084a825c019165f3aa74e7a8a0b80230100000000000000000000001800020218ffff50e1605b6f302850694291eb0e688ef15677846c00451215013f03fb799866876e005ae7e50fd98f5c7562a368fc78713fa97b5c97c75d4b62b4813ec77d5bb2fc24963df738bf1d95fea8f6113099f26a561c0001adf5fa9fc75788d93f7c9189d74d215c13b8091c2e3e4d9fc58e2ccbf69b7a7e01000001000038a700000000000000000218000038a7a3cb80ec769c632b7b3e43525547ecd1d4e12b1364075b8b27d6c35f78a41c934102e375e93a807536219317a3d0028e49e362e786fa40bb6ff730ddfa5835f164e1ae605713b15c3470fb4004c9af851b0001adf5fa9fc75788d93f7c9189d74d215c13b8091c2e3e4d9fc58e2ccbf69b7a7e01000001000038a70000000000000000"},
											};

		public Round						LastConfirmedRound;
		public Round						LastCommittedRound;
		public Round						LastNonEmptyRound	=> Rounds.FirstOrDefault(i => i.Blocks.Any()) ?? LastConfirmedRound;
		public Round						LastPayloadRound	=> Rounds.FirstOrDefault(i => i.Blocks.Any(i => i is Payload)) ?? LastConfirmedRound;

		public ColumnFamilyHandle			RoundsFamily	=> Engine.GetColumnFamily(nameof(Rounds));

		public static int					GetValidityPeriod(int rid) => rid + Pitch;

		public Database(Settings settings, Log log, Vault vault, RocksDb engine)
		{
			Settings = settings;
			Log = log;
			Engine = engine;

			///GenerateFathers(256);

			Accounts = new (this);
			Authors = new (this);
			Products = new (this);
			Realizations = new (this);
			Releases = new (this);

			BaseState = Engine.Get(BaseStateKey);

			if(BaseState != null)
			{
				var r = new BinaryReader(new MemoryStream(BaseState));
		
				LastCommittedRound			= new Round(this){Id = r.Read7BitEncodedInt()};
				LastCommittedRound.Hash		= r.ReadSha3();
				LastCommittedRound.Time		= r.ReadTime();
				LastCommittedRound.WeiSpent	= r.ReadBigInteger();
				LastCommittedRound.Factor	= r.ReadCoin();
				LastCommittedRound.Emission	= r.ReadCoin();
				LastCommittedRound.Members	= Members = r.ReadList<Member>();
				LastCommittedRound.Funds	= Funds = r.ReadList<Account>();

				LoadedRounds.Add(LastCommittedRound.Id, LastCommittedRound);

				Hashify();

				if(!BaseHash.SequenceEqual(Engine.Get(__BaseHashKey)))
				{
					throw new IntegrityException("");
				}
			}

			if(Settings.Database.Chain)
			{
				var chainstate = Engine.Get(ChainStateKey);

				if(chainstate == null)
				{
					Rounds.Clear();
	
					var ips = settings.Zone.Initials;
	
					if(Settings.Dev.GenerateGenesis)
					{
						var s = new MemoryStream();
						var w = new BinaryWriter(s);

						void write(int rid)
						{
							var r = FindRound(rid);
							r.ConfirmedPayloads = r.Payloads.ToList();
							r.Hashify(r.Id > 0 ? FindRound(rid - 1).Hash : Cryptography.ZeroHash);
							r.Write(w);
						}
	
						var jr = new MembersJoinRequest(this)
									{
										RoundId	= Pitch,
										IPs		= new [] {ips[0]}
									};
// 
 						jr.Sign(Settings.Secret.Fathers[0]);
// 						jr.Write(w);

						var b0 = new Payload(this)
									{
										RoundId		= 0,
										TimeDelta	= 0,
										Reference	= RoundReference.Empty,
									};

						var t = new Transaction(Settings, Settings.Secret.OrgAccount);
						t.AddOperation(new Emission(Settings.Secret.OrgAccount, Web3.Convert.ToWei(1, UnitConversion.EthUnit.Ether), 0){ Id = 0 });
						t.AddOperation(new AuthorBid(Settings.Secret.OrgAccount, "uo", 1){ Id = 1 });
						t.Sign(Settings.Secret.GenAccount, 0);
						b0.AddNext(t);
						
						void emmit(Dictionary<Account, AccountEntry> accs)
						{
							for(int i = 0; i < ips.Length; i++)
							{
								for(int j = 0; j < Zone.GeneratorsPerIP; j++)
								{
									var f = Settings.Secret.Fathers[i * Zone.GeneratorsPerIP + j];
						
									var t = new Transaction(Settings, f);
									t.AddOperation(new Emission(f, Web3.Convert.ToWei(1000, UnitConversion.EthUnit.Ether), 0){ Id = 0 });
									
									if(accs != null)
									{
										t.AddOperation(new CandidacyDeclaration(f, accs[f].Balance - 1){ Id = 1 });
									}

									t.Sign(Settings.Secret.GenAccount, 0);
	
									b0.AddNext(t);
								}
							}

							b0.Sign(Settings.Secret.GenAccount);
							Add(b0, true);
						}
						
						emmit(null);

						Execute(Rounds.First(), Rounds.First().Payloads, null);
						var accs = Rounds.First().AffectedAccounts;
						Rounds.Clear();
						b0.Transactions.Clear();
						b0.AddNext(t);

						emmit(accs);

						b0.FundJoiners.Add(Settings.Secret.OrgAccount);
	
						write(0);
						
						for(int i = 1; i < Pitch; i++)
						{
							var b = new Payload(this)
									{
										RoundId		= i,
										TimeDelta	= i == 1 ? ((long)TimeSpan.FromDays(365).TotalMilliseconds + 1) : 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
										Reference	= RoundReference.Empty,
									};
	
							if(i == 1)
							{
								t = new Transaction(Settings, Settings.Secret.OrgAccount);
								t.AddOperation(new AuthorRegistration(Settings.Secret.OrgAccount, "uo", "UO", 255){ Id = 2 });
								t.Sign(Settings.Secret.GenAccount, i);
								b.AddNext(t);
							}
								
							b.Sign(Settings.Secret.GenAccount);
							Add(b, false);
	
							write(i);
						}
	
						Add(jr, false);

						for(int i = Pitch; i <= LastGenesisRound; i++)
						{
							var p = GetRound(i - Pitch);
	
							var b = new Vote(this)
									{
										RoundId		= i,
										TimeDelta	= 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
										Reference	= ReferTo(p)
									};

							if(i == jr.RoundId)
							{
								Add(jr, false);
							}
		
							if(i == Pitch * 2)
								b.Joiners.Add(Settings.Secret.Fathers[0]);
	
							b.Sign(Settings.Secret.GenAccount);
							Add(b, false);
	
							if(i > LastGenesisRound - Pitch)
							{
								var v = new Vote(this)
										{
											RoundId		= i,
											TimeDelta	= 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
											Reference	= ReferTo(p)
										};
	
								v.Sign(Settings.Secret.Fathers[0]);
								Add(v, false);
							}

							write(i);
						}
						
						var g = s.ToArray().ToHex();
						
						if(g != Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).Rounds)
							throw new IntegrityException("Genesis update needed");
						
						Rounds.Clear();
						//JoinRequests.Clear();
					}
	
 					var rd = new BinaryReader(new MemoryStream(Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).Rounds.HexToByteArray()));
// 
// 					var jr0 = new MembersJoinRequest(this);
// 					jr0.Read(rd);
						
					for(int i = 0; i <= LastGenesisRound; i++)
					{
						var r = new Round(this);
						r.Read(rd);
						r.Voted = true;
		
						Rounds.Insert(0, r);
				
						if(i == Pitch * 2)
						{
							r.ConfirmedJoiners.Add(new Member {Generator = SecretSettings.Father0, IPs = new [] {ips[0]}});
							r.ConfirmedFundJoiners.Add(SecretSettings.Org);
						}
	
						foreach(var p in r.Payloads)
							p.Confirmed = true;
	
						if(r.Id > 0)
							r.Time = CalculateTime(r, r.Unique);
	
						if(i <= LastGenesisRound - Pitch)
							Confirm(r, true);
					}


					//jr0.Read(new BinaryReader(new MemoryStream(Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).JoinRequest.HexToByteArray())));
	
					if(!Rounds.All(i => i.Payloads.All(i => i.Transactions.All(i => i.Operations.All(i => i.Error == null)))))
					{
						throw new IntegrityException("Genesis construction failed");
					}
				}
				else
				{
					var rd = new BinaryReader(new MemoryStream(chainstate));

					var lcr = FindRound(rd.Read7BitEncodedInt());
					
// 					w.Write(round.Time);
// 					w.Write(round.WeiSpent);
// 					w.Write(round.Factor);
// 					w.Write(round.Emission);
// 					w.Write(Members);
// 					w.Write(Funds);

					//LastConfirmedRound			= FindRound();

					for(int i = lcr.Id - lcr.Id % TailLength; i <= lcr.Id; i++)
					{
						var r = FindRound(i);

						Rounds.Insert(0, r);
		
						r.Confirmed = false;
						Confirm(r, true);
					}

					//lcr.Time		= rd.ReadTime();
					//lcr.WeiSpent	= rd.ReadBigInteger();
					//lcr.Factor		= rd.ReadCoin();
					//lcr.Emission	= rd.ReadCoin();
					//Members			= rd.ReadList<Member>();
					//Funds			= rd.ReadList<Account>();

					//Members = LastConfirmedRound.Members;
					//Funds = LastConfirmedRound.Funds;
				}
			}
		}

		public void Add(Block b, bool execute = true)
		{
			var r = GetRound(b.RoundId);

			b.Round = r;

			r.Blocks.Add(b);
			r.Blocks = r.Blocks.OrderBy(i => i is Payload p ? p.OrderingKey : new byte[] {}, new BytesComparer()).ToList();
	
			if(b is Payload p)
			{
				foreach(var t in p.Transactions)
					foreach(var o in t.Operations)
						o.Placing = PlacingStage.Placed;

				if(execute)
	 				for(int i = r.Id; i <= LastPayloadRound.Id; i++)
	 				{
	 					var ir = GetRound(i);
	 						
	 					if(ir.Payloads.Any() && ir.Previous != null)
						{
							ir.Time = CalculateTime(ir, ir.Payloads);
							Execute(ir, ir.Payloads, null);
						}
	 					else
	 						break;
	 				}
			}
	
			if(r.FirstArrivalTime == DateTime.MaxValue)
			{
				r.FirstArrivalTime = DateTime.UtcNow;
			} 


// 			if(b is MembersJoinRequest jr)
// 			{
// 				//jr.Bail = Accounts.Find(jr.Generator, b.RoundId - Pitch).Bail;
// 				JoinRequests.Add(jr);
// 			}
	
			BlockAdded?.Invoke(b);
		}

		public void Add(IEnumerable<Block> bb)
		{
			foreach(var i in bb)
			{
				Add(i);
			}
		}

		public bool Verify(Block b)
		{
			if(LastConfirmedRound != null && b.RoundId <= LastConfirmedRound.Id)
				return false;

			var r = FindRound(b.RoundId);
	
			if(r != null && r.Blocks.Any(i => i.Signature.SequenceEqual(b.Signature)))
				return false;

			//if(JoinRequests.Any(i => i.Signature.SequenceEqual(b.Signature)))
			//	return false;
		
			return b.Valid;
		}

		public Round GetRound(int rid)
		{
			var r = FindRound(rid);

			if(r == null)
			{	
				r = new Round(this) {Id = rid};
				//r.LastAccessed = DateTime.UtcNow;
				Rounds.Add(r);
				Rounds = Rounds.OrderByDescending(i => i.Id).ToList();
			}

			return r;
		}

		public Round FindRound(int rid)
		{
			foreach(var i in Rounds)
				if(i.Id == rid)
				{
					//i.LastAccessed = DateTime.UtcNow;
					return i;
				}

			if(LoadedRounds.ContainsKey(rid))
			{
				var r = LoadedRounds[rid];
				//r.LastAccessed = DateTime.UtcNow;
				return r;
			}

			var d = Engine.Get(BitConverter.GetBytes(rid), RoundsFamily);

			if(d != null)
			{
				var r = new Round(this);
				r.Id			= rid; 
				r.Voted			= true; 
				r.Confirmed		= true;
				//r.LastAccessed	= DateTime.UtcNow;

				r.Load(new BinaryReader(new MemoryStream(d)));
	
				LoadedRounds[r.Id] = r;
				//Recycle();
				
				return r;
			}
			else
				return null;
		}

		void Recycle()
		{
			if(LoadedRounds.Count > TailLength * 10)
			{
				foreach(var i in LoadedRounds.OrderByDescending(i => i.Value.Id).Skip(TailLength * 10))
				{
					LoadedRounds.Remove(i.Key);
				}
			}
		}

		public IEnumerable<Member> VoterOf(Round r)
		{
			return Members.Where(i => i.JoinedAt < r.Id);
		}

		public bool QuorumReached(Round r)
		{
			var members = VoterOf(r).Select(i => i.Generator);

			var n = r.Majority.Count(i => members.Contains(i.Generator));
			
			var q = members.Count() * 2 / 3;

			if(members.Count() * 2 % 3 != 0)
				q++;

			return q <= n;
		}

		public bool QuorumFailed(Round r)
		{
			var max = VoterOf(r).Select(i => i.Generator);

			return r.Unique.Count() >= Math.Max(1, max.Count() * 2/3) && r.Majority.Count() + (max.Count() - r.Unique.Count()) < Math.Max(1, max.Count() * 2/3);
		}

		public ChainTime CalculateTime(Round round, IEnumerable<Vote> votes)
		{
 			if(round.Id == 0)
 			{
 				return round.Time;
 			}

 			if(!votes.Any())
 			{
				return round.Previous.Time + new ChainTime(1);
			}

			///var t = 0L;
			///var n = 0;
			///
			///for(int i = Math.Max(0, round.Id - Pitch + 1); i <= round.Id; i++)
			///{
			///	var r = FindRound(i);
			///	t += r.Payloads.Sum(i => i.Time.Ticks);
			///	n += r.Payloads.Count();
			///}
			///
			///t /= n;

			votes = votes.OrderBy(i => i.Generator);

			return round.Previous.Time + new ChainTime(votes.Sum(i => i.TimeDelta)/votes.Count());
		}

		public IEnumerable<Transaction> CollectValidTransactions(IEnumerable<Transaction> txs, Round round)
		{
			//txs = txs.Where(i => round.Id <= i.RoundMax /*&& IsSequential(i, round.Id)*/);

			if(txs.Any())
			{
// 				var p = new Payload(this);
// 				p.Member	= Account.Zero;
// 				p.Time		= DateTime.UtcNow;
// 				p.Round		= round;
// 				p.TimeDelta	= 1;
// 					
// 				foreach(var i in txs)
// 				{
// 					p.AddNext(i);
// 				}
// 				
//  				Execute(round, new Payload[] {p}, null);
 	
 //				txs = txs.Where(t => t.SuccessfulOperations.Any());
			}

			return txs;
		}

		///public bool IsSequential(Operation transaction, int ridmax)
		///{
		///	var prev = Accounts.FindLastOperation(transaction.Signer, o => o.Successful, t => t.Successful, null, r => r.Id < ridmax);
		///
		///	if(transaction.Id == 0 && prev == null)
		///		return true;
		///
		///	if(transaction.Id == 0 && prev != null || transaction.Id != 0 && prev != null && prev.Id != transaction.Id - 1)
		///		return false;
		///
		///	/// STRICT: return prev != null && (prev.Payload.Confirmed || prev.Payload.Transactions.All(i => IsSequential(i, i.Payload.RoundId))); /// All transactions in a block containing 'prev' one must also be sequential
		///	return prev.Transaction.Payload.Confirmed || IsSequential(prev, prev.Transaction.Payload.RoundId);
		///}

		public IEnumerable<Account> ProposeJoiners(Round round)
		{

			var o = round.Parent.JoinRequests.Select(jr =>{
															var a = Accounts.Find(jr.Generator, LastConfirmedRound.Id);
															return new {jr = jr, a = a};
														})	/// round.ParentId - Pitch means to not join earlier than [Pitch] after declaration, and not redeclare after a join is requested
											.Where(i => i.a != null && 
														i.a.CandidacyDeclarationRound <= round.Id - Pitch * 2 &&  /// 2 = declared, requested
														i.a.Bail >= (Settings.Dev != null && Settings.Dev.DisableBailMin ? 0 : BailMin))
											.OrderByDescending(i => i.a.Bail)
											.ThenBy(i => i.a.Account)
											.Select(i => i.jr);

			var n = Math.Min(MembersMax - Members.Count, o.Count());

			//.Where(i =>	{ 
			//				var d = Accounts.FindLastOperation<CandidacyDeclaration>(i, null, null, null, r => r.Id <= round.Id);
			//				return d != null && d.Transaction.Payload.RoundId <= round.Id - Pitch*2 && d.Bail >= (Settings.Dev != null && Settings.Dev.DisableBailMin ? 0 : BailMin); 
			//			})

			return o.Take(n).Select(i => i.Generator);
		}

		public IEnumerable<Account> ProposeLeavers(Round round, Account generator)
		{
			var joiners = ProposeJoiners(round);

			var leavers = VoterOf(round).Where(i =>	i.JoinedAt < round.ParentId &&
													Rounds.Count(r =>	round.ParentId <= r.Id && r.Id < round.Id &&					/// in previous Pitch number of rounds
																		r.Votes.Any(b => b.Generator == i.Generator)) < Pitch * 2/3 &&	/// sent less than 2/3 of required blocks
													!Enumerable.Range(round.ParentId + 1, Pitch - 1).Select(i => FindRound(i)).Any(r => r.Votes.Any(v => v.Generator == generator && v.Leavers.Contains(i.Generator)))) /// not yet reported in prev [Pitch-1] rounds
										.Select(i => i.Generator);

			//if(!o.Any() && Members.Count == MembersMax && joiners.Any())
			//	leavers = Members.OrderByDescending(i => i.JoinedAt).ThenBy(i => i.Generator).Take(joiners.Take(MembersRotation).Count()).Select(i => i.Generator);
			//else
			//	leavers = o;

			return leavers;
		}

		public RoundReference ReferTo(Round round)
		{
			//if(round.Id < Pitch)
			//	return RoundReference.Empty;

			if(round.Id > LastGenesisRound && !round.Parent.Confirmed)
				return null;

			//if(!round.Payloads.Any())
			//	return null;

			var choice = round.Majority.OfType<Payload>();
			//var nonempties = choice.Where(i => i.SuccessfulTransactions.Any());

			/// take only blocks with valid transactions or take first empty block 
			var pp = (choice).OrderBy(i => i.OrderingKey, new BytesComparer());
			
			var rr = new RoundReference();

			rr.Parent		= (round.Id >= Pitch ? round.Parent.Hash : Cryptography.ZeroHash);
			rr.Payloads		= pp.						Select(i => i.Prefix).ToList();
			rr.Joiners		= round.ElectedJoiners.		Select(i => i.Prefix).OrderBy(i => i, new BytesComparer())/*.Take(rr.Leavers.Count + NewMembersPerRoundMax)*/.ToList();
			rr.Leavers		= round.ElectedLeavers.		Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.Violators	= round.ElectedViolators.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.FundLeavers	= round.ElectedFundLeavers.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.FundJoiners	= round.ElectedFundJoiners.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.Time			= CalculateTime(round, round.Votes);

			return rr; 
		}

		public void Execute(Round round, IEnumerable<Payload> payloads, IEnumerable<Account> forkers)
		{
			var prev = round.Previous;
				
			if(round.Id != 0 && prev == null)
				return;

			foreach(var b in payloads)
				foreach(var t in b.Transactions)
					foreach(var o in t.Operations)
					{
						//o.Successful = false;
						o.Error = null;
					}

			start: 

			round.Emission	= round.Id == 0 ? 0						: prev.Emission;
			round.WeiSpent	= round.Id == 0 ? 0						: prev.WeiSpent;
			round.Factor	= round.Id == 0 ? Emission.FactorStart	: prev.Factor;
			round.Members	= round.Id == 0 ? new()					: prev.Members.ToList();
			round.Funds		= round.Id == 0 ? new()					: prev.Funds.ToList();

			round.AffectedAccounts.Clear();
			round.AffectedAuthors.Clear();
			round.AffectedProducts.Clear();
			round.AffectedRealizations.Clear();
			round.AffectedReleases.Clear();

			foreach(var b in payloads.AsEnumerable().Reverse())
			{
				foreach(var t in b.Transactions.AsEnumerable().Reverse())
				{
					Coin fee = 0;

					foreach(var o in t.Operations.AsEnumerable().Reverse())
					{
						if(o.Error != null)
							continue;

						var s = round.AffectAccount(t.Signer);
					
						if(o.Id <= s.LastOperationId)
						{
							o.Error = Operation.NotSequential;
							goto start;
						}
						
						o.Execute(this, round);

						if(o.Error != null)
							goto start;

						var f = o.CalculateFee(round.Factor);
	
						if(s.Balance - f < 0)
						{
							o.Error = Operation.NotEnoughUNT;
							goto start;
						}

						fee += f;
						s.Balance -= f;
						s.LastOperationId = o.Id;
					}
						
					if(t.SuccessfulOperations.Any())
					{
						if(Settings.Database.Chain)
						{
							round.AffectAccount(t.Signer).Transactions.Add(round.Id);
						}

						round.Distribute(fee, new[]{b.Generator}, 9, round.Funds, 1); /// taking 10% we prevent a member from sending his own transactions using his own blocks for free, this could be used for block flooding
					}
				}
			}

			if(round.Id > LastGenesisRound)
			{
				var penalty = Coin.Zero;

				if(forkers != null && forkers.Any())
				{
					foreach(var f in forkers)
					{
						penalty += round.AffectAccount(f).Bail;
						round.AffectAccount(f).BailStatus = BailStatus.Siezed;
					}

					round.Distribute(penalty, round.Members.Where(i => !forkers.Contains(i.Generator)).Select(i => i.Generator), 1, round.Funds, 1);
				}
			}
		}

		public void Hashify()
		{
			BaseHash = Cryptography.Current.Hash(BaseState);
	
			foreach(var i in Accounts.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Authors.SuperClusters.OrderBy(i => i.Key))			BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Products.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Realizations.SuperClusters.OrderBy(i => i.Key))	BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Releases.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
		}

		public void Confirm(Round round, bool confirmed)
		{
			if(round.Id > 0 && LastConfirmedRound != null && LastConfirmedRound.Id + 1 != round.Id)
				throw new IntegrityException("LastConfirmedRound.Id + 1 == round.Id");

			if(!confirmed)
			{
				List<T>	confirm<T>(IEnumerable<byte[]> prefixes, Func<Vote, IEnumerable<T>> get, Func<T, byte[]> getprefix)
				{
					var o = prefixes.Select(v => round.Unique.SelectMany(i => get(i)).FirstOrDefault(i => getprefix(i).SequenceEqual(v)));
	
					if(o.Contains(default(T)))
						throw new ConfirmationException("Can't confirm, some references not found", round);
					else 
						return o.ToList();
				}
	
				/// check we have all payload blocks 
	
				foreach(var i in round.Payloads)
					i.Confirmed = false;
	
				var child = FindRound(round.Id + Pitch);
				var rf = child.Majority.First().Reference;
	 	
 				foreach(var pf in rf.Payloads)
 				{
 					var b = round.Unique.OfType<Payload>().FirstOrDefault(i => pf.SequenceEqual(i.Prefix));
 	
 					if(b != null)
 						b.Confirmed = true;
 					else
 						return;
 				}

				round.Time					= rf.Time;
				round.ConfirmedPayloads		= round.Payloads.Where(i => i.Confirmed).OrderBy(i => i.OrderingKey, new BytesComparer()).ToList();
				round.ConfirmedJoiners		= confirm(rf.Joiners,		i => i.Joiners,		i => i.Prefix).Select(i => new Member{Generator = i, IPs = round.Parent.JoinRequests.First(q => q.Generator == i).IPs}).ToList();
				round.ConfirmedLeavers		= confirm(rf.Leavers,		i => i.Leavers,		i => i.Prefix);
				round.ConfirmedViolators	= confirm(rf.Violators,		i => i.Violators,	i => i.Prefix);
				round.ConfirmedFundJoiners	= confirm(rf.FundJoiners,	i => i.FundJoiners, i => i.Prefix);
				round.ConfirmedFundLeavers	= confirm(rf.FundLeavers,	i => i.FundLeavers, i => i.Prefix);
			}
			else
				round.ConfirmedPayloads		= round.Payloads.ToList();

			Execute(round, round.ConfirmedPayloads, round.ConfirmedViolators);
			
			foreach(var b in round.Payloads)
			{
				foreach(var t in b.Transactions)
				{	
					foreach(var o in t.Operations)
					{	
						o.Placing = (b.Confirmed && o.Error == null) ? PlacingStage.Confirmed : PlacingStage.FailedOrNotFound;
#if DEBUG
						if(o.__ExpectedPlacing > PlacingStage.Placed && o.Placing != o.__ExpectedPlacing)
						{
							o.Placing = o.Placing;
						}
#endif
					}

					t.Operations.RemoveAll(i => i.Error != null);
				}

				b.Transactions.RemoveAll(t => !t.Operations.Any());
			}

			//round.Blocks.RemoveAll(b => b is Payload p && !p.Transactions.Any());

			Members.AddRange(round.ConfirmedJoiners	.Where(i => Accounts.Find(i.Generator, round.Id).CandidacyDeclarationRound <= round.Id - Pitch * 2)
													.Select(i => new Member {Generator = i.Generator, IPs = i.IPs, JoinedAt = round.Id + Pitch}));
	
			Members.RemoveAll(i => round.AnyOperation(o => o is CandidacyDeclaration d && d.Signer == i.Generator && o.Placing == PlacingStage.Confirmed));  /// CandidacyDeclaration cancels membership
			Members.RemoveAll(i => round.AffectedAccounts.ContainsKey(i.Generator) && round.AffectedAccounts[i.Generator].Bail < (Settings.Dev.DisableBailMin ? 0 : BailMin));  /// if Bail has exhausted due to penalties (CURRENTY NOT APPLICABLE, penalties are disabled)
			Members.RemoveAll(i => round.ConfirmedLeavers.Contains(i.Generator));
			Members.RemoveAll(i => round.ConfirmedViolators.Contains(i.Generator));
	 		round.Members = Members.ToList();
	
			if(round.Id <= LastGenesisRound || round.Factor == Emission.FactorEnd) /// Funds reorganization only after emission is over
			{
				Funds.AddRange(round.ConfirmedFundJoiners);
				Funds.RemoveAll(i => round.ConfirmedFundLeavers.Contains(i));
	 			round.Funds	= Funds.ToList();
			}

			using(var b = new WriteBatch())
			{
				if(Rounds.Count(i => i.Id < round.Id) >= TailLength)
				{
					var tail = Rounds.AsEnumerable().Reverse().Take(TailLength);
	
					foreach(var i in tail)
					{
						Accounts	.Save(b, i.AffectedAccounts.Values);
						Authors		.Save(b, i.AffectedAuthors.Values);
						Products	.Save(b, i.AffectedProducts.Values);
						Realizations.Save(b, i.AffectedRealizations.Values);
						Releases	.Save(b, i.AffectedReleases.Values);
					}

					LastCommittedRound = tail.Last();
	
					var s = new MemoryStream();
					var w = new BinaryWriter(s);
	
					w.Write7BitEncodedInt(LastCommittedRound.Id);
					w.Write(LastCommittedRound.Hash);
					w.Write(LastCommittedRound.Time);
					w.Write(LastCommittedRound.WeiSpent);
					w.Write(LastCommittedRound.Factor);
					w.Write(LastCommittedRound.Emission);
					w.Write(Members.OrderBy(i => i.Generator));
					w.Write(Funds.OrderBy(i => i));
	
					BaseState = s.ToArray();

					Hashify();
									
					b.Put(BaseStateKey, BaseState);
					b.Put(__BaseHashKey, BaseHash);

					foreach(var i in tail)
					{
						if(!LoadedRounds.ContainsKey(i.Id))
						{
							LoadedRounds.Add(i.Id, i);
						}
						
						Rounds.Remove(i);
					}

					Recycle();
				}

				round.Hashify(round.Id > 0 ? round.Previous.Hash : Cryptography.ZeroHash); /// depends on BaseHash 

				if(Settings.Database.Chain)
				{
					var s = new MemoryStream();
					var w = new BinaryWriter(s);

					w.Write7BitEncodedInt(round.Id);

					b.Put(ChainStateKey, s.ToArray());

					s = new MemoryStream();
					w = new BinaryWriter(s);
	
					round.Save(w);
	
					b.Put(BitConverter.GetBytes(round.Id), s.ToArray(), RoundsFamily);
				}

				Engine.Write(b);
			}

			if(round.Id > Pitch)
			{
				var cjr = FindRound(round.Id - Pitch - 1);
				
				if(cjr != null)
				{
					cjr.Blocks.RemoveAll(i => i is not Payload);
				}
			}

			//round.JoinRequests.RemoveAll(i => i.RoundId < round.Id - Pitch);
		
			round.Confirmed = true;
			LastConfirmedRound = round;
		}

		public ProductEntry FindProduct(ProductAddress product, int ridmax)
		{
			foreach(var r in Rounds.Where(i => i.Id <= ridmax))
				if(r.AffectedProducts.ContainsKey(product))
					return r.AffectedProducts[product];

			var e = Products.FindEntry(product);

			if(e != null && (e.LastRegistration > ridmax))
				throw new IntegrityException("maxrid works inside pool only");

			return e;
		}

		public Transaction FindLastPoolTransaction(Func<Transaction, bool> transaction_predicate, Func<Payload, bool> payload_predicate = null, Func<Round, bool> round_predicate = null)
		{
			foreach(var r in round_predicate == null ? Rounds : Rounds.Where(round_predicate))
				foreach(var b in payload_predicate == null ? r.Payloads : r.Payloads.Where(payload_predicate))
					foreach(var t in b.Transactions)
						if(transaction_predicate == null || transaction_predicate(t))
							return t;

			return null;
		}

		public IEnumerable<Transaction> FindLastPoolTransactions(Func<Transaction, bool> transaction_predicate, Func<Payload, bool> payload_predicate = null, Func<Round, bool> round_predicate = null)
		{
			foreach(var r in round_predicate == null ? Rounds : Rounds.Where(round_predicate))
				foreach(var b in payload_predicate == null ? r.Payloads : r.Payloads.Where(payload_predicate))
					foreach(var t in transaction_predicate == null ? b.Transactions : b.Transactions.Where(transaction_predicate))
						yield return t;
		}

		public O FindLastPoolOperation<O>(Func<O, bool> op = null, Func<Transaction, bool> tp = null, Func<Payload, bool> pp = null, Func<Round, bool> rp = null)
		{
			var ops = FindLastPoolTransactions(tp, pp, rp).SelectMany(i => i.Operations.OfType<O>());
			return op == null ? ops.FirstOrDefault() : ops.FirstOrDefault(op);
		}

		IEnumerable<O> FindLastPoolOperations<O>(Func<O, bool> op = null, Func<Transaction, bool> tp = null, Func<Payload, bool> pp = null, Func<Round, bool> rp = null)
		{
			var ops = FindLastPoolTransactions(tp, pp, rp).SelectMany(i => i.Operations.OfType<O>());
			return op == null ? ops : ops.Where(op);
		}

		public Block FindLastBlock(Func<Block, bool> f, int maxrid = int.MaxValue)
		{
			for(int i = LastNonEmptyRound.Id; i >= maxrid; i--)
			{
				var r = FindRound(i);

				if(r != null)
				{
					foreach(var b in r.Blocks)
						if(f(b))
							return b;
				}
			}
			//foreach(var r in Rounds.Where(i => i.Id <= maxrid))
			//	foreach(var b in r.Blocks)
			//		if(f(b))
			//			return b;

			return null;
		}

		public IEnumerable<Block> FindLastBlocks(Func<Block, bool> f, int maxrid = int.MaxValue)
		{
			foreach(var r in Rounds.Where(i => i.Id <= maxrid))
				foreach(var b in r.Blocks)
					if(f(b))
						yield return b;
		}

		public IEnumerable<ReleaseRegistration> FindReleases(string author, string product, Func<ReleaseRegistration, bool> f, int maxrid = int.MaxValue)
		{
			var p = FindProduct(new ProductAddress(author, product), maxrid);

			if(p == null)
				yield break;

			foreach(var r in p.Releases.Where(i => i.Rid <= maxrid).Select(i => FindRound(i.Rid).FindOperation<ReleaseRegistration>(o => o.Release.Author == author && o.Release.Product == product && o.Release.Version == i.Version)))
				yield return r;
		}
		
		public AccountInfo GetAccountInfo(Account account, bool confirmed)
		{
			var rmax = confirmed ? LastConfirmedRound : LastNonEmptyRound;

			var a = Accounts.Find(account, rmax.Id);

			if(a != null)
			{
				var i = new AccountInfo();


				i.Balance			= a.Balance;
				i.LastOperationId	= a.LastOperationId;
				//i.Authors			= a.Authors;

				if(Settings.Database.Chain)
				{
					//var t = Accounts.FindLastOperation(account, i => i.Successful, null, null, r => r.Id <= rmax.Id);

					//i.Operations = Accounts.FindLastOperations<Operation>(account, null, null, null, r => r.Id <= rmax.Id).Take(10).Reverse().Select(i => new AccountOperationInfo(i)).ToList();
				}

				return i;
			}

			return null;
		}

		public XonDocument GetAuthorInfo(string author, bool confirmed, IXonValueSerializator serializator)
		{
			var roundmax = confirmed ? LastConfirmedRound : LastNonEmptyRound;

			var a = Authors.Find(author, roundmax.Id);

			if(a != null)
			{
				return a.ToXon(serializator);
			}

			return null;
		}
				
		public QueryReleaseResult QueryRelease(ReleaseQuery query, bool confirmed)
		{
			if(query.VersionQuery == VersionQuery.Latest)
			{
				var roundmax = confirmed ? LastConfirmedRound : LastPayloadRound;
	
				var p = Products.Find(query.Realization, roundmax.Id);
	
				if(p != null)
				{
					var r = p.Releases.Where(i => i.Platform == query.Platform && i.Channel == query.Channel).MaxBy(i => i.Version);
					
					if(r != null)
					{
						var rr = FindRound(r.Rid).FindOperation<ReleaseRegistration>(m =>	(RealizationAddress)m.Release == (RealizationAddress)query.Realization && 
																							m.Release.Version == r.Version);
	
						return new QueryReleaseResult{Registration = rr};
					}
				}

				return null;
			}

			if(query.VersionQuery == VersionQuery.Exact)
			{
				var roundmax = confirmed ? LastConfirmedRound : LastPayloadRound;
	
				var p = Products.Find(query.Realization, roundmax.Id);
	
				if(p != null)
				{
					var r = p.Releases.Find(i => i.Platform == query.Platform && i.Version == query.Version);
					
					if(r != null)
					{
						var rr = FindRound(r.Rid).FindOperation<ReleaseRegistration>(m =>	(RealizationAddress)m.Release == (RealizationAddress)query.Realization && 
																							m.Release.Version == r.Version);
	
						return new QueryReleaseResult{Registration = rr};
					}
				}

				return null;
			}

			throw new ArgumentException("Unsupported VersionQuery");
		}
	}
}
