using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Net;
using System.Numerics;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;
using Nethereum.ABI.Util;
using Nethereum.BlockchainProcessing.BlockStorage.Entities;
using Nethereum.Hex.HexConvertors.Extensions;
using Nethereum.Model;
using Nethereum.RPC.Accounts;
using Nethereum.Signer;
using Nethereum.Util;
using Nethereum.Web3;
using Nethereum.Web3.Accounts;
using Org.BouncyCastle.Utilities;
using Org.BouncyCastle.Utilities.Encoders;
using RocksDbSharp;

namespace UC.Net
{
	public delegate void BlockDelegate(Block b);

	public class Database
	{
		class Genesis
		{
			public Zone			Zone;
			public Cryptography Crypto;
			public string		Rounds;
		}

		public const int					Pitch = 8;
		public const int					LastGenesisRound = Pitch*5;
		public const int					MembersMin = 7;
		public const int					MembersMax = 1024;
		public const int					NewMembersPerRoundMax = 1;
		public const int					MembersRotation = 32;
		public static int					TailLength => Settings.Dev != null ? Settings.Dev.TailLength : 1000;
		const int							LoadedRoundsMax = 1000;
		public static readonly Coin			BailMin = 1000;
		public static readonly Coin			FeePerByte = new Coin(0.000001);

		public Settings						Settings;
		public Role							Roles => (Settings.Database.Base ? Role.Base : 0) | (Settings.Database.Chain ? Role.Chain : 0);

		public List<Round>					Rounds	= new();
		public Dictionary<int, Round>		LoadedRounds = new();
		public List<Member>					Members	= new();
		public List<Account>				Funds = new();
		public List<MembersJoinRequest>		JoinRequests = new();

		public RocksDb						Engine;
		public byte[]						BaseState;
		static readonly byte[]				BaseStateKey = new byte[] {0x01};
		//public byte[]						__BaseStateHash;
		static readonly byte[]				__BaseHashKey = new byte[] {0x02};
		public byte[]						BaseHash = Cryptography.ZeroHash;
		static readonly byte[]				ChainStateKey = new byte[] {0x03};
		//static readonly byte[]				LastCommitedRoundHashKey = new byte[] {0x03};
		//public byte[]						LastCommitedRoundHash;
		public AccountTable					Accounts;
		public AuthorTable					Authors;
		public ProductTable					Products;
		public RealizationTable				Realizations;
		public ReleaseTable					Releases;
		public int							Size => BaseState == null ? 0 : (BaseState.Length + 
																			Accounts.Clusters.Sum(i => i.MainLength) +
																			Authors.Clusters.Sum(i => i.MainLength) +
																			Products.Clusters.Sum(i => i.MainLength) +
																			Realizations.Clusters.Sum(i => i.MainLength) +
																			Releases.Clusters.Sum(i => i.MainLength));
		public Log							Log;
		public BlockDelegate				BlockAdded;

		readonly static List<Genesis>		Genesises =	new()
											{
												new Genesis {Zone = Zone.Localnet, Crypto = new NoCryptography(), Rounds = "08c0a80164000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000a35909ffb424cc68c2e090645d9391a8dae4d6e6cd5e63e9e2bd724239a68c5b000000010300ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000f43253255bab0de24150900826417b46d2fd24541af4b9966c0f2e5a5450000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001eeee974ab6b3e9533ee99f306460cfc24adcdae00041003f16df410e83b29179b85e9dd852302ecee6480000000000000000000000001e1473ac50572df1249da31d66cbae7a1e3594f00b17d7aba86d2e1702ea503300000201010b0010357ca5997a866cd20001c0a8016b000200090000a0dec5adc935360000003e225e528b2da96701362aeb1ffe8e9a2eeee4000000000000000000000000b2c3cdfa064a9cb721ea71de3c046c7400fa664143294322cf0332a9b6340c9500000201010b0065b49dd2f741f271d20001c0a8016b000200090000a0dec5adc935360000003d31941151218a84e5dbd34e892bfe12fc17fa000000000000000000000000eae78317e9984a21ca6c991bed4089b18e3a0c0ddeaf589eff3aa65de978446700000201010b00ba33bfff55095e77d20001c0a8016b000200090000a0dec5adc935360000003ce1cf80589c6a8f1d87811ba70c3ab499c0fb000000000000000000000000f99381ae2c6c3107f994d4e3200137ac83fef65a81410b434e7f7d4b0fd5843d00000201010b000fb3e02cb4d0c97cd20001c0a8016b000200090000a0dec5adc935360000003b2b5f9d48ecd5c17ffcb6ca06d40a4d6fe8f40000000000000000000000000003d17cacd94b5a99fb41e8f37a82c617a0fa85a86d15a85b9aac464b86d00200000201010b006432025a12983582d20001c0a8016b000200090000a0dec5adc935360000003aa214a21ec6b3dac1737b24263b932d8ab7a6000000000000000000000000489136c78be6244488ab6fc6eb54310c03b305fae771aec29d443bc9ab19ea4000000201010b00b9b12387705fa187d20001c0a8016b000200090000a0dec5adc935360000003944480f55c0e9ecfa92307b66dc8d8fa3ccf2000000000000000000000000cccbb96c19a895b36f4c3222048bd4cff327412fab56b74b6bf1bf2b8aa5905400000201010b000e3145b4ce260d8dd20001c0a8016b000200090000a0dec5adc93536000000385115d78dbb10fb51592b13343095a84552480000000000000000000000001818ff71fab5264d4caf9445d602be2df6603527ea4c22303d33afa07902ce5300000201010b0063b066e12cee7892d20001c0a8016b000200090000a0dec5adc935360000003701a01623a94f90d172ddcc566c42555436c8000000000000000000000000a0da16024baaad63a078627eaf77d37e014a356f53c2e2389abde7469f9ecafc00000201010b00b82f880e8bb5e497d20001c0a8016a000200090000a0dec5adc93536000000360f6bf22a078d5d63dc40e9a70ede10914dd00000000000000000000000000ce28516a8c43f4be023595d1968cfbd5be253b2269b1ac4565ba379f50cc34f00000201010b000dafa93be97c509dd20001c0a8016a000200090000a0dec5adc93536000000357f7b136d5dadfccda67a1b1a6a9a3089b79c000000000000000000000000146dd71061d15c19b3e83f5c6ccbe29f0b8174ca10167a83c158731a3c2852d900000201010b00622ecb684744bca2d20001c0a8016a000200090000a0dec5adc93536000000346c2de60afe71d1f206edcfb37ba145a14f7c000000000000000000000000930d4a711c88c1203fc560ec47eb184f02bcdb5c716f840e695a1ae40b9cd79200000201010b00b7adec95a50b28a8d20001c0a8016a000200090000a0dec5adc9353600000033332d6e445a3f0007bceb644daa318c7192250000000000000000000000008a8870ca7c1f26e2e8ccb3218c169504b981d0837990fcb1f2169d9aaf80a51b00000201010b000c2d0ec303d393add20001c0a8016a000200090000a0dec5adc9353600000032910fef662934368d49e3ac4ab3848dadd989000000000000000000000000e795a6a79e4a1af6662f9bd04647fb4cecbfd66171bc383617b9d3f312b04c3300000201010b0061ac2ff0619affb2d20001c0a8016a000200090000a0dec5adc9353600000031314e891911246becee4248a1126bc80ed66b00000000000000000000000067ef4ee9db2293b4d3bc56f8d2dd9fd755a4eeca9ffb9814abcedaf0b634de3c00000201010b00b62b511dc0616bb8d20001c0a8016a000200090000a0dec5adc93536000000307118813d771de11c8305bd4991c43dbe801c000000000000000000000000e2dc76f9efaa03a37af0ad6c8a2f26a51783405d1a7f5f62b3561d4969fc3cc000000201010b000bab724a1e29d7bdd20001c0a8016a000200090000a0dec5adc935360000002f34eac76835bd6d7900dd1f49cbbc00be1bd1000000000000000000000000ed25929e8514f55c936b11eb700489a195d87eed1e68a40817d48faccb65e13200000201010b00602a94777cf042c3d20001c0a80169000200090000a0dec5adc935360000002ef6873dee1829c0ab5425239057c96edebb5100000000000000000000000060a3f2fe2ef06dd9c37abe131e15f0a3b67b6ba004d0c44589af75658460290f00000201010b00b5a9b5a4dab7aec8d20001c0a80169000200090000a0dec5adc935360000002d2d532df2b5e040a56ed7579cb4c7995cbea40000000000000000000000003ec83d051b25fd81d30e7ffdfa794e87361fd118d0a048b3bfa174252c0e691600000201010b000a29d7d1387f1aced20001c0a80169000200090000a0dec5adc935360000002cb7796cd37ced6428c72aa657867bc6996d34000000000000000000000000e407f399c00531dbce13d0df6ff204efa865f594d98a010f49b64134bac6687a00000201010b005fa8f8fe964686d3d20001c0a80169000200090000a0dec5adc935360000002b4b87efacbe56212f7169aa86d68bc1eedcc40000000000000000000000000bc0e19bd05bbd433c327a46c45c0c2b6f9c86810766f6799224d4faf0bd517200000201010b00b4271a2cf50df2d8d20001c0a80169000200090000a0dec5adc935360000002a200f1acc19708810b2dcb1659956fe544fc1000000000000000000000000c12b5ef70bf2b5b183045ad0cc0ce5ffe8126c1702bb7fe667e5cb846e9e013500000201010b0009a73b5953d55dded20001c0a80169000200090000a0dec5adc9353600000029fe288ff06811f434419459f3e0d59b9a5e46000000000000000000000000f53ff8d041afb5839eeb3b4c73ad2f2be6fd2a574b2b609199fa3a0c77da221000000201010b005e265d86b19cc9e3d20001c0a80169000200090000a0dec5adc93536000000289bb33916909a8ede99359a78eb44db523f6f000000000000000000000000304dabaa1af46438ec2a7b575ea9b8479f197f2b735a21ee71a482fc62687ded00000201010b00b3a57eb30f6435e9d20001c0a80169000200090000a0dec5adc93536000000277700cd3e813ad77fcd566d1e3937ddfc7895000000000000000000000000c80f50b6eeae5fe1d28596056c34bf695e6346d795ab0b7fcf0b435354dba40b00000201010b000825a0e06d2ba1eed20001c0a80168000200090000a0dec5adc9353600000026bf9a73fb5137d425c7660eb4d0b32be233a700000000000000000000000057de7dc8f6ddccb22660cfdbedf4cd82df793244296864887c5b54b51d5668b300000201010b005da4c10dccf20cf4d20001c0a80168000200090000a0dec5adc935360000002512e4f334decddf8babaee1f1cfc12e483c4a0000000000000000000000008737c372f1a0b9dfc786212f278838f9d43d77833582cf5d860d9af149e5cd0600000201010b00b223e33a2aba78f9d20001c0a80168000200090000a0dec5adc9353600000024ea63396bef481ebbf471d9c14a9f6e90ec330000000000000000000000007986ce03e1e67a0aacf84a6c9f5075a456885f240044197baf43fc3d8b6671de00000201010b0007a304688881e4fed20001c0a80168000200090000a0dec5adc93536000000231c41506ed20c5af3d1afe1db6feaeec150be0000000000000000000000004742b77f59c979ad7cdefcf55300fc2883ef96955b4cb45dbed5e78ad190ea4b00000201010b005c222695e6485004d30001c0a80168000200090000a0dec5adc9353600000022d37418b2e80774e43e5517c1694150f4a8c6000000000000000000000000fd1211038b0e3df525300852f6a15ccc313e18938ab432f5e6a0e1d9d907c13500000201010b00b1a147c24410bc09d30001c0a80168000200090000a0dec5adc93536000000215785d7a5694b232f07a7cb4cbbe499b28e3b0000000000000000000000004e6d18627f7b62d6e38e7535aeafc3bfba9a63a0a4682960a9a38b6b52f3cdb000000201010b00062169efa2d7270fd30001c0a80168000200090000a0dec5adc9353600000020acad6c390b8dc53972c91b3d61a9db1c4bc2000000000000000000000000aee9f2049dc7e74165c8f62fccff5863a6c35c8568f6291448c530bb39a77b1f00000201010b005ba08a1c019f9314d30001c0a80168000200090000a0dec5adc935360000001fea628d33830e5515e52fb7e3f9a009b24317000000000000000000000000025ab817dce0a21b29d5ad8beeb63e12c5abbfba3c749ee0d4391b2686ffec6700000201010b00b01fac495f66ff19d30001c0a80167000200090000a0dec5adc935360000001e4bb1c709413d815030490903e22fcfbdcfc5000000000000000000000000708fcf30fcd88ca8b20fd915b7245d57e1453ad685715ac85adea1a74cf70e6e00000201010b00059fcd76bd2d6b1fd30001c0a80167000200090000a0dec5adc935360000001d7e189d0c0d5de5e6c38df1830b391869c80b000000000000000000000000d43bf101c4e8f156d83e085f96d484bbb82b6add4541a69ab645f7e0a265105f00000201010b005a1eefa31bf5d624d30001c0a80167000200090000a0dec5adc935360000001c21c8af3f21df62eac26064c7bc88c387317e00000000000000000000000053558312158847711028db32c4c46303f9f0e0eee9fa8f3ccbf2d5441bfb4c9200000201010b00af9d10d179bc422ad30001c0a80167000200090000a0dec5adc935360000001bfc9a502b74900e404619f5d0dda9c8e7e618000000000000000000000000ed35a4a20e8fe633e572e59a829a94994c3a1e9f6e9572c2a4f9dcda0f967e7e00000201010b00041d32fed783ae2fd30001c0a80167000200090000a0dec5adc935360000001a929ef80f1e66189404aca391ebf74ad64cee00000000000000000000000041229ce1eab94d449082ce0c060b3f31eed7a60393fd0d8a5ee4c5af7c5060a500000201010b00599c532b364b1a35d30001c0a80167000200090000a0dec5adc9353600000019cbebfd57861cff6d5b469710c811804f38e0000000000000000000000000491026eb0c0e0242ce024328a4c73af05e5f3201bd88e607cacb4f5d233e673c00000201010b00ae1b75589412863ad30001c0a80167000200090000a0dec5adc935360000001886c14a86fc405d1e5946e748a0f2098435a1000000000000000000000000bc9a0c0cd265834268af045b6e772ce2d0aecbec591c21570935d5c1c09a015600000201010b00039b9685f2d9f13fd30001c0a80167000200090000a0dec5adc93536000000176268bd6c7ac0098516f3353b7c6661161311000000000000000000000000b9cfcf032bd48f2783252b0ba25d8d34d75642e09679405ce5d989ff74757dcf00000201010b00581ab8b250a15d45d30001c0a80166000200090000a0dec5adc9353600000016288f98f0ffab0def000d8013d6d49b078876000000000000000000000000b3cbe9e383fab2f88ebcb0413ce296207ec1f269d1dab77bfb2a4e3ee454ba5700000201010b00ad99d9dfae68c94ad30001c0a80166000200090000a0dec5adc9353600000015dad58fe48fcdb5c581e60666ba19a9b128ce00000000000000000000000016ed58d8a2c389857e2070da7fac7331fd9b034ec9eebec4dd63b5db1dffeb3f00000201010b000219fb0c0d303550d30001c0a80166000200090000a0dec5adc9353600000014a3e765da7ae42dd18bed6563f37a731dee47000000000000000000000000ad3215aa996b8bced77e56b9f697f3981cc08e00e24bb3deaaf727825898359800000201010b0057981c3a6bf7a055d30001c0a80166000200090000a0dec5adc93536000000139113a098c2cb09d5c317dda3ccb4401579cc000000000000000000000000f7ab22f76fe7b00269a48db49ee62e638dd059aae59deb8accfc709ea25cbafb00000201010b00ac173e67c9be0c5bd30001c0a80166000200090000a0dec5adc93536000000124f49e65f74ceeb2c6d354abc74d548d5a74d0000000000000000000000003ad2060cf65262771d6b3702e4f1babc2ae9cb4fca9ef96e7d002d0ba3cb9f8800000201010b0001975f9427867860d30001c0a80166000200090000a0dec5adc9353600000011e020c1c8613675b99c393410c6afa6bcf660000000000000000000000000b5129edc93b4b2aa2544c257a602ad86eef1496cb9a75c54c1b30ba2a1f4bdcb00000201010b00561681c1854de465d30001c0a80166000200090000a0dec5adc93536000000106216a6baa05f1f93dc44ffba20bc0d7abb46000000000000000000000000e992a19ad1a480b26a401b406c9de48b1182d41bd6a1af5ecc13a1bb4f7612d800000201010b00ab95a2eee314506bd30001c0a80166000200090000a0dec5adc935360000000ff3c7e0b5c19447d5175cb4c6641cfa61315200000000000000000000000022e16d9b822a28d0577e8bb91e701e06eaa439bec57dce4c9a7ae421aef1f41900000201010b000015c41b42dcbb70d30001c0a80165000200090000a0dec5adc935360000000ea12d3b17f96ef79ef4012db9df43a3d6da1b0000000000000000000000007a3763e34331a8fa9c5a8f820b70457c9f65805d52ec2fbf1f601dc0e892941000000201010b005594e548a0a32776d30001c0a80165000200090000a0dec5adc935360000000d381af6561f165a44680afa06e2360fd1e06000000000000000000000000055f63ff98a02db42ded9b2e2ad598620ae5061ec11cd4b60b59e2eb2a039cf6c00000201010b00aa130776fe6a937bd30001c0a80165000200090000a0dec5adc935360000000c68d29c01f7e5873a9e353ee9af4d9505be93000000000000000000000000b54d264b50e9aaf113ddfead88401af80da43a7f947b560677f3e75ab2e21aad00000201010b00ff9228a35c32ff80d30001c0a80165000200090000a0dec5adc935360000000b2dc121bd9114e7aab47754130f6148b387550000000000000000000000001c21f605a1e815dd2f0468d499e08630de8721b72f4b9595ccad86c9b776aaca00000201010b0054124ad0baf96a86d30001c0a80165000200090000a0dec5adc935360000000a52cad719404896a55f2dc2ea28dc7a6a9249000000000000000000000000f331be4b44d47480c1e11284fb7741396b23631df7ac264ab2c65872dcf8d54000000201010b00a9916bfd18c1d68bd30001c0a80165000200090000a0dec5adc9353600000009cc6575ddd868bc1476f7ea516af58125b0dd000000000000000000000000a61e1496b5ed3f9f816cc3796c117aea5f034c75fafe73621091858547da22f300000201010b00fe108d2a77884291d30001c0a80165000200090000a0dec5adc93536000000086c57b20ac627f1b04b7bf50bb27330438b6b000000000000000000000000ead59be707177ddd54bff5c97ba979f51b1fc6996164d0e77a72ce69f338500400000201010b005390ae57d54fae96d30001c0a80165000200090000a0dec5adc9353600000007f34bc43d41cf3ec2e6f684c7b9b131b04b41000000000000000000000000594263e43d4f661493b91f297bd926cdb338fd2962fd2c686f0a0d460a47a65300000201010b00a80fd08433171a9cd30001c0a80164000200090000a0dec5adc9353600000006680ad7845cfb115cd56f834385817e93999a0000000000000000000000008b67c3d210e73bcec8566517cb265e8f2c0722600e46adb03a6c36e4ad86330500000201010b00fd8ef1b191de85a1d30001c0a80164000200090000a0dec5adc9353600000005a748d15de450cd488fbed9cc3b3213f042e5000000000000000000000000e5daa45236f195c72b1abd35883c5bf0c8c239028023f776faa676d78be42f8400000201010b00520e13dfefa5f1a6d30001c0a80164000200090000a0dec5adc9353600000004761973068828923e7c811dd7f5b8eee0bae50000000000000000000000005e66734ade8b174418c678d9825f21960f67c56d69e24a070029bf34b76ef69900000201010b00a78d340c4e6d5dacd30001c0a80164000200090000a0dec5adc93536000000031174fcd4f971249e4112f925209a16813137000000000000000000000000467a3103eb4206ad86489caa64906ad11ec2064a63a400f1859d5b1be3aa90b700000201010b00fc0c5639ac34c9b1d30001c0a80164000200090000a0dec5adc9353600000002a311f7cf0aabfd3a248a89824bbd94a458a200000000000000000000000030d81156f3c125d7433f374eb54196e5fb697ac780a8139d8d9201dd53407c4c00000201010b00518c77660afc34b7d30001c0a80164000200090000a0dec5adc93536000000015326bcf44c84a605afbdd5343de4aaf1138700000000000000000000000058fbbcb4920e2a657750d9a62822f46013e6b0088fac469a7f39bad1fab8b07b00000201010b00a60b999368c3a0bcd30001c0a80164000200090000a0dec5adc935360000000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000d11b4563ec4edbbcc91eb75cef5e44689dde6a6293aa933aa71d2131cdd5d5ea00000201010b00fb8abac0c68a0cc2d30001c0a80164000200090000a0dec5adc935360000eeee974ab6b3e9533ee99f306460cfc24adcdae000000000000000000000000046b5071b4d870303b845313d0ffcaecaf78d2cfb08450e2a8d793d098c7cc870000002040102756f08000064a7b3b6e00d00020008000064a7b3b6e00d00000100010301ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000a4feed4c402be686b5c96eacc32b3009f517e2e2ec0b4e7ccf5baa2a51f8dac8000081d8c4bd75000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001eeee974ab6b3e9533ee99f306460cfc24adcdae000000000000000000000000030f87d674aa6b7008264f715849426abde0d65113ecfe224bcb39ac012117b4f000101050202756f02554fff000200010302ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000edb4498475e468f99885d90b6d270dd6d3e83e57786137dd28899ffe369639810000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300010303ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000910e97e00735306fdb380007844459442d1fd0c0d79bc29b74f46402bcb10a5a0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400010304ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000005072404ba7ae185d836459d8386554a750fbe5af0e77a5a92faae37c0b43480d0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500010305ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000996af8d18d48a445d918e93273c106f5c1a55a9a01d2fdd2e9343adc14e512580000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600010306ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000008f41c409f3013568ded53ff2970eb4607910739907de3f6f136f712b37f93f9b0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700010307ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000086904a212fe055a038b78a00c26eeb78d6565a52f332e7771369e5eb9a9857f0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800010208ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000ffcd8a291f7bf1cb4f525bb77b6dc8fcb54c58254efc38dbca24ddae0930750a00000100000000000000000000000000000000000000000000000000000000000000000001f4325325000000000000000000000900010209ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000023f8079b4a73c4995fcd9b68d278252ba2f772871cdd915093235bc1467583ab000001000000000000000000000000000000000000000000000000000000000000000081d8c4bd7501a4feed4c000000000000000000000a0001020affff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000bfd5b1264cf5fc000b88a35691f3423601aa500da6048f82ba350ce6e2c5dec700000100000000000000000000000000000000000000000000000000000000000000000101edb44984000000000000000000000b0001020bffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000ca83908ffe087d70a00735d12a65b140b5f2397d89d46a6fd47d0bd3c12c7b5800000100000000000000000000000000000000000000000000000000000000000000000101910e97e0000000000000000000000c0001020cffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000d7e5547b875cc02c9b0c1950f814da3292a4f6e77fbff1b7d65cfe81b4260dc6000001000000000000000000000000000000000000000000000000000000000000000001015072404b000000000000000000000d0001020dffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000002a323fa150667240f6f3999d8687b414fe9a3d77b075ab5b9d0f8f3b7904529c00000100000000000000000000000000000000000000000000000000000000000000000101996af8d1000000000000000000000e0001020effff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000004966348a0263a0b102d3b2f5b655cd6bd1d24748c13a838756998dace1ac9851000001000000000000000000000000000000000000000000000000000000000000000001018f41c409000000000000000000000f0001020fffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000005d4ad6fffe43c77568788a4759658bf70e4842a0bbeddba82705540346c008e200000100000000000000000000000000000000000000000000000000000000000000000101086904a2000000000000000000001000010210ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000810c2557973ba59a4b68dd770c8fa0e0b8d8bc9eb21469f77a4c63fda5db225b0000019c9b48e9dd1ca263ca62a9706387afd709fe11d4b017715e4a9f820fa0a291e2010000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000001100010211ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000004863ad4f489b777ef9846e9eee3b69f043347bd78944603bdd04420e8a9b432d0000012ac589ca35243ae7cfa562fbbab51249e2f36a65e96b39488ca7c532ae0dee620100000000000000000000001200010212ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000008bfbbab547cc2aa07793a111dd5256388fd22867e4afe95091ce0acd68f2d2a80000014d79082ddd949442fa05f47601af0e664483ffebf27906eca0905b1645d9c9e70100000000000000000000001300010213ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000007312238a4f7a0a442515978e8c6a97df2147375cf4cd33657e98f050e567b62a000001a3e06a0006f663bfda9f43afce8c60627ac247c551f8fb81859fa9160e32fdb90100000000000000000000001400010214ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000003d23aac40c3073da45afc0b0bf92da7a15f80825512b5a9614fd7e1ef05ed4fb000001a46a046dd44296f81b19c093da0f640b0ea3cdad2c3732ee84e768f52ea049e90100000000000000000000001500010215ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000084f879085232f37444897426251c32d24896694226f1a6de2d35fd1b301ba13900000126a50e85f4847ceef478dd192d7d97aca8e4e2331653c74ee29518aa7febcf370100000000000000000000001600010216ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000041ff48abe3c6fcdbaeef6d7af66a1f0129ce72e62c8e56141e6f78cdc29c289b000001852f040387dc687e56d7dd2f91ef8f91b0edcb4289ef5f32396f80b05267445f0100000000000000000000001700010217ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000921e642e4720d27822796a3e91c94cca18ff81eec9150313c7c2c1ce2d46585b000001b10d00d6e95a592f3c40e478eecc3738418f496835acc425d3da0deb4c9a91400100000000000000000000001800010218ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000002db2afaabbf7164a7db63d9dbc6c1fe7e3348da8dca7eb1092121007b898ce6d000001163e5b308c77f6b6b30eac2ee41e9a83934bb75bade35269b46449d928ccacea01000001000038a700000000000000001900010219ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000047acf5d32dc59a0649eca5465239ecdb7f30cc773e50c74252125c9a1f5199800000162b9dd75a0236958c8f2d6657b41bcf78c5ff9468dac55e0963253f3d639f2140100000000000000000000001a0001021affff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000b71bddd79e1700ecc64723d72c98f2ed3a57609b77083a96481b59bf738bfd5b000001d015e915ff8119c7dd1393b80382968bc55d6be48488a80be09cebebee3d03db0100000000000000000000001b0001021bffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000f627f1fd5038f2e21c952d0e2c493bb632790ee18e0b43c9308aba8b9588017d000001016f3520e716f475bc3b27fab8ccb46f182c188d59c577181cb2cecc3a0e485c0100000000000000000000001c0001021cffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000008a02e36e0f250644dab3b6fbe5e947c580f88322f71c983520b8fc7a25df1c94000001eda272dfe420ef7212f602f6e867de5b7cc76a3034ec0e673e9ccce4ee99a9480100000000000000000000001d0001021dffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000e71fe1384e83b3556ffd9e43f385dc41a5ee3c1494d695dc4446470f0d6e0d96000001bba1376b7a9cfa87be33f8255fee112c9c2c53de3449bf9fa1275e2214fea1810100000000000000000000001e0001021effff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000f7ddcfe40519ee5fbf893f491c755ae0bfaa0af3e870f15c28dae890dfb2189c0000013d2d25628148191966b318e2ee46638b5f2b6e64a0a270976161065d8cc75b930100000000000000000000001f0001021fffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000dd31c5a0dc8f78a9e8ec6cceff3c4eb6454619908c7dd8559e90359529e5481f0000015aecb83b408703e4e4f809defdbc64bbbba354fd79f52f6cb562eb020b29ffab0100000000000000000000002000010220ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000e997a54f21814a557da5b8cd22da72a7554cf7b83eb1203e361e27876f5e1752000001eb63d0e8c16dad201efba47bf169e623d2af7fc0b29a59e670ee4c9ab90f07060100000000000000000000002100020221ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000092202f0a137058c36e05834cf2fc5386cb82b5cfe747dba82c685258dbebc3b600000148df6b3ed791aaa617c9a2a42f76ea76cbea7098d5075358a46c7758014473360100000000000000000000000221000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd100000000000000000000000092202f0a137058c36e05834cf2fc5386cb82b5cfe747dba82c685258dbebc3b600000148df6b3ed791aaa617c9a2a42f76ea76cbea7098d5075358a46c7758014473360100000000000000000000002200020222ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000a7483afa73757ec4eaf27eb5d461d38501fb1d2c6c3154d16ff25455437e11d9000001f67ea99cb520d4ce047aac3d3d32256eaa4a87e822dc619b2fb13f49d80055cf0100000000000000000000000222000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000a7483afa73757ec4eaf27eb5d461d38501fb1d2c6c3154d16ff25455437e11d9000001f67ea99cb520d4ce047aac3d3d32256eaa4a87e822dc619b2fb13f49d80055cf0100000000000000000000002300020223ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000045dc753d5956b1b68a6822948aac22ce94d51d08c3e4684db2e9af0acd35c380000011ad9540b96bea0f16486d19789180e86545174fe4c334b5f23d42ecf55c5f6cd0100000000000000000000000223000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000045dc753d5956b1b68a6822948aac22ce94d51d08c3e4684db2e9af0acd35c380000011ad9540b96bea0f16486d19789180e86545174fe4c334b5f23d42ecf55c5f6cd0100000000000000000000002400020224ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000014b71cdd8ccb665a9a7de17c5b82b72249c650bfd2d38c05efa7297644bdc9230000013c03fe3a76f235dcf9be7f4ef0ff3e6a8c6740e3f3e96ebca6623c3f6aa9c2420100000000000000000000000224000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd100000000000000000000000014b71cdd8ccb665a9a7de17c5b82b72249c650bfd2d38c05efa7297644bdc9230000013c03fe3a76f235dcf9be7f4ef0ff3e6a8c6740e3f3e96ebca6623c3f6aa9c2420100000000000000000000002500020225ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef1567700000000000000000000000017567e2a27a0b4cf03b835f93fc71bb193bea446abb9620d641b20a10ad77de400000136419e4df8b32461f11fdf0785fd28097a7fe6b8fe3a4f7c22c7411de43300d10100000000000000000000000225000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd100000000000000000000000017567e2a27a0b4cf03b835f93fc71bb193bea446abb9620d641b20a10ad77de400000136419e4df8b32461f11fdf0785fd28097a7fe6b8fe3a4f7c22c7411de43300d10100000000000000000000002600020226ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000002a9d68f060fe841f8d0cbf36ffa15995c97cc8ae5bc5e9b6bd7207c40ee1b7b1000001a106aa82bd5a0c6e3b99152bc307db44ca221dc336b72038f11261bd238dc9910100000000000000000000000226000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000002a9d68f060fe841f8d0cbf36ffa15995c97cc8ae5bc5e9b6bd7207c40ee1b7b1000001a106aa82bd5a0c6e3b99152bc307db44ca221dc336b72038f11261bd238dc9910100000000000000000000002700020227ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef156770000000000000000000000000eee12b9396e0843b850b536804e806600a3037ccf9a91ed3cc9fb90e4883402000001e2d9ee2062deef55e81c63d2a34b656fa71c14cf954e068a10621452fa732e7d0100000000000000000000000227000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000000000eee12b9396e0843b850b536804e806600a3037ccf9a91ed3cc9fb90e4883402000001e2d9ee2062deef55e81c63d2a34b656fa71c14cf954e068a10621452fa732e7d0100000000000000000000002800020228ffff50e1605b6f302850694291eb0e688ef15677ffff50e1605b6f302850694291eb0e688ef15677000000000000000000000000bd9285247b07f7624433476fb4a803cb4b07f47aa4a63becbce8d1296cd73ca20000015c281cca034e6191287a13617cab7f46ea30de6cf8d607ef15fa5fee1eb67cbd0100000000000000000000000228000038a7a3cb80ec769c632b7b3e43525547ecd1000038a7a3cb80ec769c632b7b3e43525547ecd1000000000000000000000000bd9285247b07f7624433476fb4a803cb4b07f47aa4a63becbce8d1296cd73ca20000015c281cca034e6191287a13617cab7f46ea30de6cf8d607ef15fa5fee1eb67cbd010000000000000000000000" },
												//new Genesis {Zone = Zone.Local, Crypto = new EthereumCryptography(), Rounds = "0001000002030000ffea61659c02c4a38d5736767bec23ab8d28752118dcc5aa9c4ea5ac7a6baeb2c00fe795131249fff38aa123804415e92fc46067430454532a3445367b2f6fa24e6f0f1f71eeebf77d3f5179dbeec93eda59ea1b00000000000000000000000000000832b3d6ba18c945bbfc9baf44b52f65a449880b348520ccb42cd5fb38fc5016fe73c908ba73699e77c8c0d350ff14bc3d5f46e6d109f29cd21e4312679095a5f81b00000201090000a0dec5adc93536c0a8016a02080000c84e676dc11b000f31436863408437bf50c02865cab034aafe625d71fe4c9af7ccbbb72f7bd5b37feb8aba785eac0d60327ee7ab779525c12ee1957468336bc916c34a35273def1c00000201090000a0dec5adc93536c0a8016902080000c84e676dc11b00ae7ba257f8ae7dc6ae1c6c9a18f0947def9550a079abc02380020bea56162c37673c77412077a28c7e8e8d3803fbbdc11ff354dcf5f582d7aae42c5142a2b62e1c00000201090000a0dec5adc93536c0a8016802080000c84e676dc11b001a06703e7774c581c5f22c57e5d4ae01c7d3eb81e305ec5d32ae7521e6d53f836d9694151789a36e33dac68339f47bfe70b16c6b78fa6e8ca3ebcd44607b8ca11c00000201090000a0dec5adc93536c0a8016702080000c84e676dc11b00c97c2585746d1aed2eed862a21abeac3df1a4ceb2871429e3f40548660742159686039fdc966acc4679a8334b366c90db87333d849c5d92ed313625083f9981e1b00000201090000a0dec5adc93536c0a8016602080000c84e676dc11b006ffec6696eaf311a4e6d0b4ed03a3b8e4c7a37f8c4bd6f8e1a6568d3a58360916066f20a448846f1f5ce2fe0d494895dfc490278e38f70e94876e540f57231171b00000201090000a0dec5adc93536c0a8016502080000c84e676dc11b00e15bbcb49faa9daa8586b24aee9a1a7058b270e5325698eefb8507c7441616cf16fb8372bf549782c930b4e926affa5f30e01855a673a0142a95b730689996bb1c00000201090000a0dec5adc93536c0a8016402080000c84e676dc11b0089531e12cf910e62c26d5b8d5388527fa3d90b841955d385cfa9985482c706d054cef1778afbefa0ce61aeae488adb549b49dc29461e4348a32f6cf62d9a781a1b0000020402756f01000208000064a7b3b6e00d000100000038a7a3cb80ec769c632b7b3e43525547ecd1262509a8167f6693d39f21763f27134736a2b7ac3748f63f8bc602f7d6411ec357f4482ec576c8fca0c1e81f572ca0049461ed1c01a7cd5a1fb2fb64cdf3acf51cc0a8016400000000000101000001030100ffea61659c02c4a38d5736767bec23ab8d287515bb970258e792336b5b5a25a2776bb5545d86727877b66484e2cd938336721a6a79c88085bcefcab120b0983db1b64b6c0d3836a7a075f7672d8f96b03458b81b0081d8c4bd75000000000000000000000000011add463d846716812fb3d8992eef576e4e8aea1061a47ff5e4412fdadc32befc04e5db6b6074a017ee57b1cfce40f80f74aa7ae1b35a43212cc086bf914750c71b0101010502756f02554fff00000000000201000001030200ffea61659c02c4a38d5736767bec23ab8d2875726fa00c278d0194b0ed9b201949f2b2b579598afeeaf69a841b44149c5f9e1448ae784e390eb45adc8049beff11929d5eabfd388a29ee6713b7974541c8191a1c00010000000000000000000000000000000000000301000001030300ffea61659c02c4a38d5736767bec23ab8d28753eef6e8f4c15ddcfd8a6d7f18ed8d9f99a873523595a92a1fb4a2bc2e771bab84ddc51fcd004f55fa8a49597102d54195c18a4be6423b962bf58fa6fbe19dac61b00010000000000000000000000000000000000000401000001030400ffea61659c02c4a38d5736767bec23ab8d2875e4d286f6fd65b81e96a3612c32edcb047ee164c163fdb2443a6dbd95fde57493559f726e39eb0944f8e670005e1effe59e124e19fe9d4da5d6dc6f749c2eb7781b00010000000000000000000000000000000000000501000001030500ffea61659c02c4a38d5736767bec23ab8d28752b8041c52bc22ae8fab2e95c2a03223e84bad203db2f1bd34957e41d18a774f06a6a3e1ec12aacf994a3c8bc61d587d0984b4d223369cd38be0425f9ba9ede291b00010000000000000000000000000000000000000601000001030600ffea61659c02c4a38d5736767bec23ab8d2875511857c0b4df66d58af0c1237f1e55e3508d4232c1c9c7935b8576861ab9869c330d429aaab5587e9c19d61d4c68f0c7e5cd3223ab62ed3c09ff0f85a2d7c2be1b00010000000000000000000000000000000000000701000001030700ffea61659c02c4a38d5736767bec23ab8d2875b890b2162ca8b00993baf33d84568b67343212bf7fca18eb04e1677dd55fe7bd32e2dd35822c66d2612222a3100713eee5772719ccc244ad98480fee2292de391c00010000000000000000000000000000000000000801000001030800ffea61659c02c4a38d5736767bec23ab8d2875ee02ea3c839beb5929dc5bd7015d9a508419dffcff6d82d64fc35bb0d7c29ca66c7eaa76f023d11a5e277241b217f51458b4bbb26b695de51443b646f239131c1c0001000000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000000000000000000901000001030900ffea61659c02c4a38d5736767bec23ab8d28752d86e829f4f3467a2a7d35411992baed3f646b25bb94da7b858320e8d92e0f153b410caa15ff00f0daef27915834118842c4ee23e918f14bd384be2b14e388841c0001000000000000000000000100fe929a68368c301a1906ed39016ee9be3d937b000000000000000a01000001030a00ffea61659c02c4a38d5736767bec23ab8d2875a1ab94398ff9ed9488233381df7aec80cd239e9f60cf5d3473a07f0c87774c7932ef58a0246dde93a989f4581c8a6a98fbb550eddafdad9b76270dbf7ae86a4e1c00010000000000000000000000000000000000000b01000001030b00ffea61659c02c4a38d5736767bec23ab8d287582bd2bf95a787747a6ded0e177430b660b59e1cd8f15eedd7473197e2bfeae2f01fe94ebd4a25c5c07b203993b873df3635eea3f558c4b04b45c824f0c7f9e551b00010000000000000000000000000000000000000c01000001030c00ffea61659c02c4a38d5736767bec23ab8d28758bdd4fe8f8a51e305c1047c3cbb60f71e49e225b62a2a9d0ad24288f24d599193c624422c21ad0a689d07222eaa574ca3ab5d74d1f4ee0e7bee7ec9713964caf1b00010000000000000000000000000000000000000d01000001030d00ffea61659c02c4a38d5736767bec23ab8d28751f7cad65a8132dd003cc78f5cd2072b968eab3fbc81723412744f687570b3d381c2a4a04902125201583da4914d9a0a3f0e8ff7a8abbd458626209269a05b2091c00010000000000000000000000000000000000000e01000001030e00ffea61659c02c4a38d5736767bec23ab8d2875756b64452b2da3d326f9f457eba3ff70c2fa91dc726b0adecb867a340ae2be256b4059e38f16a4f1bc28fb7bbf341b83de39d52bf53fff3da53a52d7981a735c1c00010000000000000000000000000000000000000f01000001030f00ffea61659c02c4a38d5736767bec23ab8d287508994bf6f6ade6ea4327286abc5e5a91d7ea8877817d1f10125ea5e5d5f347f955b7c714ff44119171552674a1b3323263f201bad656719708fd30ed3ece58fc1b00010000000000000000000000000000000000001001000001031000ffea61659c02c4a38d5736767bec23ab8d28753311bef7c11f68a9fd87a6f624f77dbcaea32116972ae7662dc30f9b562d5da77d9defa7040c6b2bac8644902e795c9e7b83e2f0e64662d89c1b6c54d62d20b71b000101763880ea0001000038a7000000010000000000000000000000"},
												//new Genesis {Zone = Zone.Testnet0,	Crypto = new EthereumCryptography(), Rounds = "000001020100000038a7a3cb80ec769c632b7b3e43525547ecd1f5134209d039b6b90e792450dbe8d0aa771a450b479c161b13cc0d056b46558d78b427946ed87451efca7890c0e4a2787ae4bb7f5b5c1f15372718a180f922d41b4e2fcc64030000ffea61659c02c4a38d5736767bec23ab8d2875662789e409a26ca49c583a349b69618cd1ce323fad7dafe114fb28abbaa171cd569d0615fad5d88381aacae25bbe5ce4278aa292c519319cb7e38b37dbd190961c0000000000000000000000000100fe929a68368c301a1906ed39016ee9be3d937b0008a285a2283f5c4559b49d81c80e7d32d2c3ae8e4fe1ab5ce94d87a3601befbdd276d00ce8d629b5290c7d4fdaecd16fd453338acf3645b0a2609eebbd43806ecf1c00020101090000a0dec5adc935364e2fcde5020009000040bd8b5b936b6c00840e5c222074ed3bf7e26f2f040e51d0d009f6c90bc1e61c6bec3589606bf8673e4ed0f6250f21e97e564dba4e98257670785232defbdba4e6e4cb5f49e6d04c1c00020101090000a0dec5adc935364e2fc6da020009000040bd8b5b936b6c00ec3f2cc97a33c369a3b785d524d38c4f58e22c5854a2980944f7a1521774a7fc0f4a2d6aff555487c13b5f4a8b27d844a48afc35fb0c616c4f675f78e1d3b7651b00020101090000a0dec5adc935364e2fd6ab020009000040bd8b5b936b6c00e628d45a93b75430b1ba924955295a2d9fc53393fa9aeacf7dc28977d9fc5478079268ba8f354ac45d870ecf9ca4aa3463f4a7c1f855513de2161816827667581c00020101090000a0dec5adc935364e2fd6aa020009000040bd8b5b936b6c00e140d1b584d68d63b9b050662a8bd4c8b870ac861cb53a54f7d7fb9cef4c4815105efaf9325a3836c7dadd1d493c25402361d66ba75530a7863f8bdc77a15b6b1b00020101090000a0dec5adc935364e2fd6a6020009000040bd8b5b936b6c009f3da5d161284e26e4da6d41ae8448efe12d37d13f28c2b3a22775647d6d132852053a0008390f21ca29d3e0a1cd0f669b943d1b30fe0751c1fa5ab038dfe1d51c00020101090000a0dec5adc935364e2fd6a1020009000040bd8b5b936b6c0078da1bca585a857b3d1be3e70437f215cc3ada5d8c4d9d4a80c81c05005f43b55ae193b6aec0ff4605d10d7d2dd36320a092c33fa17cedaa16ad1627d253aac91c00020101090000a0dec5adc935364e2fcc64020009000040bd8b5b936b6c00b7479d7c4c542d0893e065c3914cbaefe20993b670a96295c74c2bbb4730427e7fe95ee75d3d4d0b93589412df376eb707f55ee4ac2c0374a6428e026300ae251c0002040102756f0100020008000064a7b3b6e00d0001000101030100ffea61659c02c4a38d5736767bec23ab8d287574ec8f76c2a6aad74b33cc9c090e4ffb2d083115aee93f2ff74f8e9903fe1ae86c626956f91d1473a245e82e240b0502f4d00248b83299fe828ec52ffd6d27b41c0081d8c4bd75000000000000000000000000018a1bedb16356f1b9499dc20579bf1b3c99e12ca2b6163879eb3e83314a90047b2769a581b1d8dd7cc798f14ff0b95f730a0d087e4b4d389aa80241a648ef57361c0101050202756f02554fff02000101030200ffea61659c02c4a38d5736767bec23ab8d2875a0105130a2609cb4e8b3398fffcf86117a79a41b21eb33840398c0a99d4a41af5e529b480058a8583ebb1e8718c21b1fd831f3f9f8935b0468a404eea768717b1c00010000000000000000000000000003000101030300ffea61659c02c4a38d5736767bec23ab8d287582e47b8f8191079e282c13f9d3ae1f61270cbe5ab7dd023bb5229a3e2e0899106fda5752cd3ba9e26c6d0a20cbd7ea1366a2427f90defcd664ee5f8cd4dd8a091b00010000000000000000000000000004000101030400ffea61659c02c4a38d5736767bec23ab8d28754d4ee934e5b1fee07e55852144816ecb275b0f6c216371c243ddf33538c5c0d65c6c4e36fa87b96a8c92b25c518968d6a4672ca81c580609d46e3913b47af2b61c00010000000000000000000000000005000101030500ffea61659c02c4a38d5736767bec23ab8d2875087395248ba2561d81efa782962d2d67c4b8c8dde4028209b0b9b9aa04464daf6fe2d5ca842389014cc93468b62302d4ad09ed8f4c93f3bb8807673d4e9959e41b00010000000000000000000000000006000101030600ffea61659c02c4a38d5736767bec23ab8d28755c5936a64a3f3ac4cc982a5c485e05889126b57a835cd083ac23790ce8afb9a22686bfc02dc198cb4b8bd282ebeb4fbd002e1cb4ac2d09ba0e68bec64b774ca21b00010000000000000000000000000007000101030700ffea61659c02c4a38d5736767bec23ab8d2875c58f7bf74b5952c5a989494223b84ad06ec405114fc145355dc70839e2cab81a3e9147950d05d9fccf4e231474fdf782de2007c19a46dd51f55ddf70be312cf11c00010000000000000000000000000008000101030800ffea61659c02c4a38d5736767bec23ab8d2875c11d4c39faddaedf3091911250ef0c1479f60818ce35fb8393b4d123788121c411339bbd44f3091ab14f45fc75198bd4fd28874b37a61925d0a4decefa3334271b0001000000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000000009000101030900ffea61659c02c4a38d5736767bec23ab8d28753a9032657cc1433204da2db080d6efdf035885855811716767314226287f60937d354fec92f428a433dc69a2015395f17adeaa3101ea9eae235a803208fd0be51c0001000000000000000000000000000a000101030a00ffea61659c02c4a38d5736767bec23ab8d28754464b274f931ecc8e9c6e403e1736132c8edd28db4d195762a35c720eb3efd5928a7c762be13451ab73235acff316b6861cd1c1067ad464f24b8d7b4e089d86f1c0001000000000000000000000000000b000101030b00ffea61659c02c4a38d5736767bec23ab8d28751a1aff5d76520b5b7e35bb0cc0b6b02506535035acb0e9fedaf8b9f86cd902cf027550efdcb98ac0c84beb95a11d9d293431f930ddc71bd2096ef1569f21a12b1c0001000000000000000000000000000c000101030c00ffea61659c02c4a38d5736767bec23ab8d2875c438c8bf112e03288672771526478e44dc4de48d6f8f0a29742ab288d5f585484e16aa0f8cd907d7ebd37a16da7892d7e2120886f2b2dec17d993d8f23263dba1c0001000000000000000000000000000d000101030d00ffea61659c02c4a38d5736767bec23ab8d2875e36068edd2d27d0faa5183e98def0e080aed92cbdfb0b6bcdf343171fae5258138fe3f7c89316aa6a893386d7224cc51060e6f91ae4ad3acc6566abef1bb5ccd1b0001000000000000000000000000000e000101030e00ffea61659c02c4a38d5736767bec23ab8d2875058ee8f1d6873facda8451e53d8d82d878455967af3a651f345ddfc3b832310678c012fe3298be2f6d489952476e06e9a7d27e75c375f21f02d913ec0c8903991b0001000000000000000000000000000f000101030f00ffea61659c02c4a38d5736767bec23ab8d2875811d61eb26e70339cda975f8005e1bc36463106fc7de9f69dab085e8de3a11984f8a74cb99fa7c9f4c814a377a6b9f373622ef0dfb2b6245024b5432288e157a1b00010000000000000000000000000010000101031000ffea61659c02c4a38d5736767bec23ab8d2875bd2c9f15cfa4fb686a2c9b341c9e781f7c1026ae63622f873a2045a8e9ae25a932fd071d6607d3e0ed4d3717698d08a2454a3ff1740257521674bd1af92209ab1c00010180790a560001000038a700000001000000000000"},
												new Genesis {Zone = Zone.Testnet1,	Crypto = new EthereumCryptography(), Rounds = "08a87736c85d042c8419045308fc523a9f6ff5f0f587bb45875da81bfaf5765b5e207d9c16551d9c9c86a23884b37ce591802bf24c902261a8e83777f4e11466faf863cba21c0000010300ffff50e1605b6f302850694291eb0e688ef1567716f266fc12c00f1e43f3f13bc6ec729e96076c8e196cf016e311885225be59975ef9f99ec797488323cc6347a2bd861793d204e77dde9ca17946d319ee77aa011c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001eeee974ab6b3e9533ee99f306460cfc24adcdae0004164d58a6e4d69da802cddd066b0c636049e35049b1d5b6e15f21e413aa1d5bee86c462c2c12b96887d40b79a770a6d0e877564f20463f39a3818e349bbc941d551b000201010b0010357ca5997a866cd200014e2fcde50200090000a0dec5adc9353600df31d15ae830e1bdd3cded16a157eb4fdcec545a1cdae8cd3c61fc51e3601cac11821167c8e9b9ce4fac035cd997986c228d7a4f07f202db40e1f6a158394c781c000201010b0065b49dd2f741f271d200014e2fcde50200090000a0dec5adc9353600ec8e86ad1e60fcee0419ff3d030b926bd718236d4ead45f7888eba545d989fb0490aa280b775494a2722ae1fb060ee1fabbe33274677b67129740e3a957392c51b000201010b00ba33bfff55095e77d200014e2fcde50200090000a0dec5adc9353600ab178a4ee95d53490accec4d2f9f5655101094e942c12c4692baf35b61ea33f154f8947f07358d55770ed5b65982c4d75f5aaf81b95388fd2fb6dd19880284481c000201010b000fb3e02cb4d0c97cd200014e2fcde50200090000a0dec5adc9353600f72d5491d11b2e93def7743a22a7fe63e55cbe5043179c1aca2042d4f2ee51924b1988dda2a87a6ea17f386c858d9787b1faf748db38296e18ff3a73f70567351b000201010b006432025a12983582d200014e2fcde50200090000a0dec5adc935360001ade01090edbe958a9422b967697204b481f2890dca77d3988d3650ff64fe45424ffd1d162adca80641e9dcd31f5e8aa062640f1ad4818107bcb1a6e026b99d1b000201010b00b9b12387705fa187d200014e2fcde50200090000a0dec5adc9353600f65eac40560ab76877df7b8ddf606e6d12b14c73fea6ba35fb9556085d581cc7600b522ace95a50b00a2ca415af3c02fc1263ecb05556b69771f7fc66777b9581c000201010b000e3145b4ce260d8dd200014e2fcde50200090000a0dec5adc9353600a5f76f5e5ffb1fc854c3f4c50b65fb437c666dc40b3a9bfaee15c8713525e19d23837237dfb4bb6b5a93791650ec4b62520d0f94e713d09bb5aa6c6e19b146b61c000201010b0063b066e12cee7892d200014e2fcde50200090000a0dec5adc93536000dc62eaeff58947f07da79a78b60924387a7be1bfe4a8d628d0668939ef31eba24fa22fe0eb24270e2c1c06c75ba3d9eb51da36a8a90137d730d9dd60ff9bd941b000201010b00b82f880e8bb5e497d200014e2fc6da0200090000a0dec5adc9353600da91629602163649d4e6842d6f9099585fb25ae654a0f9a109714321c5094d30299d9964f48d49a9d0de06b950c61aeff4af7be30dde420795346de3ca48ee761b000201010b000dafa93be97c509dd200014e2fc6da0200090000a0dec5adc93536006c823be118637c0ac8679806eb0a2ace00932d7f76ed348142d417e0e2d3f08e1836fc859541a4e94a408c368e51482564ab8748e0437a859d8b06706e8a5cfe1b000201010b00622ecb684744bca2d200014e2fc6da0200090000a0dec5adc9353600eb00b99622ff9d84261b201c8262ef82788cab65c5ab2d5dd1218463bfeb57f03b2e54dcf11a84c0ab5b0b51d776e97edba72e1a5a33fd0d003a789e2ed4de8a1b000201010b00b7adec95a50b28a8d200014e2fc6da0200090000a0dec5adc935360088aac1641959281dd2a9f8c8a3b499771b33a7600992ed12a272c42ce943c4296dc84939294a34792e08ca83994ac449d4a18e695329eb36c1c2f478f9debab11c000201010b000c2d0ec303d393add200014e2fc6da0200090000a0dec5adc9353600d2b2f80f86ec8a0757a235a05cd8e987681aa1c290139a8da8dc28c6bad0f8316ac74c2ee6dbaa5eecbacc6df75d404f96158cecf7b423b45193cd03603789441b000201010b0061ac2ff0619affb2d200014e2fc6da0200090000a0dec5adc9353600497a5f335bb88d25dc53848bbc19847e3847cffb146657ff34b9f2d246db1dab32647da416306cfa998be2152d61c34dfcfc0ab26c785530787fa9a6783345fd1c000201010b00b62b511dc0616bb8d200014e2fc6da0200090000a0dec5adc9353600b1a0b7540ea4a076a3409200b46ce57077b0523e212a638c6906c0f94381472d7a7bb78f3e3556a7fef03330644821bcf14a2005ad26d61e1ae709fac8bbe6d01c000201010b000bab724a1e29d7bdd200014e2fc6da0200090000a0dec5adc9353600b0f28cce7d73a5b71beb90cb2cc12be89df9b34aa0720cd5db72238aa46545895dc94c97a19c8998120ec26dddf8d6855d94c9a2f20ee5577876cca1caaab6111b000201010b00602a94777cf042c3d200014e2fd6ab0200090000a0dec5adc935360036c61e39866ddb401633186ca99ec2d8c162ae81f390141b51517017b1d0a9535587face942dafccc9420a10b918cf9ced5e944a4e7ce2f005d0ffe13d37e8501b000201010b00b5a9b5a4dab7aec8d200014e2fd6ab0200090000a0dec5adc93536003dad71ae1483595dbb788631a1eea26849a3d4517b314ded6bd04ce2b209e19a78f546a14850162edb408d873ddcb31515fd0f0a72d2570cbfa77920a75da75f1c000201010b000a29d7d1387f1aced200014e2fd6ab0200090000a0dec5adc93536001ce3658e94399d471894478f9441bda7b0779cc26355b409c7a0da4dd2556ff54e5af6439f5f30f7e166ee5734d77631e76918e0465c2236e333e0fa906cb9c21b000201010b005fa8f8fe964686d3d200014e2fd6ab0200090000a0dec5adc9353600a5578832ff4b1e753e940a39bf0554975121fec84ca2df78f41f6b3dd3f5ba3727d9199e8639dc04e7f26f6ed41af6c0520b84c1af526923272136d2149e728f1b000201010b00b4271a2cf50df2d8d200014e2fd6ab0200090000a0dec5adc9353600dd5b6c1bfc45f3d5cf4813f215ee025d9cf40c505d7daabf0883f11a28b7fa6718e9c151d1bd1f5d05edd84dc253ab0fe8710cdc0ac90ecf361e1656911249d41b000201010b0009a73b5953d55dded200014e2fd6ab0200090000a0dec5adc935360090e28cde73729490d9a0056186e27d40fcb60c487e15cfc7b59f7e6c406db7c44ca9fd3b376aba53a4f8c8954bd3d4e2b7a1e1eca30dbc540fff2b7267c4059d1c000201010b005e265d86b19cc9e3d200014e2fd6ab0200090000a0dec5adc9353600a36bf3d6332c6bb6cdf7e48b7df99cd69d60734f43227cc2dfcac262849ec626589cbfc1a5fd66a52b3793f83037859f0a12db1e86912f305749997a4a57854b1c000201010b00b3a57eb30f6435e9d200014e2fd6ab0200090000a0dec5adc9353600ebde3f67fe9c2af89ee774c7c23ceec0c07f224201853cabfd79f2eadbc6cfbe2b1d8cabc3ce4d3ef57ba87a548847a3a673aa3442bfe4580683e66493b81f2d1b000201010b000825a0e06d2ba1eed200014e2fd6aa0200090000a0dec5adc9353600598f2ae6b83ea79e6b23299de92c187c38fbcf165fbb85b44733ca0cf4bd390a74723f54681d3c72e3765dbf9797f5dd32a992742d6e2d1e60bc5b5f00865e851b000201010b005da4c10dccf20cf4d200014e2fd6aa0200090000a0dec5adc93536001af024f05ad03f9cb5e87688b4feb252eba0d15c856fb947bd05cc2cd86f4be90ae423694e03cf4209b6f8d90c716562be40c9c295a3b6bf5374d903af7aad7e1b000201010b00b223e33a2aba78f9d200014e2fd6aa0200090000a0dec5adc93536006e8c723eb17b67ab27746bd6360b239ec22f8ea27b9c80de2446645d6df88e8002b303c95abc32281c3f2781c8b5b7fb1a628b3d0a92d77861dc76eb2d66e71f1b000201010b0007a304688881e4fed200014e2fd6aa0200090000a0dec5adc9353600c4f86bd31313246bba9e3451128f62bb67121315d2fa7438ee711a74f2365d9004a46ff59be3b6fe04b8360719d3bfc683c3194e1d3c9719ceb150b5850e1b8e1c000201010b005c222695e6485004d300014e2fd6aa0200090000a0dec5adc9353600bd7188eb709ca4c1a9e38675f1c979f68dc7dbcbdb9e2758f75f4c13a9af37832d28eb8903dfdd89d9edf1d0786b9f3e6cd796859cd94d597fc5404ff0d5429f1c000201010b00b1a147c24410bc09d300014e2fd6aa0200090000a0dec5adc93536007b3e80bdb24eb98764e1ce78467fbe6b843896529d355aeea285b1fed73e62744500e96a40619bdd93cd1d9cdc3027d91aa9ce32ed10d327ee369a23c2187b6c1b000201010b00062169efa2d7270fd300014e2fd6aa0200090000a0dec5adc935360089c96d492f5fec3790043903c682d11ae29abfdc897a7d9f93edb458daa7ac8e496010e6f16091ca699fc1a84df67e559c77a3726f4cb334765165f019d65f381b000201010b005ba08a1c019f9314d300014e2fd6aa0200090000a0dec5adc935360073ec0f8c337e496093ee80f2ef843f92c7c1d0819d0a0ae37051d3875d1ca134428333bb6a8712dd1937ceb13454d96e2abd62c763995abdf8eb8ad49ff2ed061c000201010b00b01fac495f66ff19d300014e2fd6a60200090000a0dec5adc93536008d34b5dc57b5b1aae1355cd62719faaf1fe5763b4a960bd60a5e78d07e2922430ab2fb54c7ad8694bf7d290548bac802ab79d96f0fb6929118aa0f9d6675476f1b000201010b00059fcd76bd2d6b1fd300014e2fd6a60200090000a0dec5adc9353600c7651f9545467d9fd9220f078fba16236c07c6aaf8a09085a35547930b56fef1276c8c22bf9495e3425fdbdfdfbc38317434f996ecbde9ec2a35c8bea5b3b1f01c000201010b005a1eefa31bf5d624d300014e2fd6a60200090000a0dec5adc9353600617e671a794ee6d4180325264a2c0397beda5b6d5d15dabcf62d5b87f00ff76a6a456d255cf132eb5cfe0316b767482f974dc68ea6a173551d4b90d306ad996c1b000201010b00af9d10d179bc422ad300014e2fd6a60200090000a0dec5adc93536007399e7a66e0edcc8dbe172a56ebb5d56807ab0aa91104bf5749cea5c8fdf2edd478c0dcf082ba3d84dacef0e4f322cb1f183a83d880deb7f49f1b148ef2eda2a1c000201010b00041d32fed783ae2fd300014e2fd6a60200090000a0dec5adc93536006a787e60f87717dd2eaa7670ca9c0c37528a6504713b6047bee92e04ce1ce055472c9573db9e13f8f0a170f6ef52ac7878fc70655a0e65b4594573a1078d6c911b000201010b00599c532b364b1a35d300014e2fd6a60200090000a0dec5adc935360028d193f92770e6d112e916d8e87b1f3118e6eded3ecd56471b84133979edba8f53a5cbc4988de1bc5b123d4a83ec8c876c9df160e919cc9b6b278f7f71aecc1c1c000201010b00ae1b75589412863ad300014e2fd6a60200090000a0dec5adc9353600545bd0615f2d13ed8c00544463d81f9cc56994437980b9eeb355763a5eac3ef526f2935e06bc9646e65bee2b86d4758dc4ae599e7289e4059ba419e601c280201c000201010b00039b9685f2d9f13fd300014e2fd6a60200090000a0dec5adc93536005292cf4f66788fe5665fdb86ba2b3f9ef8079637c9ee5b7c03cc971a780004f2429bca5688fc2cf880bad654bbaf896142f50f58a3abed5d791d16ba88dd64971c000201010b00581ab8b250a15d45d300014e2fd6a10200090000a0dec5adc9353600af55f7130ebcf01999e623676b16c90a6e878c38ed2d98ea9616471c710f23ea27a65e9539f4e0a2f4130d65aa5335245ec59a5fab2a6f79307e66e8a97262901b000201010b00ad99d9dfae68c94ad300014e2fd6a10200090000a0dec5adc93536005d570d86e70b34721c9e99aedb07fc4ec8d21c65129459b2c0081f187c7d4de516d737d5765cab2f6e862527abb452930e2485824ff60db8a404e270d55c2ac11b000201010b000219fb0c0d303550d300014e2fd6a10200090000a0dec5adc935360028f108603da0c877e52383b2c15b6086088985149d4b933d43738630ec89cf1b2e51e1909962ccf2a14ff67626153373ff62e523feaeb8947657ad9f2e8f9c0d1b000201010b0057981c3a6bf7a055d300014e2fd6a10200090000a0dec5adc935360064ae8b346bbacae91df7e6221ca3d6e217d1ea0bcaa9e99558563450c2a860ec4027d30e63d52c05261b58c9c4ee14453f523cf55d8402779fb7f36b853ecc841b000201010b00ac173e67c9be0c5bd300014e2fd6a10200090000a0dec5adc9353600b2bb1b329f93665dfd39f415bf5cc0be38dd8d53b84abf64f8109cb6bdc3d8831859e34550a94346eff1090cc825062484f632822a557c3c6b3ee8f11ba6de571b000201010b0001975f9427867860d300014e2fd6a10200090000a0dec5adc9353600ec4309f1a6e279e49aebbdc5ef3945d8c0b4e164eb3c94822c8371102eadb7bf55bde2b1a7d8b42c65d6fea091ec8702ff0f62b06eae624318b912b64bec25ab1c000201010b00561681c1854de465d300014e2fd6a10200090000a0dec5adc9353600b7e366f350b2f61ad63718969033357c171470b12242b6e13619fbe09a1e2573120ee304fd3f1ee3c0be5446362244c286f74be3fb251c78dadfbfd0fa1317871c000201010b00ab95a2eee314506bd300014e2fd6a10200090000a0dec5adc9353600ee724222f958b0912bf0973ff4165a50059526f6466af42878f76c73ea41518208ef2813bd4a46e495daea1ab85a4811188380e5df3828ff70a68cbfb68a31051c000201010b000015c41b42dcbb70d300014e2fcc640200090000a0dec5adc935360034435aa82d68f348189a8a449c52f8c1541c82b09dbd5781211ac740cdc3772644da0dfc2da1338fb549b8af42a7bdc803fd4cffbb96849732fdb80627424b091c000201010b005594e548a0a32776d300014e2fcc640200090000a0dec5adc9353600d193bc3dbe452329408ada5726697c5ae4fbc7086e53ef41fdb67f006686d64b20f3387d3c03dbba83238fe454159f00f44878e497eb72b5de5b69fb46c8b7dd1c000201010b00aa130776fe6a937bd300014e2fcc640200090000a0dec5adc9353600604dfcaf68b1a76c7370e03064c78a68d3893c2472e93df731d747035f3807cd0cffd6d1c250395d5d494da756859ed48370c86e4340872b303988aae56dd5d21b000201010b00ff9228a35c32ff80d300014e2fcc640200090000a0dec5adc9353600148948b0d014f1addbc468ab1da5c136f2414195dfae8e59bbb6a3f80e6a7c334cd842baeeaa489300ce615ed49eb244dae23888550326fb592375ea304c2c6b1b000201010b0054124ad0baf96a86d300014e2fcc640200090000a0dec5adc9353600e2964182e0a3fcbee29d561d8bb1892072459a643f7560a2c9bbb9953cfbd1b708c1069f2eda5e8916e48c0951982ae8c42259e5042f76f30dc219c1d8d4551f1c000201010b00a9916bfd18c1d68bd300014e2fcc640200090000a0dec5adc9353600fd8fbf1a079724c100d293da0298fa1aa476ef0b949d391980fbcf1f0e2d14b173c74e82fa3ee07b937505d7ecbbf0e2b127dcab4223e6d7dada1cc2fb15a9291b000201010b00fe108d2a77884291d300014e2fcc640200090000a0dec5adc9353600021079b63c601c2bbf8d04286c01ff550f6d723658a9539603c10ff1627f901813283ff2b9123a7147db20c5a1bbde4e4beb3ad687a75051cce6270c6822b0ab1b000201010b005390ae57d54fae96d300014e2fcc640200090000a0dec5adc9353600b9ff0b6d04635d73911f1a8094632501ffb3e12db468e11da51ea9300675d90c5966f27d4007650db304a5a29a303a55e6c6c65effa7e3d735e8dd482af88c051c000201010b00a80fd08433171a9cd30001a87736c80200090000a0dec5adc935360002245a55622c43239136a0ad10edb1cf8dfd5c13fbbed3cf3bc1d19888360f616654af6938893fe64c48524de34d5fe9af6221710369c24e95345bc488370f201b000201010b00fd8ef1b191de85a1d30001a87736c80200090000a0dec5adc9353600891c2fb1d2d5c2525d0f3cd196b272086cbcd10117da222c074eb3ea012434c024e6350fd6594e2046586921e9a5c9b58c01a7fa27d33d7cb46f2057f4aad3361b000201010b00520e13dfefa5f1a6d30001a87736c80200090000a0dec5adc93536007b65dc2ba5d126a951e4001525f58c548f3e3e8835a03b67838b26acff56ca9b77f24781ed697aaeb2f13fecba92bda9ef958a50496fecc59ad0620f4699f1011b000201010b00a78d340c4e6d5dacd30001a87736c80200090000a0dec5adc935360015c9f56c64f34e734207b3f71541314409bebc4d498f4cb84b2470d1ceb3f50b6f7d64aca1884c04b17eb5bebe746c78838244150406c9a37d2954a2af77a2531c000201010b00fc0c5639ac34c9b1d30001a87736c80200090000a0dec5adc9353600076e3ff13faf12752e2713fd5dff0d9a245a3133bcf223bb2008a1aaa87e52924d0416c3c4c6bf8d193f52d1b568d8ee05bc655254f707358fc745de47b779ee1c000201010b00518c77660afc34b7d30001a87736c80200090000a0dec5adc9353600152b7525307059222742dc1adf3c7e2dd3de77a2d70b1c755d938557a0ac90d826816dc9ea8f9b724d8917d88c274185a81d384be35333be9827bee089ea71271b000201010b00a60b999368c3a0bcd30001a87736c80200090000a0dec5adc9353600b1f44d95bd47c34e49a4eabf1bb37f98472c40d48d3d7f926958315bfed554b626cfbc34c26fd51a67e0106212696e9597e2de43ac353eb75be28a5a9ed2b4e01b000201010b00fb8abac0c68a0cc2d30001a87736c80200090000a0dec5adc9353600905e95596084605987b7133bf382568778435d6ad355a2be6cc5ff4d5e429ab462607ebb7e908601ff4e04e04317c561b1074e8651d68db81b431e4d81058cf41b0002040102756f08000064a7b3b6e00d020008000064a7b3b6e00d000100010301ffff50e1605b6f302850694291eb0e688ef156779a57bb8833ec7ff43d2a433f62490219d4caed40ebccdac78b2b8cb480db3b070f70d03efbd3ded9c7126c5a8459fa29e287f1db7ff581307265fa77cf947b8e1c0081d8c4bd7500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000184309ea942d2cec813462b7f27a48c9ef0dd59a09038a666e96417fdcf8d8ab64d1ff9b20803f3d6469aadb9c47d390bff3ef5d2fb38d246ea563be40c650b891b0101050202756f02554fff0200010302ffff50e1605b6f302850694291eb0e688ef15677b5136677c0278d416d6315e16525deb791316cf0fb79d1fe8aa3968edd37ff9d405bc8c99224d0e566454537d4916078147704cc6be4b90e8edef440fd883a7e1b00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300010303ffff50e1605b6f302850694291eb0e688ef156779bac4b063d7c9c8f4f0709fe68cdd88d75b449155bf2060c56a19df3953779a55b30692a56fe0d636ca4a479d0fa6741d59b83ef241bc0504a0669da808fbf861c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400010304ffff50e1605b6f302850694291eb0e688ef156773759a80048bae46a58ba270b7a6f3c52e6e7d0f353503ad1da36e26bda6e6d7437eeb2eac443c0936502aebfee1e9bd8a21e76c4d9496b07a84aa570e77edbc01c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500010305ffff50e1605b6f302850694291eb0e688ef1567795d9b64fea4460a538fc8ddd92f2f2b729a1a9ddc36a623e5f9e0898e3dc98700d3deea16b624fac129129f8196f0ec7b05f4b4fd690fe43f350deda65d82e341c00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600010306ffff50e1605b6f302850694291eb0e688ef156777f1c49d89db778c835f326c0a3379f76e1d65105d81c266b93cba569c7117006348f8adb75d1ed18e1638b9be6b83f5b07d89c2d7a4997bf42c89536344b4f1b1b00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700010307ffff50e1605b6f302850694291eb0e688ef15677f13394fdb869919970a7a94e9b14a33dee30e5e8dcc3d2713be09c857bced1ec2e7ef0ae455f4538d594ff10d6a2c68aac5887917bb759d3842e1e561e70a14e1b00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800010208ffff50e1605b6f302850694291eb0e688ef156776bef94bc655a9925bb366251a0338efa557135187c1a86179810ca796f451ad1535db87c2d5a3b9d61cdbe6656cab89697ea5573105c892716443dde32b9ec551c00010000000000000000000000000000000000000000000000000000000000000000000199cd31dc000000000000000000000900010209ffff50e1605b6f302850694291eb0e688ef156779a09ad8f4e3dc5c5c0fca0e2ab74d9ce69b21b2490fa577ad9beb78ef36bb24846a5957c04452c0513422b3924b9eb96ad3fc805672c95e279631b14567813721b0001000000000000000000000000000000000000000000000000000000000000000081d8c4bd7501c342a6ec000000000000000000000a0001020affff50e1605b6f302850694291eb0e688ef156771fdf209252f5fa69c549614a42f06ec301f07feee772fadbe6a57a83726db3121c5bc792a160bc25b1149f6d289431309633152aec094e0c5d5ae0ec9f72289a1c000100000000000000000000000000000000000000000000000000000000000000000101b1bea5f9000000000000000000000b0001020bffff50e1605b6f302850694291eb0e688ef15677737563a87a60ec1bb177025f18c1ad2e5e759dad3efe123e04c1e1a4289057ae2ca54f82087edf62147cca470fad1077807ed13903e2d9029223e8338f1bbd251b000100000000000000000000000000000000000000000000000000000000000000000101919ac35d000000000000000000000c0001020cffff50e1605b6f302850694291eb0e688ef156773fac1f7f0253a3604516b9d764f01ab675714409dbdb187fc99bbea02ddefe5664bdda7ca58cf4d71b6090a86aa6335cf48afb794537f444467d4aad306962f81b00010000000000000000000000000000000000000000000000000000000000000000010150636575000000000000000000000d0001020dffff50e1605b6f302850694291eb0e688ef15677cd0125221dfad9d253cf5e8b9c03458fc51bd9e32d6fe75066115261d569224211b984d3cb87abd391cecc88bd15b8f418aef4ca5de1d28637db9c2dafa351371b0001000000000000000000000000000000000000000000000000000000000000000001010372cf80000000000000000000000e0001020effff50e1605b6f302850694291eb0e688ef156776f78b6c740d763ed25d2bfaa76e40d19863e6063a700a58bf3d418f9dd75ad8f030c1551e5960038eb2db3814bb503da8c796de6e76c43bc09f2eb4a5e5987691c00010000000000000000000000000000000000000000000000000000000000000000010104a65c32000000000000000000000f0001020fffff50e1605b6f302850694291eb0e688ef15677769caa6cf72d86eb4710545370e1da58d16548bb90218c615867d406ff7c142c0d60c3c9bf915dbcc45a41c7b451032da2d3ce6a93a1203552814b9935b5fb691c0001000000000000000000000000000000000000000000000000000000000000000001013d091206000000000000000000001000010210ffff50e1605b6f302850694291eb0e688ef15677d061578cd0a7def34e0e3eb130c1b8785d0d3bdd8ebcb82fc352197175f8b0d57dc0661830acf499be1f8028fa79a7719e755df867d56b93188755262788dfab1b0001367c1adbe217708fe33c5917e48673881a396a79ad9ba452ca585f3258e0a467010000000000000001000038a7a3cb80ec769c632b7b3e43525547ecd10000001100010211ffff50e1605b6f302850694291eb0e688ef15677a0d25ea9d75213602f51037093910d455c2d9020d90fe63801e4c7031b5b5d2e7856203217aa01576c776a8c0948aff84229262359a7802909b406b63da633b51c0001a5664d5d1ac474af958206908f48b895de41f2bdaccc97fd480b7b8229c436f10100000000000000000000001200010212ffff50e1605b6f302850694291eb0e688ef15677f44d83dae5d4355fc166d957d90317a8d550d83c372d27babb1fb6773d3fe8480841e290030f27bdadbdd57e11588bf14bcb7b63ed51f823e44c700409c730b21b0001eb91a9e44d8fff2cf148a30fcf3625fd4e4cdce1a30ba2c3b8abd4844fe296790100000000000000000000001300010213ffff50e1605b6f302850694291eb0e688ef156772426831d9988bbf549d85251c3eb274a8646a419f9dbdbe991e12796aaaf835d7ed506d3d27e82e0ae0f95bccafaba3c1555611befd868fdb7349017fab3cdd01b0001309a89c5191115696d2803f22dac2505d43d962cfbd2bd8d6281e9b91c6d97b20100000000000000000000001400010214ffff50e1605b6f302850694291eb0e688ef156774d64c797d57be2e57e9376950c5e242fcce5daf5002b8d26f2214d94ec3fcc506d71b55bb4364f1c6511e600d83da421afe29847437a41a8552647fe682cd39a1c00018cc995de8378c7be29fc3f52aa07f59c37c275d63da4a4cd9d907857759df6dd0100000000000000000000001500010215ffff50e1605b6f302850694291eb0e688ef15677e2313bcdd743d9af1c3cc5253e33acac8076f89026274fcfd05db84ae41aab510da4bccbae378d6097782278cb23eafc7f96753de646969a7d6d2eaf650682031b00011671cfc7a9ccb740fe9945cd7868580806f67752825c1f37abf44718246b29170100000000000000000000001600010216ffff50e1605b6f302850694291eb0e688ef1567785cab30d8dec78f1b9f55deee34aaaf00c269f64b18e6c06f46425b0b9232eb106b5ceb6ca5705de24b35781fdc7b3d179034df307a7718c787a25a0e3b97eef1b000193997df839ba553ffc5ccaa1e34b7d1a84e1e9d722cd6ee0c7c6b8b443906be00100000000000000000000001700010217ffff50e1605b6f302850694291eb0e688ef15677b56de6988ea05dae042ca21c635ff3886d1d9066e519b6e5cc45f845c224ac0a35c98b1387cfc093dfbe46af06c59d7e5c98e6ca4631d6f327373f9caca2f9171c000131bcc5a24af21c9d405cd93e450dd0eb057cab42ec4d236650f970af71b4cfe70100000000000000000000001800010218ffff50e1605b6f302850694291eb0e688ef156775c5f38dc8319c24600dea99dd001af3f8c3c6b470376b598ff5a88e5eb5e35a43461b85432f043071cb839552089eb3e761ee30dcd36fa65e4c24816d6a09ff21b0001fb339b4fbc5ebe369392fe23269ae82ac96674c63e4de029c294a5cfd5af3c4f01000001000038a700000000000000001900010219ffff50e1605b6f302850694291eb0e688ef156777df475f517e47467783be33f4026f644b680d91510557bc61960bf256ee199e1054165f2fb91a7393ecd6519c5be7f33dc1c07189d3ac06350234eb1808a8b991b0001f7f5886a8a4dbc9e2d9c438b1f7b4e2229831bb0dd91038f52651713fe3038210100000000000000000000001a0001021affff50e1605b6f302850694291eb0e688ef15677cab6ab688a217cf60539afd6fd08139f9ec6ba3c4886f1aca65e8e9a4a88529a68f65a1ae71acc014db9ed6d202afec4f7de2486403f645491dcfea57548eda91c0001a8768174e9ac95afd371162e2cee7ea949f89b1900bbddb160b73a26ba29fb750100000000000000000000001b0001021bffff50e1605b6f302850694291eb0e688ef15677ad60723a149f979dae32eab27e8fd007f5ba682062cff4810a7640788f75565a06da204edd4ad43ba37363e55b6eaf0885c7f646c2988311db718b887d54203b1c0001aaeca78c3efced49f87843f3223259a93733f0a46da6183d21ffe32ce33d759e0100000000000000000000001c0001021cffff50e1605b6f302850694291eb0e688ef1567727dcc3d7b8935c0dc53eed8b742a2b857d6a544c6a6e6cc8da56e11322d11e0b202fc2059c5aeb3a0cde5ad9899bdd877ef4da1b7471fa1094d3a222caff6df81c00015334b8d6a5ff2409fb2a5ac9ed9fa6916f6f26710b27b228c06556cc05af7d9f0100000000000000000000001d0001021dffff50e1605b6f302850694291eb0e688ef156776730a5022977d040c26a63ed8a1bafff801a214a4d9f04e135f11e085afd066726bbbcaf7fe1da5beb7f4b541e06d421859234e865cc36a436555648935ebe4b1b0001b392f0717009e813f18af6c043e683bf52910dac0ad9795492da4f3891bcb6cd0100000000000000000000001e0001021effff50e1605b6f302850694291eb0e688ef156778c2789224f9f00b7fa57f71f8832d5f9e58eb97ea97e58e92b34b62dd0b20ff97b3d6373c9df9535ea60956581cc61fa7e52770652b74a67cfd889fa89b37e361c0001afdeefe4925132f99b504887656f5bccc3d71688e17d11398f0b5e810b8cd2930100000000000000000000001f0001021fffff50e1605b6f302850694291eb0e688ef156775b44e79f686cc3b33afcf7e287a74d2eefbdc3f577a8768c320088ceffea3b700538651fd15cbadbaecfc15a0a36c0c737237f2399eafac603a785d1b4b272831b0001c447838a694dc077ee9c6530846da61d8a5b45170312492a08c049ecc1b2b9200100000000000000000000002000010220ffff50e1605b6f302850694291eb0e688ef15677332ebb389086f8582804f6d83b29951984e89598d7c589643be5cd9cba9f96a434ddca4421c4a65777c5886d4e425c3ac89760f83045185c805afdfcf5cc1c701c0001fb91f02edbc655364aaf6a7f93e8633abc7dc59475213b75ef6d8ac6592251ff0100000000000000000000002100020221ffff50e1605b6f302850694291eb0e688ef15677c1edaf37c0e2dc2a7217e4ee5a157518079a6594b35c8edd7bfe1982ebb66ce50c041b51082cb7aed6c3f1ee622f90f7b61546b2e4900b8cc50ec4afc5eb18251c0001e375a7d696bbd67cb8d414318be6d3bb31dbb3d5831da6783dc50d558d5dd6fe0100000000000000000000000221000038a7a3cb80ec769c632b7b3e43525547ecd1e477221a1633e7b9d7f28662b02a3734634846774457e4427d14eadf9817891225a06f073770597074aa2e2ba758daae0cbc6d2c2651a613a6f9358aa812a5b81b0001e375a7d696bbd67cb8d414318be6d3bb31dbb3d5831da6783dc50d558d5dd6fe0100000000000000000000002200020222ffff50e1605b6f302850694291eb0e688ef15677dd22021943f27586906f0afcd5b7b3db43c1a119af6919530e507e88355710f05e3e478b284560bacc969013cf10866618510c8867cb2db0876268460cdd486b1c0001b1c7b38e90b3ed2bb1a7478adb028f10754e7379d223ce2654c61fde3fe8c0e30100000000000000000000000222000038a7a3cb80ec769c632b7b3e43525547ecd159bf5846e2f26526dd0a6968e761c71a846a1f128be4e45be841dc860ca3f3812007f73601f38cda33ef9f857b1e54d32c102128ba69af1a4af3a20f7c2b9d621b0001b1c7b38e90b3ed2bb1a7478adb028f10754e7379d223ce2654c61fde3fe8c0e30100000000000000000000002300020223ffff50e1605b6f302850694291eb0e688ef15677c62f7f103889c66b33122ee91233235deb105144a7a7394d6955200b54ec55f038642f5db4d38f6b8cfd702fbac6944885dfb12c819e5e028ec1601b0bb61ee31c00013b3fef0027bc7c8f1568e49b3da7a6fad1cc2d749c1a7b7f70cae95db0ff910a0100000000000000000000000223000038a7a3cb80ec769c632b7b3e43525547ecd1a8deefca0184696c938e04c1eb4a35afacfac264f4ef8733ce9ef19a4186da580dfbc783e32a01aeb455dfc2ad8e0f64d3ac5eb1ac5e2a3e6db6b53e2b5ab90e1c00013b3fef0027bc7c8f1568e49b3da7a6fad1cc2d749c1a7b7f70cae95db0ff910a0100000000000000000000002400020224ffff50e1605b6f302850694291eb0e688ef156779ba5ca08da8b5cacb3a8f1d8745695e36713e2ec76c7b9fcfa105d239a78eba37808e7c8358677e25a5ded486d649d258e3f1433606e757a7b38ff866c3865261c000135738c83f1719d577a4f85adca7e022e33a2c051c09cdc048b2fda2188ec2e4b0100000000000000000000000224000038a7a3cb80ec769c632b7b3e43525547ecd10e2746ceed36c0624190d60dd3a06915e6db657f9afd03ac854d25579d5f8de15b76689fac58f6254d052e84e2c91255e7e4c3f34e4d66d5c54b94c74eaefd851b000135738c83f1719d577a4f85adca7e022e33a2c051c09cdc048b2fda2188ec2e4b0100000000000000000000002500020225ffff50e1605b6f302850694291eb0e688ef156772ef8e5b3df29f609887ef1c05643409b8e20c9101f18fe2b58464c1c3c1de99231f30eff97af50eebd8506880f37b1ad0efc0244a6b16286a54e6d9a5ba4b24f1b00011b98c5889beb1d4af62fb937da3e06cb8ab035b0384879b8f5ffb83d52da892f0100000000000000000000000225000038a7a3cb80ec769c632b7b3e43525547ecd1f5c0ddc29e08d08ce0ea0c5773c551aebf0c174509a94fb371f1e50c83434f0a529fb31ebd29c6917d26e71978f3c3f6aa5c234a6836c69edbce56a1191c06f81b00011b98c5889beb1d4af62fb937da3e06cb8ab035b0384879b8f5ffb83d52da892f0100000000000000000000002600020226ffff50e1605b6f302850694291eb0e688ef15677d20160a73460de72fd0014e9e5cdd26c9987c778b586d39838173d749eb45e813385c140d1b578460b62fea27b2ab8137f9c5b14f567ffce5f7d202ec7023c761b0001ad3ebcc90278bb1c57915e1f319ebc18da6bfc1bc553225dc02607608a70067b0100000000000000000000000226000038a7a3cb80ec769c632b7b3e43525547ecd1dbd1d00bf45043159999a0804b4c1af60d91dcf7185e44f1d9561b0fc86cf13f446e70bd2076f567cea6df5596539b22817af774b7c520d3c54f227ba26905aa1b0001ad3ebcc90278bb1c57915e1f319ebc18da6bfc1bc553225dc02607608a70067b0100000000000000000000002700020227ffff50e1605b6f302850694291eb0e688ef156774106eb355a8f6f0fcd9cc8e050923429f9525843c365d565a54e21560b517b506c1d8548f36bc3b744e9040819e6728585d26d2fe58db78dc8168eb375372fe21b0001dc66d1b24ec3fda1e8aa68e4ce1312eae994146a649a41fc53f78400e37c59190100000000000000000000000227000038a7a3cb80ec769c632b7b3e43525547ecd1c74e0eee3aa854880af97858a585cb8cbb6a41124be8ae33548b3a2f11c44b326b3bd31bfb257ad843316fd0a912361ad7c956fe84a47a9c66fdaba8b56de0b11c0001dc66d1b24ec3fda1e8aa68e4ce1312eae994146a649a41fc53f78400e37c59190100000000000000000000002800020228ffff50e1605b6f302850694291eb0e688ef1567726427e86bcecba11147eb7cd1cd407cc39631d08ce5a1b29cc9c6ec6a7d50db93edd47a045b17dbeccd2e97350e759365cfbd870033bb111da313a4a601614c71c0001a4498ffd3c9d7c68dff6820679c75e9c7fa71022d6bce44d623b91694be787920100000000000000000000000228000038a7a3cb80ec769c632b7b3e43525547ecd176fa0a6eccb6ed77136c632162719e70b71a789b234ad47d554589fc9b4dc14f235e0a25c141b3c084404b35c94037781d8e26b8294f942b6540d21ab1fc88e71b0001a4498ffd3c9d7c68dff6820679c75e9c7fa71022d6bce44d623b91694be78792010000000000000000000000"},
											};

		public Round						LastConfirmedRound;
		public Round						LastCommittedRound;
		//public Round						LastConfirmedRound	=> Rounds.FirstOrDefault(i => i.Confirmed) ?? LastSavedRound;
		//public Round						LastVotedRound		=> Rounds.FirstOrDefault(i => i.Voted) ?? LastConfirmedRound;
		public Round						LastNonEmptyRound	=> Rounds.FirstOrDefault(i => i.Blocks.Any()) ?? LastConfirmedRound;
		public Round						LastPayloadRound	=> Rounds.FirstOrDefault(i => i.Blocks.Any(i => i is Payload)) ?? LastConfirmedRound;

		public ColumnFamilyHandle			RoundsFamily	=> Engine.GetColumnFamily(nameof(Rounds));

		public static int					GetValidityPeriod(int rid) => rid + Pitch;

		public Database(Settings settings, Log log, INas nas, Vault vault, RocksDb engine)
		{
			Settings = settings;
			Log = log;
			Engine = engine;

			///GenerateFathers(256);

			Accounts = new (this);
			Authors = new (this);
			Products = new (this);
			Realizations = new (this);
			Releases = new (this);

			BaseState = Engine.Get(BaseStateKey);

			if(BaseState != null)
			{
				var r = new BinaryReader(new MemoryStream(BaseState));
		
				LastCommittedRound			= new Round(this){Id = r.Read7BitEncodedInt()};
				LastCommittedRound.Hash		= r.ReadSha3();
				LastCommittedRound.Time		= r.ReadTime();
				LastCommittedRound.WeiSpent	= r.ReadBigInteger();
				LastCommittedRound.Factor	= r.ReadCoin();
				LastCommittedRound.Emission	= r.ReadCoin();
				LastCommittedRound.Members	= Members = r.ReadList<Member>();
				LastCommittedRound.Funds	= Funds = r.ReadList<Account>();

				LoadedRounds.Add(LastCommittedRound.Id, LastCommittedRound);

				Hashify();

				if(!BaseHash.SequenceEqual(Engine.Get(__BaseHashKey)))
				{
					throw new IntegrityException("");
				}
			}

			if(Settings.Database.Chain)
			{
				var chainstate = Engine.Get(ChainStateKey);

				if(chainstate == null)
				{
					Rounds.Clear();
	
					var ips = nas.GetInitials(settings.Zone).ToArray();
	
					if(Settings.Dev.GenerateGenesis)
					{
						var s = new MemoryStream();
						var w = new BinaryWriter(s);

						void write(int rid)
						{
							var r = FindRound(rid);
							r.ConfirmedPayloads = r.Payloads.ToList();
							r.Hashify(r.Id > 0 ? FindRound(rid - 1).Hash : Cryptography.ZeroHash);
							r.Write(w);
						}
	
						var jr = new MembersJoinRequest(this)
									{
										RoundId	= Pitch,
										IP		= ips[0]
									};

						jr.Sign(Settings.Secret.Fathers[0]);
						jr.Write(w);

						var b0 = new Payload(this)
									{
										RoundId		= 0,
										TimeDelta	= 0,
										Reference	= RoundReference.Empty,
									};

						var t = new Transaction(Settings, Settings.Secret.OrgAccount);
						t.AddOperation(new Emission(Settings.Secret.OrgAccount, Web3.Convert.ToWei(1, UnitConversion.EthUnit.Ether), 0){ Id = 0 });
						t.AddOperation(new AuthorBid(Settings.Secret.OrgAccount, "uo", 1){ Id = 1 });
						t.Sign(Settings.Secret.GenAccount, 0);
						b0.AddNext(t);
						
						void emmit(Dictionary<Account, AccountEntry> accs)
						{
							for(int i = 0; i < ips.Length; i++)
							{
								for(int j = 0; j < Zone.GeneratorsPerIP; j++)
								{
									var f = Settings.Secret.Fathers[i * Zone.GeneratorsPerIP + j];
						
									var t = new Transaction(Settings, f);
									t.AddOperation(new Emission(f, Web3.Convert.ToWei(1000, UnitConversion.EthUnit.Ether), 0){ Id = 0 });
									
									if(accs != null)
									{
										t.AddOperation(new CandidacyDeclaration(f, accs[f].Balance - 1, new []{ ips[i] }){ Id = 1 });
									}

									t.Sign(Settings.Secret.GenAccount, 0);
	
									b0.AddNext(t);
								}
							}

							b0.Sign(Settings.Secret.GenAccount);
							Add(b0, true);
						}
						
						emmit(null);

						Execute(Rounds.First(), Rounds.First().Payloads, null);
						var accs = Rounds.First().AffectedAccounts;
						Rounds.Clear();
						b0.Transactions.Clear();
						b0.AddNext(t);

						emmit(accs);

						b0.FundJoiners.Add(Settings.Secret.OrgAccount);
	
						write(0);
						
						for(int i = 1; i < Pitch; i++)
						{
							var b = new Payload(this)
									{
										RoundId		= i,
										TimeDelta	= i == 1 ? ((long)TimeSpan.FromDays(365).TotalMilliseconds + 1) : 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
										Reference	= RoundReference.Empty,
									};
	
							if(i == 1)
							{
								t = new Transaction(Settings, Settings.Secret.OrgAccount);
								t.AddOperation(new AuthorRegistration(Settings.Secret.OrgAccount, "uo", "UO", 255){ Id = 2 });
								t.Sign(Settings.Secret.GenAccount, i);
								b.AddNext(t);
							}
								
							b.Sign(Settings.Secret.GenAccount);
							Add(b, false);
	
							write(i);
						}
	
						Add(jr, false);

						for(int i = Pitch; i <= LastGenesisRound; i++)
						{
							var p = GetRound(i - Pitch);
	
							var b = new Vote(this)
									{
										RoundId		= i,
										TimeDelta	= 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
										Reference	= ReferTo(p)
									};
		
							if(i == Pitch * 2)
								b.Joiners.Add(Settings.Secret.Fathers[0]);
	
							b.Sign(Settings.Secret.GenAccount);
							Add(b, false);
	
							if(i > LastGenesisRound - Pitch)
							{
								var v = new Vote(this)
										{
											RoundId		= i,
											TimeDelta	= 1,  //new AdmsTime(AdmsTime.FromYears(datebase + i).Ticks + 1),
											Reference	= ReferTo(p)
										};
	
								v.Sign(Settings.Secret.Fathers[0]);
								Add(v, false);
							}

							write(i);
						}
						
						var g = s.ToArray().ToHex();
						
						if(g != Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).Rounds)
							throw new IntegrityException("Genesis update needed");
						
						Rounds.Clear();
						JoinRequests.Clear();
					}
	
					var rd = new BinaryReader(new MemoryStream(Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).Rounds.HexToByteArray()));

					var jr0 = new MembersJoinRequest(this);
					jr0.Read(rd);
						
					for(int i = 0; i <= LastGenesisRound; i++)
					{
						var r = new Round(this);
						r.Read(rd);
						r.Voted = true;
		
						Rounds.Insert(0, r);
				
						if(i == Pitch * 3)
						{
							r.ConfirmedJoiners.Add(SecretSettings.Father0);
							r.ConfirmedFundJoiners.Add(SecretSettings.Org);
						}
	
						foreach(var p in r.Payloads)
							p.Confirmed = true;
	
						if(r.Id > 0)
							r.Time = CalculateTime(r, r.Unique);
	
						if(i <= LastGenesisRound - Pitch)
							Confirm(r, true);
					}

					Add(jr0, false);

					//jr0.Read(new BinaryReader(new MemoryStream(Genesises.Find(i => i.Zone == Settings.Zone && i.Crypto.GetType() == Cryptography.Current.GetType()).JoinRequest.HexToByteArray())));
	
					if(!Rounds.All(i => i.Payloads.All(i => i.Transactions.All(i => i.Operations.All(i => i.Error == null)))))
					{
						throw new IntegrityException("Genesis construction failed");
					}
				}
				else
				{
					var rd = new BinaryReader(new MemoryStream(chainstate));

					var lcr = FindRound(rd.Read7BitEncodedInt());
					
// 					w.Write(round.Time);
// 					w.Write(round.WeiSpent);
// 					w.Write(round.Factor);
// 					w.Write(round.Emission);
// 					w.Write(Members);
// 					w.Write(Funds);

					//LastConfirmedRound			= FindRound();

					for(int i = lcr.Id - lcr.Id % TailLength; i <= lcr.Id; i++)
					{
						var r = FindRound(i);

						Rounds.Insert(0, r);
		
						r.Confirmed = false;
						Confirm(r, true);
					}

					//lcr.Time		= rd.ReadTime();
					//lcr.WeiSpent	= rd.ReadBigInteger();
					//lcr.Factor		= rd.ReadCoin();
					//lcr.Emission	= rd.ReadCoin();
					//Members			= rd.ReadList<Member>();
					//Funds			= rd.ReadList<Account>();

					//Members = LastConfirmedRound.Members;
					//Funds = LastConfirmedRound.Funds;
				}
			}
		}

		public void Add(Block b, bool execute = true)
		{
			var r = GetRound(b.RoundId);

			b.Round = r;

			if(b is Vote)
			{
				r.Blocks.Add(b);
				r.Blocks = r.Blocks.OrderBy(i => i is Payload p ? p.OrderingKey : new byte[] {}, new BytesComparer()).ToList();
	
				if(b is Payload p)
				{
					foreach(var t in p.Transactions)
						foreach(var o in t.Operations)
							o.Placing = PlacingStage.Placed;

					if(execute)
	 					for(int i = r.Id; i <= LastPayloadRound.Id; i++)
	 					{
	 						var ir = GetRound(i);
	 						
	 						if(ir.Payloads.Any() && ir.Previous != null)
							{
								ir.Time = CalculateTime(ir, ir.Payloads);
								Execute(ir, ir.Payloads, null);
							}
	 						else
	 							break;
	 					}
				}
	
				if(r.FirstArrivalTime == DateTime.MaxValue)
				{
					r.FirstArrivalTime = DateTime.UtcNow;
				} 
	
			}

			if(b is MembersJoinRequest jr)
			{
				//jr.Bail = Accounts.Find(jr.Generator, b.RoundId - Pitch).Bail;
				JoinRequests.Add(jr);
			}
	
			BlockAdded?.Invoke(b);
		}

		public void Add(IEnumerable<Block> bb)
		{
			foreach(var i in bb)
			{
				Add(i);
			}
		}

		public bool Verify(Block b)
		{
			if(LastConfirmedRound != null && b.RoundId <= LastConfirmedRound.Id)
				return false;

			var r = FindRound(b.RoundId);
	
			if(r != null && r.Blocks.Any(i => i.Signature.SequenceEqual(b.Signature)))
				return false;

			if(JoinRequests.Any(i => i.Signature.SequenceEqual(b.Signature)))
				return false;
		
			return b.Valid;
		}

		public Round GetRound(int rid)
		{
			var r = FindRound(rid);

			if(r == null)
			{	
				r = new Round(this) {Id = rid};
				//r.LastAccessed = DateTime.UtcNow;
				Rounds.Add(r);
				Rounds = Rounds.OrderByDescending(i => i.Id).ToList();
			}

			return r;
		}

		public Round FindRound(int rid)
		{
			foreach(var i in Rounds)
				if(i.Id == rid)
				{
					//i.LastAccessed = DateTime.UtcNow;
					return i;
				}

			if(LoadedRounds.ContainsKey(rid))
			{
				var r = LoadedRounds[rid];
				//r.LastAccessed = DateTime.UtcNow;
				return r;
			}

			var d = Engine.Get(BitConverter.GetBytes(rid), RoundsFamily);

			if(d != null)
			{
				var r = new Round(this);
				r.Id			= rid; 
				r.Voted			= true; 
				r.Confirmed		= true;
				//r.LastAccessed	= DateTime.UtcNow;

				r.Load(new BinaryReader(new MemoryStream(d)));
	
				LoadedRounds[r.Id] = r;
				//Recycle();
				
				return r;
			}
			else
				return null;
		}

		void Recycle()
		{
			if(LoadedRounds.Count > TailLength * 10)
			{
				foreach(var i in LoadedRounds.OrderByDescending(i => i.Value.Id).Skip(TailLength * 10))
				{
					LoadedRounds.Remove(i.Key);
				}
			}
		}

		public IEnumerable<Member> VoterOf(Round r)
		{
			return Members.Where(i => i.JoinedAt < r.Id);
		}

		public IEnumerable<Account> ProposeJoiners(Round round)
		{
			if(JoinRequests.Count(i => i.RoundId == round.ParentId) > 1)
			{
				int d = 0;
			}

			var o = JoinRequests.Where(i => i.RoundId == round.ParentId)
								.Select(jr =>{
												var a = Accounts.Find(jr.Generator, LastConfirmedRound.Id);
												return new {jr = jr, a = a};
											})	/// round.ParentId - Pitch means to not join earlier than [Pitch] after declaration, and not redeclare after a join is requested
								.Where(i => i.a != null && 
											i.a.CandidacyDeclarationRound <= round.Id - Pitch * 2 &&  /// 2 = declared, requested
											i.a.Bail >= (Settings.Dev != null && Settings.Dev.DisableBailMin ? 0 : BailMin))
								.OrderByDescending(i => i.a.Bail)
								.ThenBy(i => i.a.Account)
								.Select(i => i.jr);

			var n = Math.Min(MembersMax - Members.Count, o.Count());

			//.Where(i =>	{ 
			//				var d = Accounts.FindLastOperation<CandidacyDeclaration>(i, null, null, null, r => r.Id <= round.Id);
			//				return d != null && d.Transaction.Payload.RoundId <= round.Id - Pitch*2 && d.Bail >= (Settings.Dev != null && Settings.Dev.DisableBailMin ? 0 : BailMin); 
			//			})

			return o.Take(n).Select(i => i.Generator);
		}

		public IEnumerable<Account> ProposeLeavers(Round round, Account generator)
		{
			var joiners = ProposeJoiners(round);

			var leavers = VoterOf(round).Where(i =>	i.JoinedAt < round.ParentId &&
													Rounds.Count(r =>	round.ParentId <= r.Id && r.Id < round.Id &&					/// in previous Pitch number of rounds
																		r.Votes.Any(b => b.Generator == i.Generator)) < Pitch * 2/3 &&	/// sent less than 2/3 of required blocks
													!Enumerable.Range(round.ParentId + 1, Pitch - 1).Select(i => FindRound(i)).Any(r => r.Votes.Any(v => v.Generator == generator && v.Leavers.Contains(i.Generator)))) /// not yet reported in prev [Pitch-1] rounds
										.Select(i => i.Generator);

			//if(!o.Any() && Members.Count == MembersMax && joiners.Any())
			//	leavers = Members.OrderByDescending(i => i.JoinedAt).ThenBy(i => i.Generator).Take(joiners.Take(MembersRotation).Count()).Select(i => i.Generator);
			//else
			//	leavers = o;

			return leavers;
		}

		public bool QuorumReached(Round r)
		{
			var members = VoterOf(r).Select(i => i.Generator);

			var n = r.Unique.Count(i => members.Contains(i.Generator));
			
			var q = members.Count() * 2 / 3;

			if(members.Count() * 2 % 3 != 0)
				q++;

			return q <= n;
		}

		public bool QuorumFailed(Round r)
		{
			var max = VoterOf(r).Select(i => i.Generator);

			return r.Unique.Count() >= Math.Max(1, max.Count() * 2/3) && r.Majority.Count() + (max.Count() - r.Unique.Count()) < Math.Max(1, max.Count() * 2/3);
		}

		public ChainTime CalculateTime(Round round, IEnumerable<Vote> votes)
		{
 			if(round.Id == 0)
 			{
 				return round.Time;
 			}

 			if(!votes.Any())
 			{
				return round.Previous.Time + new ChainTime(1);
			}

			///var t = 0L;
			///var n = 0;
			///
			///for(int i = Math.Max(0, round.Id - Pitch + 1); i <= round.Id; i++)
			///{
			///	var r = FindRound(i);
			///	t += r.Payloads.Sum(i => i.Time.Ticks);
			///	n += r.Payloads.Count();
			///}
			///
			///t /= n;

			votes = votes.OrderBy(i => i.Generator);

			return round.Previous.Time + new ChainTime(votes.Sum(i => i.TimeDelta)/votes.Count());
		}

		public IEnumerable<Transaction> CollectValidTransactions(IEnumerable<Transaction> txs, Round round)
		{
			//txs = txs.Where(i => round.Id <= i.RoundMax /*&& IsSequential(i, round.Id)*/);

			if(txs.Any())
			{
// 				var p = new Payload(this);
// 				p.Member	= Account.Zero;
// 				p.Time		= DateTime.UtcNow;
// 				p.Round		= round;
// 				p.TimeDelta	= 1;
// 					
// 				foreach(var i in txs)
// 				{
// 					p.AddNext(i);
// 				}
// 				
//  				Execute(round, new Payload[] {p}, null);
 	
 //				txs = txs.Where(t => t.SuccessfulOperations.Any());
			}

			return txs;
		}

		///public bool IsSequential(Operation transaction, int ridmax)
		///{
		///	var prev = Accounts.FindLastOperation(transaction.Signer, o => o.Successful, t => t.Successful, null, r => r.Id < ridmax);
		///
		///	if(transaction.Id == 0 && prev == null)
		///		return true;
		///
		///	if(transaction.Id == 0 && prev != null || transaction.Id != 0 && prev != null && prev.Id != transaction.Id - 1)
		///		return false;
		///
		///	/// STRICT: return prev != null && (prev.Payload.Confirmed || prev.Payload.Transactions.All(i => IsSequential(i, i.Payload.RoundId))); /// All transactions in a block containing 'prev' one must also be sequential
		///	return prev.Transaction.Payload.Confirmed || IsSequential(prev, prev.Transaction.Payload.RoundId);
		///}

		public RoundReference ReferTo(Round round)
		{
			//if(round.Id < Pitch)
			//	return RoundReference.Empty;

			if(round.Id > LastGenesisRound && !round.Parent.Confirmed)
				return null;

			//if(!round.Payloads.Any())
			//	return null;

			var choice = round.Payloads;
			//var nonempties = choice.Where(i => i.SuccessfulTransactions.Any());

			/// take only blocks with valid transactions or take first empty block 
			var pp = (choice).OrderBy(i => i.OrderingKey, new BytesComparer());
			
			var rr = new RoundReference();

			rr.Parent		= (round.Id >= Pitch ? round.Parent.Hash : Cryptography.ZeroHash);
			rr.Payloads		= pp.						Select(i => i.Prefix).ToList();
			rr.Violators	= round.ElectedViolators.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.Leavers		= round.ElectedLeavers.		Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.Joiners		= round.ElectedJoiners.		Select(i => i.Prefix).OrderBy(i => i, new BytesComparer())/*.Take(rr.Leavers.Count + NewMembersPerRoundMax)*/.ToList();
			rr.FundLeavers	= round.ElectedFundLeavers.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.FundJoiners	= round.ElectedFundJoiners.	Select(i => i.Prefix).OrderBy(i => i, new BytesComparer()).ToList();
			rr.Time			= CalculateTime(round, round.Votes);

			return rr; 
		}

		public void Execute(Round round, IEnumerable<Payload> payloads, IEnumerable<Account> forkers)
		{
			var prev = round.Previous;
				
			if(round.Id != 0 && prev == null)
				return;

			foreach(var b in payloads)
				foreach(var t in b.Transactions)
					foreach(var o in t.Operations)
					{
						//o.Successful = false;
						o.Error = null;
					}

			start: 

			round.Emission	= round.Id == 0 ? 0						:  prev.Emission;
			round.WeiSpent	= round.Id == 0 ? 0						:  prev.WeiSpent;
			round.Factor	= round.Id == 0 ? Emission.FactorStart	:  prev.Factor;
			round.Members	= Members.ToList();
			round.Funds		= Funds.ToList();

			round.AffectedAccounts.Clear();
			round.AffectedAuthors.Clear();
			round.AffectedProducts.Clear();
			round.AffectedRealizations.Clear();
			round.AffectedReleases.Clear();

			foreach(var b in payloads.AsEnumerable().Reverse())
			{
				foreach(var t in b.Transactions.AsEnumerable().Reverse())
				{
					Coin fee = 0;

					foreach(var o in t.Operations.AsEnumerable().Reverse())
					{
						if(o.Error != null)
							continue;

						var s = round.AffectAccount(t.Signer);
					
						if(o.Id <= s.LastOperationId)
						{
							o.Error = Operation.NotSequential;
							goto start;
						}
						
						o.Execute(this, round);

						if(o.Error != null)
							goto start;

						var f = o.CalculateFee(round.Factor);
	
						if(s.Balance - f < 0)
						{
							o.Error = Operation.NotEnoughUNT;
							goto start;
						}

						fee += f;
						s.Balance -= f;
						s.LastOperationId = o.Id;
					}
						
					if(t.SuccessfulOperations.Any())
					{
						if(Settings.Database.Chain)
						{
							round.AffectAccount(t.Signer).Transactions.Add(round.Id);
						}

						round.Distribute(fee, new[]{b.Generator}, 9, round.Funds, 1); /// taking 10% we prevent a member from sending his own transactions using his own blocks for free, this could be used for block flooding
					}
				}
			}

			if(round.Id > LastGenesisRound)
			{
				var penalty = Coin.Zero;

				if(forkers != null && forkers.Any())
				{
					foreach(var f in forkers)
					{
						penalty += round.AffectAccount(f).Bail;
						round.AffectAccount(f).BailStatus = BailStatus.Siezed;
					}

					round.Distribute(penalty, round.Members.Where(i => !forkers.Contains(i.Generator)).Select(i => i.Generator), 1, round.Funds, 1);
				}
			}
		}

		public void Hashify()
		{
			BaseHash = Cryptography.Current.Hash(BaseState);
	
			foreach(var i in Accounts.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Authors.SuperClusters.OrderBy(i => i.Key))			BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Products.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Realizations.SuperClusters.OrderBy(i => i.Key))	BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
			foreach(var i in Releases.SuperClusters.OrderBy(i => i.Key))		BaseHash = Cryptography.Current.Hash(Bytes.Xor(BaseHash, i.Value));
		}

		public void Confirm(Round round, bool confirmed)
		{
			if(round.Id > 0 && LastConfirmedRound != null && LastConfirmedRound.Id + 1 != round.Id)
				throw new IntegrityException("LastConfirmedRound.Id + 1 == round.Id");

			if(!confirmed)
			{
				List<T>	confirm<T>(IEnumerable<byte[]> prefixes, Func<Vote, IEnumerable<T>> get, Func<T, byte[]> getprefix)
				{
					var o = prefixes.Select(v => round.Unique.SelectMany(i => get(i)).FirstOrDefault(i => getprefix(i).SequenceEqual(v)));
	
					if(o.Contains(default(T)))
						throw new ConfirmationException("Can't confirm, some references not found", round);
					else 
						return o.ToList();
				}
	
				/// check we have all payload blocks 
	
				foreach(var i in round.Payloads)
					i.Confirmed = false;
	
				var child = FindRound(round.Id + Pitch);
				var rf = child.Majority.First().Reference;
	 	
 				foreach(var pf in rf.Payloads)
 				{
 					var b = round.Unique.OfType<Payload>().FirstOrDefault(i => pf.SequenceEqual(i.Prefix));
 	
 					if(b != null)
 						b.Confirmed = true;
 					else
 						return;
 				}

				round.Time					= rf.Time;
				round.ConfirmedPayloads		= round.Payloads.Where(i => i.Confirmed).OrderBy(i => i.OrderingKey, new BytesComparer()).ToList();
				round.ConfirmedViolators	= confirm(rf.Violators,		i => i.Violators,	i => i.Prefix);
				round.ConfirmedJoiners		= confirm(rf.Joiners,		i => i.Joiners,		i => i.Prefix);
				round.ConfirmedLeavers		= confirm(rf.Leavers,		i => i.Leavers,		i => i.Prefix);
				round.ConfirmedFundJoiners	= confirm(rf.FundJoiners,	i => i.FundJoiners, i => i.Prefix);
				round.ConfirmedFundLeavers	= confirm(rf.FundLeavers,	i => i.FundLeavers, i => i.Prefix);
			}
			else
				round.ConfirmedPayloads		= round.Payloads.ToList();

			Execute(round, round.ConfirmedPayloads, round.ConfirmedViolators);
			
			foreach(var b in round.Payloads)
			{
				foreach(var t in b.Transactions)
				{	
					foreach(var o in t.Operations)
					{	
						o.Placing = (b.Confirmed && o.Error == null) ? PlacingStage.Confirmed : PlacingStage.FailedOrNotFound;
#if DEBUG
						if(o.__ExpectedPlacing != PlacingStage.Null && o.Placing != o.__ExpectedPlacing)
						{
							o.Placing = o.Placing;
						}
#endif
					}

					t.Operations.RemoveAll(i => i.Error != null);
				}

				b.Transactions.RemoveAll(t => !t.Operations.Any());
			}

			//round.Blocks.RemoveAll(b => b is Payload p && !p.Transactions.Any());

			Members.AddRange(round.ConfirmedJoiners	.Where(i => Accounts.Find(i, round.Id).CandidacyDeclarationRound <= round.Id - Pitch * 3)
													.Select(i => new Member {Generator = i, IPs = Accounts.Find(i, round.Id).IPs, JoinedAt = round.Id + Pitch}));

			Members.RemoveAll(i => round.AnyOperation(o => o is CandidacyDeclaration d && d.Signer == i.Generator && o.Placing == PlacingStage.Confirmed));  /// CandidacyDeclaration cancels membership
			Members.RemoveAll(i => round.AffectedAccounts.ContainsKey(i.Generator) && round.AffectedAccounts[i.Generator].Bail < (Settings.Dev.DisableBailMin ? 0 : BailMin));  /// if Bail has exhausted due to penalties (CURRENTY NOT APPLICABLE, penalties are disabled)
			Members.RemoveAll(i => round.ConfirmedLeavers.Contains(i.Generator));
			Members.RemoveAll(i => round.ConfirmedViolators.Contains(i.Generator));
 			round.Members = Members.ToList();

			if(round.Id <= LastGenesisRound || round.Factor == Emission.FactorEnd) /// Funds reorganization only after emission is over
			{
				Funds.AddRange(round.ConfirmedFundJoiners);
				Funds.RemoveAll(i => round.ConfirmedFundLeavers.Contains(i));
 				round.Funds	= Funds.ToList();
			}

			using(var b = new WriteBatch())
			{
				if(Rounds.Count(i => i.Id < round.Id) >= TailLength)
				{
					var tail = Rounds.AsEnumerable().Reverse().Take(TailLength);
	
					foreach(var i in tail)
					{
						Accounts	.Save(b, i.AffectedAccounts.Values);
						Authors		.Save(b, i.AffectedAuthors.Values);
						Products	.Save(b, i.AffectedProducts.Values);
						Realizations.Save(b, i.AffectedRealizations.Values);
						Releases	.Save(b, i.AffectedReleases.Values);
					}

// {
// 	Engine.Write(b);
// 	var acc = new AccountTable(this);
// 
// 	{
// 		var i = acc.SuperClusters.OrderBy(i => i.Key).GetEnumerator();
// 		var j = Accounts.SuperClusters.OrderBy(i => i.Key).GetEnumerator();
// 		while(true)
// 		{
// 			var x = i.MoveNext();
// 			var y = j.MoveNext();
// 		
// 			if(x != y)
// 			{
// 				throw new Exception();
// 			}
// 		
// 			if(!x)
// 				break;
// 		
// 			if(!i.Current.Value.SequenceEqual(j.Current.Value))
// 			{
// 				throw new Exception();
// 			}
// 		}
// 	}
// 
// 	{
// 		var i = acc.Clusters.OrderBy(i => i.Id).GetEnumerator();
// 		var j = Accounts.Clusters.OrderBy(i => i.Id).GetEnumerator();
// 		while(true)
// 		{
// 			var x = i.MoveNext();
// 			var y = j.MoveNext();
// 		
// 			if(x != y)
// 			{
// 				throw new Exception();
// 			}
// 		
// 			if(!x)
// 				break;
// 		
// 			if(!i.Current.Hash.SequenceEqual(j.Current.Hash))
// 			{
// 				throw new Exception();
// 			}
// 		}
// 	}
// }						

					LastCommittedRound = tail.Last();
	
					var s = new MemoryStream();
					var w = new BinaryWriter(s);
	
					w.Write7BitEncodedInt(LastCommittedRound.Id);
					w.Write(LastCommittedRound.Hash);
					w.Write(LastCommittedRound.Time);
					w.Write(LastCommittedRound.WeiSpent);
					w.Write(LastCommittedRound.Factor);
					w.Write(LastCommittedRound.Emission);
					w.Write(Members.OrderBy(i => i.Generator));
					w.Write(Funds.OrderBy(i => i));
	
					BaseState = s.ToArray();

					Hashify();
									
					b.Put(BaseStateKey, BaseState);
					b.Put(__BaseHashKey, BaseHash);

					foreach(var i in tail)
					{
						if(!LoadedRounds.ContainsKey(i.Id))
						{
							LoadedRounds.Add(i.Id, i);
						}
						
						Rounds.Remove(i);
					}

					Recycle();
				}

				round.Hashify(round.Id > 0 ? round.Previous.Hash : Cryptography.ZeroHash); /// depends on BaseHash 

				if(Settings.Database.Chain)
				{
					var s = new MemoryStream();
					var w = new BinaryWriter(s);

					w.Write7BitEncodedInt(round.Id);
// 					w.Write(round.Time);
// 					w.Write(round.WeiSpent);
// 					w.Write(round.Factor);
// 					w.Write(round.Emission);
// 					w.Write(Members);
// 					w.Write(Funds);

					b.Put(ChainStateKey, s.ToArray());

					s = new MemoryStream();
					w = new BinaryWriter(s);
	
					round.Save(w);
	
					b.Put(BitConverter.GetBytes(round.Id), s.ToArray(), RoundsFamily);
				}

				Engine.Write(b);
			}

			JoinRequests.RemoveAll(i => i.RoundId < round.ParentId);
		
			round.Confirmed = true;
			LastConfirmedRound = round;
		}

		public ProductEntry FindProduct(ProductAddress product, int ridmax)
		{
			foreach(var r in Rounds.Where(i => i.Id <= ridmax))
				if(r.AffectedProducts.ContainsKey(product))
					return r.AffectedProducts[product];

			var e = Products.FindEntry(product);

			if(e != null && (e.LastRegistration > ridmax))
				throw new IntegrityException("maxrid works inside pool only");

			return e;
		}

		public Transaction FindLastPoolTransaction(Func<Transaction, bool> transaction_predicate, Func<Payload, bool> payload_predicate = null, Func<Round, bool> round_predicate = null)
		{
			foreach(var r in round_predicate == null ? Rounds : Rounds.Where(round_predicate))
				foreach(var b in payload_predicate == null ? r.Payloads : r.Payloads.Where(payload_predicate))
					foreach(var t in b.Transactions)
						if(transaction_predicate == null || transaction_predicate(t))
							return t;

			return null;
		}

		public IEnumerable<Transaction> FindLastPoolTransactions(Func<Transaction, bool> transaction_predicate, Func<Payload, bool> payload_predicate = null, Func<Round, bool> round_predicate = null)
		{
			foreach(var r in round_predicate == null ? Rounds : Rounds.Where(round_predicate))
				foreach(var b in payload_predicate == null ? r.Payloads : r.Payloads.Where(payload_predicate))
					foreach(var t in transaction_predicate == null ? b.Transactions : b.Transactions.Where(transaction_predicate))
						yield return t;
		}

		public O FindLastPoolOperation<O>(Func<O, bool> op = null, Func<Transaction, bool> tp = null, Func<Payload, bool> pp = null, Func<Round, bool> rp = null)
		{
			var ops = FindLastPoolTransactions(tp, pp, rp).SelectMany(i => i.Operations.OfType<O>());
			return op == null ? ops.FirstOrDefault() : ops.FirstOrDefault(op);
		}

		IEnumerable<O> FindLastPoolOperations<O>(Func<O, bool> op = null, Func<Transaction, bool> tp = null, Func<Payload, bool> pp = null, Func<Round, bool> rp = null)
		{
			var ops = FindLastPoolTransactions(tp, pp, rp).SelectMany(i => i.Operations.OfType<O>());
			return op == null ? ops : ops.Where(op);
		}

		public Block FindLastBlock(Func<Block, bool> f, int maxrid = int.MaxValue)
		{
			foreach(var r in Rounds.Where(i => i.Id <= maxrid))
				foreach(var b in r.Blocks)
					if(f(b))
						return b;

			return null;
		}

		public IEnumerable<Block> FindLastBlocks(Func<Block, bool> f, int maxrid = int.MaxValue)
		{
			foreach(var r in Rounds.Where(i => i.Id <= maxrid))
				foreach(var b in r.Blocks)
					if(f(b))
						yield return b;
		}

		public IEnumerable<ReleaseRegistration> FindReleases(string author, string product, Func<ReleaseRegistration, bool> f, int maxrid = int.MaxValue)
		{
			var p = FindProduct(new ProductAddress(author, product), maxrid);

			if(p == null)
				yield break;

			foreach(var r in p.Releases.Where(i => i.Rid <= maxrid).Select(i => FindRound(i.Rid).FindOperation<ReleaseRegistration>(o => o.Release.Author == author && o.Release.Product == product && o.Release.Version == i.Version)))
				yield return r;
		}
		
		public AccountInfo GetAccountInfo(Account account, bool confirmed)
		{
			var rmax = confirmed ? LastConfirmedRound : LastNonEmptyRound;

			var a = Accounts.Find(account, rmax.Id);

			if(a != null)
			{
				var i = new AccountInfo();


				i.Balance			= a.Balance;
				i.LastOperationId	= a.LastOperationId;
				//i.Authors			= a.Authors;

				if(Settings.Database.Chain)
				{
					//var t = Accounts.FindLastOperation(account, i => i.Successful, null, null, r => r.Id <= rmax.Id);

					//i.Operations = Accounts.FindLastOperations<Operation>(account, null, null, null, r => r.Id <= rmax.Id).Take(10).Reverse().Select(i => new AccountOperationInfo(i)).ToList();
				}

				return i;
			}

			return null;
		}

		public XonDocument GetAuthorInfo(string author, bool confirmed, IXonValueSerializator serializator)
		{
			var roundmax = confirmed ? LastConfirmedRound : LastNonEmptyRound;

			var a = Authors.Find(author, roundmax.Id);

			if(a != null)
			{
				return a.ToXon(serializator);
			}

			return null;
		}
				
		public QueryReleaseResult QueryRelease(ReleaseQuery query, bool confirmed)
		{
			if(query.VersionQuery == VersionQuery.Latest)
			{
				var roundmax = confirmed ? LastConfirmedRound : LastPayloadRound;
	
				var p = Products.Find(query.Realization, roundmax.Id);
	
				if(p != null)
				{
					var r = p.Releases.Where(i => i.Platform == query.Platform && i.Channel == query.Channel).MaxBy(i => i.Version);
					
					if(r != null)
					{
						var rr = FindRound(r.Rid).FindOperation<ReleaseRegistration>(m =>	(RealizationAddress)m.Release == (RealizationAddress)query.Realization && 
																							m.Release.Version == r.Version);
	
						return new QueryReleaseResult{Registration = rr};
					}
				}

				return null;
			}

			if(query.VersionQuery == VersionQuery.Exact)
			{
				var roundmax = confirmed ? LastConfirmedRound : LastPayloadRound;
	
				var p = Products.Find(query.Realization, roundmax.Id);
	
				if(p != null)
				{
					var r = p.Releases.Find(i => i.Platform == query.Platform && i.Version == query.Version);
					
					if(r != null)
					{
						var rr = FindRound(r.Rid).FindOperation<ReleaseRegistration>(m =>	(RealizationAddress)m.Release == (RealizationAddress)query.Realization && 
																							m.Release.Version == r.Version);
	
						return new QueryReleaseResult{Registration = rr};
					}
				}

				return null;
			}

			throw new ArgumentException("Unsupported VersionQuery");
		}
	}
}
